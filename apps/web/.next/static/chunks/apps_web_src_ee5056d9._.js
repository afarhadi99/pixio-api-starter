(globalThis.TURBOPACK = globalThis.TURBOPACK || []).push([typeof document === "object" ? document.currentScript : undefined, {

"[project]/apps/web/src/lib/actions/data:aaa727 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"40eca5b085d539164a745ab9b6e035f75375755dac":"generateMedia"},"apps/web/src/lib/actions/media.actions.ts",""] */ __turbopack_context__.s({
    "generateMedia": (()=>generateMedia)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var generateMedia = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("40eca5b085d539164a745ab9b6e035f75375755dac", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "generateMedia"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vbWVkaWEuYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL2FjdGlvbnMvbWVkaWEuYWN0aW9ucy50c1xyXG4ndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAcmVwby9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyB1c2VDcmVkaXRzIH0gZnJvbSAnQC9saWIvY3JlZGl0cyc7XHJcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSAnbmV4dC9jYWNoZSc7XHJcbmltcG9ydCB7IE1lZGlhVHlwZSwgQ1JFRElUX0NPU1RTLCBHZW5lcmF0aW9uUmVzdWx0LCBHZW5lcmF0aW9uTW9kZSB9IGZyb20gJ0AvbGliL2NvbnN0YW50cy9tZWRpYSc7XHJcbi8vIEltcG9ydCB0aGUgc3BlY2lmaWMgSW5zZXJ0IHR5cGUgYW5kIEdlbmVyYXRlZE1lZGlhIHR5cGVcclxuaW1wb3J0IHsgRGF0YWJhc2UsIEdlbmVyYXRlZE1lZGlhIH0gZnJvbSAnQC90eXBlcy9kYl90eXBlcyc7XHJcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAcmVwby9zdXBhYmFzZS9hZG1pbic7XHJcbi8vIEltcG9ydCBvbmx5IHRoZSBuZWNlc3Nhcnkgc3RvcmFnZSBzZXJ2aWNlIGZ1bmN0aW9ucyAodXNlZCBieSBhY3Rpb25zIGJlbG93KVxyXG5pbXBvcnQgeyBsaXN0VXNlckZpbGVzIGFzIGxpc3RVc2VyRmlsZXNTZXJ2aWNlLCBkZWxldGVGaWxlIGFzIGRlbGV0ZUZpbGVTZXJ2aWNlIH0gZnJvbSAnQC9saWIvc3RvcmFnZS9zdXBhYmFzZS1zdG9yYWdlJztcclxuLy8gSW1wb3J0IFBpeGlvIEFQSSBjbGllbnQgYW5kIG1vZGVsc1xyXG5pbXBvcnQge1xyXG4gIFBJWElPX01PREVMUyxcclxuICBxdWV1ZVBpeGlvUnVuLFxyXG4gIGNhbmNlbFBpeGlvUnVuLFxyXG4gIGNyZWF0ZVJ1blJlcXVlc3QsXHJcbiAgdHlwZSBLcmVhRmx1eElucHV0cyxcclxuICB0eXBlIFdhbkZpcnN0TGFzdEZyYW1lSW5wdXRzXHJcbn0gZnJvbSAnQHJlcG8vcGl4aW8tYXBpJztcclxuXHJcbi8vIERlZmluZSB0aGUgc3BlY2lmaWMgdHlwZSBmb3IgaW5zZXJ0aW9uLCBkZXJpdmVkIGZyb20gZGJfdHlwZXMudHNcclxudHlwZSBHZW5lcmF0ZWRNZWRpYUluc2VydCA9IERhdGFiYXNlWydwdWJsaWMnXVsnVGFibGVzJ11bJ2dlbmVyYXRlZF9tZWRpYSddWydJbnNlcnQnXTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWF0ZXMgbWVkaWEgZ2VuZXJhdGlvbiBieSBjcmVhdGluZyBhIHJlY29yZCBhbmQgaW52b2tpbmcgdGhlIFN1cGFiYXNlIEZ1bmN0aW9uLlxyXG4gKiBFeHBlY3RzIGltYWdlIFVSTHMgZm9yIG1vZGVzIHRoYXQgcmVxdWlyZSBpbnB1dCBpbWFnZXMgKGNsaWVudCBoYW5kbGVzIHVwbG9hZCkuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZWRpYShmb3JtRGF0YTogRm9ybURhdGEpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIG1lZGlhSWQ/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG4gIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiB1c2VyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xyXG5cclxuICBpZiAoIXVzZXIgfHwgdXNlckVycm9yKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvcicgfTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBSZWFkIGRhdGEgZnJvbSBGb3JtRGF0YSAtLS1cclxuICBjb25zdCBnZW5lcmF0aW9uTW9kZSA9IGZvcm1EYXRhLmdldCgnZ2VuZXJhdGlvbk1vZGUnKSBhcyBHZW5lcmF0aW9uTW9kZTtcclxuICBcclxuICAvLyBEZXRlcm1pbmUgbWVkaWEgdHlwZSBiYXNlZCBvbiBtb2RlbCBjYXRlZ29yeSwgbm90IGdlbmVyYXRpb24gbW9kZSBuYW1lXHJcbiAgY29uc3QgbWVkaWFUeXBlOiBNZWRpYVR5cGUgPSBnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nID8gJ3ZpZGVvJyA6ICdpbWFnZSc7XHJcbiAgLy8gS3JlYSBGbHV4IChpbWFnZSBtb2RlKSDihpIgaW1hZ2VcclxuICAvLyBRd2VuIEVkaXQgKHZpZGVvIG1vZGUpIOKGkiBpbWFnZSAoaXQncyBlZGl0aW5nLCBub3QgZ2VuZXJhdGluZyB2aWRlbylcclxuICAvLyBXYW4gMi4yIChmaXJzdExhc3RGcmFtZVZpZGVvIG1vZGUpIOKGkiB2aWRlb1xyXG5cclxuICAvLyAtLS0gVmFsaWRhdGlvbiAtLS1cclxuICBpZiAoIWdlbmVyYXRpb25Nb2RlKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycgfTtcclxuICB9XHJcblxyXG4gIC8vIE1vZGUtc3BlY2lmaWMgaW5wdXQgZXh0cmFjdGlvbiBhbmQgdmFsaWRhdGlvblxyXG4gIGxldCBwcm9tcHQgPSAnJztcclxuICBsZXQgc3RhcnRJbWFnZVVybDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgbGV0IGVuZEltYWdlVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UxVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UyVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UzVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgcG9zaXRpdmVQcm9tcHQgPSAnJztcclxuICBsZXQgbmVnYXRpdmVQcm9tcHQgPSAnJztcclxuICBsZXQgd2lkdGggPSAxMDI0O1xyXG4gIGxldCBoZWlnaHQgPSAxMDI0O1xyXG4gIGxldCB2aWRlb1dpZHRoID0gNTEyO1xyXG4gIGxldCB2aWRlb0hlaWdodCA9IDUxMjtcclxuICBsZXQgdmlkZW9MZW5ndGggPSA4MTtcclxuXHJcbiAgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnaW1hZ2UnKSB7XHJcbiAgICAvLyBLcmVhIEZsdXhcclxuICAgIHByb21wdCA9IGZvcm1EYXRhLmdldCgncHJvbXB0JykgYXMgc3RyaW5nO1xyXG4gICAgd2lkdGggPSBwYXJzZUludChmb3JtRGF0YS5nZXQoJ3dpZHRoJykgYXMgc3RyaW5nKSB8fCAxMDI0O1xyXG4gICAgaGVpZ2h0ID0gcGFyc2VJbnQoZm9ybURhdGEuZ2V0KCdoZWlnaHQnKSBhcyBzdHJpbmcpIHx8IDEwMjQ7XHJcbiAgICBpZiAoIXByb21wdD8udHJpbSgpKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHByb21wdCcgfTtcclxuICB9IGVsc2UgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAndmlkZW8nKSB7XHJcbiAgICAvLyBRd2VuIEVkaXRcclxuICAgIGltYWdlMVVybCA9IGZvcm1EYXRhLmdldCgnaW1hZ2UxVXJsJykgYXMgc3RyaW5nO1xyXG4gICAgaW1hZ2UyVXJsID0gZm9ybURhdGEuZ2V0KCdpbWFnZTJVcmwnKSBhcyBzdHJpbmcgfHwgbnVsbDtcclxuICAgIGltYWdlM1VybCA9IGZvcm1EYXRhLmdldCgnaW1hZ2UzVXJsJykgYXMgc3RyaW5nIHx8IG51bGw7XHJcbiAgICBwb3NpdGl2ZVByb21wdCA9IGZvcm1EYXRhLmdldCgncG9zaXRpdmVQcm9tcHQnKSBhcyBzdHJpbmcgfHwgJyc7XHJcbiAgICBuZWdhdGl2ZVByb21wdCA9IGZvcm1EYXRhLmdldCgnbmVnYXRpdmVQcm9tcHQnKSBhcyBzdHJpbmcgfHwgJyc7XHJcbiAgICBpZiAoIWltYWdlMVVybCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWlzc2luZyBpbWFnZSBmb3IgZWRpdGluZycgfTtcclxuICB9IGVsc2UgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnZmlyc3RMYXN0RnJhbWVWaWRlbycpIHtcclxuICAgIC8vIFdhbiAyLjJcclxuICAgIHByb21wdCA9IGZvcm1EYXRhLmdldCgncHJvbXB0JykgYXMgc3RyaW5nO1xyXG4gICAgc3RhcnRJbWFnZVVybCA9IGZvcm1EYXRhLmdldCgnc3RhcnRJbWFnZVVybCcpIGFzIHN0cmluZztcclxuICAgIGVuZEltYWdlVXJsID0gZm9ybURhdGEuZ2V0KCdlbmRJbWFnZVVybCcpIGFzIHN0cmluZztcclxuICAgIHZpZGVvV2lkdGggPSBwYXJzZUludChmb3JtRGF0YS5nZXQoJ3dpZHRoJykgYXMgc3RyaW5nKSB8fCA1MTI7XHJcbiAgICB2aWRlb0hlaWdodCA9IHBhcnNlSW50KGZvcm1EYXRhLmdldCgnaGVpZ2h0JykgYXMgc3RyaW5nKSB8fCA1MTI7XHJcbiAgICB2aWRlb0xlbmd0aCA9IHBhcnNlSW50KGZvcm1EYXRhLmdldCgnbGVuZ3RoJykgYXMgc3RyaW5nKSB8fCA4MTtcclxuICAgIGlmICghcHJvbXB0Py50cmltKCkpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgcHJvbXB0JyB9O1xyXG4gICAgaWYgKCFzdGFydEltYWdlVXJsKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHN0YXJ0IGltYWdlIFVSTCcgfTtcclxuICAgIGlmICghZW5kSW1hZ2VVcmwpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgZW5kIGltYWdlIFVSTCcgfTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNyZWRpdENvc3QgPSBDUkVESVRfQ09TVFNbZ2VuZXJhdGlvbk1vZGVdO1xyXG4gIGlmIChjcmVkaXRDb3N0ID09PSB1bmRlZmluZWQpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZ2VuZXJhdGlvbiBtb2RlJyB9O1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIDEuIENoZWNrIGFuZCBkZWR1Y3QgY3JlZGl0c1xyXG4gICAgY29uc3QgY3JlZGl0U3VjY2VzcyA9IGF3YWl0IHVzZUNyZWRpdHMoXHJcbiAgICAgIHVzZXIuaWQsXHJcbiAgICAgIGNyZWRpdENvc3QsXHJcbiAgICAgIGBHZW5lcmF0ZSAke2dlbmVyYXRpb25Nb2RlfTogXCIke3Byb21wdC5zbGljZSgwLCAzMCl9JHtwcm9tcHQubGVuZ3RoID4gMzAgPyAnLi4uJyA6ICcnfVwiYFxyXG4gICAgKTtcclxuICAgIGlmICghY3JlZGl0U3VjY2VzcykgeyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOb3QgZW5vdWdoIGNyZWRpdHMnIH07IH1cclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDcmVkaXRzIGRlZHVjdGVkIHN1Y2Nlc3NmdWxseSBmb3IgdXNlciAke3VzZXIuaWR9YCk7XHJcblxyXG4gICAgLy8gMi4gQ3JlYXRlIGluaXRpYWwgJ3BlbmRpbmcnIHJlY29yZCBpbiBEQlxyXG4gICAgY29uc3QgaW5zZXJ0UGF5bG9hZDogR2VuZXJhdGVkTWVkaWFJbnNlcnQgPSB7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcclxuICAgICAgICBwcm9tcHQ6IHByb21wdCB8fCBwb3NpdGl2ZVByb21wdCB8fCAnSW1hZ2UgZWRpdCcsIC8vIFVzZSBhcHByb3ByaWF0ZSBwcm9tcHRcclxuICAgICAgICBtZWRpYV90eXBlOiBtZWRpYVR5cGUsXHJcbiAgICAgICAgY3JlZGl0c191c2VkOiBjcmVkaXRDb3N0LFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIG1lZGlhX3VybDogJycsIC8vIFJlcXVpcmVkIGJ5IEluc2VydCB0eXBlXHJcbiAgICAgICAgc3RvcmFnZV9wYXRoOiAnJywgLy8gUmVxdWlyZWQgYnkgSW5zZXJ0IHR5cGVcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgZ2VuZXJhdGlvbk1vZGUsXHJcbiAgICAgICAgICAuLi4oZ2VuZXJhdGlvbk1vZGUgPT09ICdpbWFnZScgJiYgeyB3aWR0aCwgaGVpZ2h0IH0pLFxyXG4gICAgICAgICAgLi4uKHBvc2l0aXZlUHJvbXB0ICYmIHsgcG9zaXRpdmVQcm9tcHQsIG5lZ2F0aXZlUHJvbXB0IH0pXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nKSB7XHJcbiAgICAgICAgaW5zZXJ0UGF5bG9hZC5zdGFydF9pbWFnZV91cmwgPSBzdGFydEltYWdlVXJsO1xyXG4gICAgICAgIGluc2VydFBheWxvYWQuZW5kX2ltYWdlX3VybCA9IGVuZEltYWdlVXJsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdNZWRpYVJlY29yZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKS5pbnNlcnQoaW5zZXJ0UGF5bG9hZCkuc2VsZWN0KCdpZCcpLnNpbmdsZSgpO1xyXG4gICAgaWYgKGluc2VydEVycm9yIHx8ICFuZXdNZWRpYVJlY29yZCkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiW0FjdGlvbl0gRmFpbGVkIHRvIGluc2VydCBpbml0aWFsIG1lZGlhIHJlY29yZDpcIiwgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBUT0RPOiBDb25zaWRlciByZWZ1bmRpbmcgY3JlZGl0cyBoZXJlIGlmIGluc2VydCBmYWlscyBhZnRlciBkZWR1Y3Rpb25cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBgRmFpbGVkIHRvIGNyZWF0ZSBnZW5lcmF0aW9uIHJlY29yZDogJHtpbnNlcnRFcnJvcj8ubWVzc2FnZX1gIH07XHJcbiAgICB9XHJcbiAgICBjb25zdCBtZWRpYUlkID0gbmV3TWVkaWFSZWNvcmQuaWQ7XHJcbiAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gSW5pdGlhbCBtZWRpYSByZWNvcmQgY3JlYXRlZCB3aXRoIElEOiAke21lZGlhSWR9YCk7XHJcblxyXG4gICAgLy8gMy4gUHJlcGFyZSB3ZWJob29rIFVSTCBmb3IgUGl4aW8gQVBJIGNhbGxiYWNrc1xyXG4gICAgY29uc3Qgd2ViaG9va1VybCA9IGAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NJVEVfVVJMfS9hcGkvd2ViaG9va3MvcGl4aW9gO1xyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFVzaW5nIHdlYmhvb2sgVVJMOiAke3dlYmhvb2tVcmx9YCk7XHJcblxyXG4gICAgLy8gNC4gR2V0IEFQSSBrZXlcclxuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlBJWElPX0RFUExPWV9BUElfS0VZO1xyXG4gICAgaWYgKCFhcGlLZXkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignW0FjdGlvbl0gUElYSU9fREVQTE9ZX0FQSV9LRVkgbm90IGNvbmZpZ3VyZWQnKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQVBJIGtleSBub3QgY29uZmlndXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA1LiBTZWxlY3QgbW9kZWwgYW5kIGNhbGwgUGl4aW8gQVBJIGJhc2VkIG9uIGdlbmVyYXRpb24gbW9kZVxyXG4gICAgbGV0IHBpeGlvUmVzdWx0O1xyXG4gICAgbGV0IHNlbGVjdGVkTW9kZWw7XHJcblxyXG4gICAgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnaW1hZ2UnKSB7XHJcbiAgICAgIC8vIFVzZSBLcmVhIEZsdXggbW9kZWxcclxuICAgICAgc2VsZWN0ZWRNb2RlbCA9IFBJWElPX01PREVMUy5rcmVhRmx1eDtcclxuICAgICAgY29uc3QgaW5wdXRzOiBLcmVhRmx1eElucHV0cyA9IHtcclxuICAgICAgICB0ZXh0OiBwcm9tcHQsXHJcbiAgICAgICAgd2lkdGgsXHJcbiAgICAgICAgaGVpZ2h0XHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSdW5SZXF1ZXN0KHNlbGVjdGVkTW9kZWwsIGlucHV0cywge1xyXG4gICAgICAgIHdlYmhvb2s6IHdlYmhvb2tVcmwsXHJcbiAgICAgICAgd2ViaG9va0ludGVybWVkaWF0ZVN0YXR1czogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBQaXhpbyBBUEkgZm9yIG1lZGlhSWQ6ICR7bWVkaWFJZH0sIG1vZGVsOiAke3NlbGVjdGVkTW9kZWwubmFtZX1gKTtcclxuICAgICAgcGl4aW9SZXN1bHQgPSBhd2FpdCBxdWV1ZVBpeGlvUnVuKHJlcXVlc3QsIGFwaUtleSk7XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ3ZpZGVvJykge1xyXG4gICAgICAvLyBVc2UgUXdlbiBFZGl0IG1vZGVsXHJcbiAgICAgIHNlbGVjdGVkTW9kZWwgPSBQSVhJT19NT0RFTFMucXdlbkVkaXQ7XHJcbiAgICAgIGNvbnN0IGlucHV0czogaW1wb3J0KCdAcmVwby9waXhpby1hcGknKS5Rd2VuRWRpdElucHV0cyA9IHtcclxuICAgICAgICBpbWFnZTE6IGltYWdlMVVybCEsXHJcbiAgICAgICAgcG9zaXRpdmU6IHBvc2l0aXZlUHJvbXB0LFxyXG4gICAgICAgIG5lZ2F0aXZlOiBuZWdhdGl2ZVByb21wdCxcclxuICAgICAgICAuLi4oaW1hZ2UyVXJsICYmIHsgaW1hZ2UyOiBpbWFnZTJVcmwgfSksXHJcbiAgICAgICAgLi4uKGltYWdlM1VybCAmJiB7IGltYWdlMzogaW1hZ2UzVXJsIH0pXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSdW5SZXF1ZXN0KHNlbGVjdGVkTW9kZWwsIGlucHV0cywge1xyXG4gICAgICAgIHdlYmhvb2s6IHdlYmhvb2tVcmwsXHJcbiAgICAgICAgd2ViaG9va0ludGVybWVkaWF0ZVN0YXR1czogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBQaXhpbyBBUEkgZm9yIG1lZGlhSWQ6ICR7bWVkaWFJZH0sIG1vZGVsOiAke3NlbGVjdGVkTW9kZWwubmFtZX1gKTtcclxuICAgICAgcGl4aW9SZXN1bHQgPSBhd2FpdCBxdWV1ZVBpeGlvUnVuKHJlcXVlc3QsIGFwaUtleSk7XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nKSB7XHJcbiAgICAgIC8vIFVzZSBXYW4gRmlyc3QvTGFzdCBGcmFtZSBtb2RlbFxyXG4gICAgICBzZWxlY3RlZE1vZGVsID0gUElYSU9fTU9ERUxTLndhbkZpcnN0TGFzdEZyYW1lO1xyXG4gICAgICBjb25zdCBpbnB1dHM6IFdhbkZpcnN0TGFzdEZyYW1lSW5wdXRzID0ge1xyXG4gICAgICAgIHN0YXJ0X2ltYWdlOiBzdGFydEltYWdlVXJsISxcclxuICAgICAgICBlbmRfaW1hZ2U6IGVuZEltYWdlVXJsISxcclxuICAgICAgICBwb3NpdGl2ZTogcHJvbXB0LCAvLyBXYW4gdXNlcyAncG9zaXRpdmUnIG5vdCAncHJvbXB0J1xyXG4gICAgICAgIG5lZ2F0aXZlOiAnJyxcclxuICAgICAgICB3aWR0aDogdmlkZW9XaWR0aCxcclxuICAgICAgICBoZWlnaHQ6IHZpZGVvSGVpZ2h0LFxyXG4gICAgICAgIGxlbmd0aDogdmlkZW9MZW5ndGhcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJ1blJlcXVlc3Qoc2VsZWN0ZWRNb2RlbCwgaW5wdXRzLCB7XHJcbiAgICAgICAgd2ViaG9vazogd2ViaG9va1VybCxcclxuICAgICAgICB3ZWJob29rSW50ZXJtZWRpYXRlU3RhdHVzOiBmYWxzZVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDYWxsaW5nIFBpeGlvIEFQSSBmb3IgbWVkaWFJZDogJHttZWRpYUlkfSwgbW9kZWw6ICR7c2VsZWN0ZWRNb2RlbC5uYW1lfWApO1xyXG4gICAgICBwaXhpb1Jlc3VsdCA9IGF3YWl0IHF1ZXVlUGl4aW9SdW4ocmVxdWVzdCwgYXBpS2V5KTtcclxuICAgICAgXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBVbnN1cHBvcnRlZCBnZW5lcmF0aW9uIG1vZGU6ICR7Z2VuZXJhdGlvbk1vZGV9YCk7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1Vuc3VwcG9ydGVkIGdlbmVyYXRpb24gbW9kZScgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA2LiBDaGVjayBQaXhpbyBBUEkgcmVzdWx0XHJcblxyXG4gICAgaWYgKCFwaXhpb1Jlc3VsdC5zdWNjZXNzIHx8ICFwaXhpb1Jlc3VsdC5kYXRhKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIFBpeGlvIEFQSSBlcnJvcjpgLCBwaXhpb1Jlc3VsdC5lcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgcmVjb3JkIHRvIGZhaWxlZFxyXG4gICAgICBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ2dlbmVyYXRlZF9tZWRpYScpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgZXJyb3I6IHBpeGlvUmVzdWx0LmVycm9yIHx8ICdBUEkgcmVxdWVzdCBmYWlsZWQnLFxyXG4gICAgICAgICAgICBmYWlsZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBwaXhpb1Jlc3VsdC5lcnJvciB8fCAnQVBJIHJlcXVlc3QgZmFpbGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJ1bklkID0gcGl4aW9SZXN1bHQuZGF0YS5ydW5faWQ7XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFBpeGlvIEFQSSBydW4gc3RhcnRlZCB3aXRoIElEOiAke3J1bklkfSB1c2luZyBtb2RlbDogJHtzZWxlY3RlZE1vZGVsLm5hbWV9YCk7XHJcblxyXG4gICAgLy8gNy4gVXBkYXRlIHJlY29yZCB3aXRoIHJ1bl9pZCwgbW9kZWwgaW5mbywgYW5kIHByb2Nlc3Npbmcgc3RhdHVzXHJcbiAgICBjb25zdCB7IGVycm9yOiBydW5JZFVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBzdGF0dXM6ICdwcm9jZXNzaW5nJyxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgcnVuX2lkOiBydW5JZCxcclxuICAgICAgICAgIGdlbmVyYXRpb25Nb2RlLFxyXG4gICAgICAgICAgbW9kZWxfaWQ6IHNlbGVjdGVkTW9kZWwuaWQsXHJcbiAgICAgICAgICBtb2RlbF9uYW1lOiBzZWxlY3RlZE1vZGVsLm5hbWUsXHJcbiAgICAgICAgICBzdGFydGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKTtcclxuXHJcbiAgICBpZiAocnVuSWRVcGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBFcnJvciB1cGRhdGluZyByZWNvcmQgd2l0aCBydW5faWQ6YCwgcnVuSWRVcGRhdGVFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gOC4gUmV2YWxpZGF0ZSBwYXRoIHRvIHNob3cgcHJvY2Vzc2luZyBzdGF0ZVxyXG4gICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuXHJcbiAgICAvLyA5LiBSZXR1cm4gc3VjY2VzcyAod2ViaG9vayB3aWxsIGhhbmRsZSBjb21wbGV0aW9uKVxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBpbml0aWF0ZWQgZ2VuZXJhdGlvbiBmb3IgJHttZWRpYUlkfWApO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVkaWFJZDogbWVkaWFJZCB9O1xyXG5cclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbQWN0aW9uXSBFcnJvciBpbiBnZW5lcmF0ZU1lZGlhIGFjdGlvbjonLCBlcnJvcik7XHJcbiAgICAvLyBJZiB0aGUgZXJyb3IgaGFwcGVuZWQgYmVmb3JlIGludm9jYXRpb24gKGUuZy4sIGNyZWRpdCBkZWR1Y3Rpb24pLCByZXR1cm4gZXJyb3JcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENhbmNlbHMgYSBydW5uaW5nIG1lZGlhIGdlbmVyYXRpb25cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYW5jZWxHZW5lcmF0aW9uKG1lZGlhSWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICBpZiAoIW1lZGlhSWQpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01lZGlhIElEIGlzIHJlcXVpcmVkJyB9O1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuXHJcbiAgaWYgKCF1c2VyIHx8IHVzZXJFcnJvcikge1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH07XHJcbiAgfVxyXG5cclxuICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FuY2VsbGluZyBnZW5lcmF0aW9uIGZvciBtZWRpYUlkOiAke21lZGlhSWR9YCk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBGZXRjaCB0aGUgbWVkaWEgcmVjb3JkIHRvIHZlcmlmeSBvd25lcnNoaXAgYW5kIGdldCBydW5faWRcclxuICAgIGNvbnN0IHsgZGF0YTogbWVkaWFSZWNvcmQsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdXNlcl9pZCwgc3RhdHVzLCBtZXRhZGF0YScpXHJcbiAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIW1lZGlhUmVjb3JkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGZldGNoaW5nIG1lZGlhICR7bWVkaWFJZH06YCwgZmV0Y2hFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01lZGlhIHJlY29yZCBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgaWYgKG1lZGlhUmVjb3JkLnVzZXJfaWQgIT09IHVzZXIuaWQpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBbQWN0aW9uXSBVc2VyICR7dXNlci5pZH0gYXR0ZW1wdGVkIHRvIGNhbmNlbCBtZWRpYSAke21lZGlhSWR9IG93bmVkIGJ5ICR7bWVkaWFSZWNvcmQudXNlcl9pZH1gKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnUGVybWlzc2lvbiBkZW5pZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgY2FuY2VsbGFibGVcclxuICAgIGlmICghWydwZW5kaW5nJywgJ3Byb2Nlc3NpbmcnXS5pbmNsdWRlcyhtZWRpYVJlY29yZC5zdGF0dXMpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogYENhbm5vdCBjYW5jZWwgJHttZWRpYVJlY29yZC5zdGF0dXN9IGdlbmVyYXRpb25gIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IHJ1bl9pZCBmcm9tIG1ldGFkYXRhXHJcbiAgICBjb25zdCBydW5JZCA9IChtZWRpYVJlY29yZC5tZXRhZGF0YSBhcyBhbnkpPy5ydW5faWQ7XHJcbiAgICBcclxuICAgIGlmICghcnVuSWQpIHtcclxuICAgICAgLy8gTm8gcnVuX2lkIHlldCwganVzdCB1cGRhdGUgc3RhdHVzIHRvIGZhaWxlZFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gTm8gcnVuX2lkIGZvciAke21lZGlhSWR9LCBtYXJraW5nIGFzIGNhbmNlbGxlZCBsb2NhbGx5YCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgc3RhdHVzOiAnZmFpbGVkJyxcclxuICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgIC4uLihtZWRpYVJlY29yZC5tZXRhZGF0YSBhcyBvYmplY3QgfHwge30pLFxyXG4gICAgICAgICAgICBlcnJvcjogJ0NhbmNlbGxlZCBieSB1c2VyJyxcclxuICAgICAgICAgICAgY2FuY2VsbGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKTtcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIHVwZGF0aW5nIGNhbmNlbGxlZCBzdGF0dXM6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byBjYW5jZWwgZ2VuZXJhdGlvbicgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGwgUGl4aW8gQVBJIHRvIGNhbmNlbCB0aGUgcnVuIHVzaW5nIHRoZSBjbGllbnRcclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDYWxsaW5nIFBpeGlvIEFQSSB0byBjYW5jZWwgcnVuOiAke3J1bklkfWApO1xyXG4gICAgXHJcbiAgICBjb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5QSVhJT19ERVBMT1lfQVBJX0tFWTtcclxuICAgIGlmICghYXBpS2V5KSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0FQSSBrZXkgbm90IGNvbmZpZ3VyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2FuY2VsUmVzdWx0ID0gYXdhaXQgY2FuY2VsUGl4aW9SdW4ocnVuSWQsIGFwaUtleSk7XHJcblxyXG4gICAgLy8gTm90ZTogRXZlbiBpZiB0aGUgY2FuY2VsIEFQSSBjYWxsIGZhaWxzLCB3ZSBzdGlsbCBtYXJrIGl0IGFzIGNhbmNlbGxlZCBsb2NhbGx5XHJcbiAgICBpZiAoIWNhbmNlbFJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihgW0FjdGlvbl0gUGl4aW8gY2FuY2VsIEFQSSBmYWlsZWQ6ICR7Y2FuY2VsUmVzdWx0LmVycm9yfSwgYnV0IGNvbnRpbnVpbmcgd2l0aCBsb2NhbCBjYW5jZWxsYXRpb25gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgZGF0YWJhc2UgdG8gY2FuY2VsbGVkL2ZhaWxlZCBzdGF0dXNcclxuICAgIGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAuLi4obWVkaWFSZWNvcmQubWV0YWRhdGEgYXMgb2JqZWN0IHx8IHt9KSxcclxuICAgICAgICAgIGVycm9yOiAnQ2FuY2VsbGVkIGJ5IHVzZXInLFxyXG4gICAgICAgICAgY2FuY2VsbGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICBjYW5jZWxfYXBpX3N0YXR1czogY2FuY2VsUmVzdWx0LnN1Y2Nlc3MgPyAnc3VjY2VzcycgOiAnZmFpbGVkJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbQWN0aW9uXSBFcnJvciB1cGRhdGluZyBjYW5jZWxsZWQgc3RhdHVzOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRmFpbGVkIHRvIHVwZGF0ZSBjYW5jZWxsYXRpb24gc3RhdHVzJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBTdWNjZXNzZnVsbHkgY2FuY2VsbGVkIGdlbmVyYXRpb24gJHttZWRpYUlkfWApO1xyXG4gICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihgW0FjdGlvbl0gRXJyb3IgY2FuY2VsbGluZyBnZW5lcmF0aW9uICR7bWVkaWFJZH06YCwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRGVsZXRlcyBhIG1lZGlhIGl0ZW0gcmVjb3JkIGFuZCBpdHMgYXNzb2NpYXRlZCBmaWxlIGZyb20gc3RvcmFnZS5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVNZWRpYShtZWRpYUlkOiBzdHJpbmcsIHN0b3JhZ2VQYXRoOiBzdHJpbmcgfCBudWxsKTogUHJvbWlzZTx7XHJcbiAgICBzdWNjZXNzOiBib29sZWFuO1xyXG4gICAgZXJyb3I/OiBzdHJpbmc7XHJcbiAgfT4ge1xyXG4gICAgaWYgKCFtZWRpYUlkKSB7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJNZWRpYSBJRCBpcyByZXF1aXJlZC5cIiB9OyB9XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpOyAvLyBVc2Ugc2VydmVyIGNsaWVudCB0byBnZXQgdXNlclxyXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcbiAgICBpZiAoIXVzZXIgfHwgdXNlckVycm9yKSB7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIGVycm9yJyB9OyB9XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIERlbGV0aW5nIG1lZGlhICR7bWVkaWFJZH0gKHBhdGg6ICR7c3RvcmFnZVBhdGggfHwgJ04vQSd9KSBmb3IgdXNlciAke3VzZXIuaWR9YCk7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBWZXJpZnkgb3duZXJzaGlwIHVzaW5nIGFkbWluIGNsaWVudFxyXG4gICAgICBjb25zdCB7IGRhdGE6IG1lZGlhUmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKS5zZWxlY3QoJ2lkLCB1c2VyX2lkLCBzdG9yYWdlX3BhdGgnKS5lcSgnaWQnLCBtZWRpYUlkKS5zaW5nbGUoKTtcclxuICAgICAgaWYgKGZldGNoRXJyb3IgfHwgIW1lZGlhUmVjb3JkKSB7IGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGZldGNoaW5nIG1lZGlhICR7bWVkaWFJZH0gZm9yIGRlbGV0aW9uIG9yIG5vdCBmb3VuZDpgLCBmZXRjaEVycm9yKTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWVkaWEgcmVjb3JkIG5vdCBmb3VuZC4nIH07IH1cclxuICAgICAgaWYgKG1lZGlhUmVjb3JkLnVzZXJfaWQgIT09IHVzZXIuaWQpIHsgY29uc29sZS53YXJuKGBbQWN0aW9uXSBVc2VyICR7dXNlci5pZH0gYXR0ZW1wdGVkIHRvIGRlbGV0ZSBtZWRpYSAke21lZGlhSWR9IG93bmVkIGJ5ICR7bWVkaWFSZWNvcmQudXNlcl9pZH0uIERlbnlpbmcuYCk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1Blcm1pc3Npb24gZGVuaWVkLicgfTsgfVxyXG5cclxuICAgICAgY29uc3QgYWN0dWFsU3RvcmFnZVBhdGggPSBtZWRpYVJlY29yZC5zdG9yYWdlX3BhdGg7XHJcblxyXG4gICAgICAvLyBEZWxldGUgZnJvbSBTdG9yYWdlICpvbmx5IGlmIHBhdGggZXhpc3RzKiB1c2luZyB0aGUgc2VydmljZSBmdW5jdGlvblxyXG4gICAgICBpZiAoYWN0dWFsU3RvcmFnZVBhdGgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBzZXJ2aWNlIHRvIGRlbGV0ZSBmaWxlIGZyb20gc3RvcmFnZTogJHthY3R1YWxTdG9yYWdlUGF0aH1gKTtcclxuICAgICAgICBjb25zdCB7IHN1Y2Nlc3M6IGRlbGV0ZVN1Y2Nlc3MsIGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgZGVsZXRlRmlsZVNlcnZpY2UoYWN0dWFsU3RvcmFnZVBhdGgpOyAvLyBVc2Ugc3RvcmFnZSBzZXJ2aWNlXHJcbiAgICAgICAgaWYgKCFkZWxldGVTdWNjZXNzKSB7IGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGRlbGV0aW5nIGZpbGUgJHthY3R1YWxTdG9yYWdlUGF0aH0gZnJvbSBzdG9yYWdlIChjb250aW51aW5nKTpgLCBkZWxldGVFcnJvcik7IH1cclxuICAgICAgICBlbHNlIHsgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBkZWxldGVkIGZpbGUgJHthY3R1YWxTdG9yYWdlUGF0aH0gdmlhIHNlcnZpY2UuYCk7IH1cclxuICAgICAgfSBlbHNlIHsgY29uc29sZS5sb2coYFtBY3Rpb25dIE5vIHN0b3JhZ2UgcGF0aCBmb3IgbWVkaWEgJHttZWRpYUlkfSwgc2tpcHBpbmcgc3RvcmFnZSBkZWxldGlvbi5gKTsgfVxyXG5cclxuICAgICAgLy8gRGVsZXRlIGZyb20gRGF0YWJhc2UgdXNpbmcgYWRtaW4gY2xpZW50XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBEZWxldGluZyByZWNvcmQgZnJvbSBkYXRhYmFzZTogJHttZWRpYUlkfWApO1xyXG4gICAgICBjb25zdCB7IGVycm9yOiBkYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmZyb20oJ2dlbmVyYXRlZF9tZWRpYScpLmRlbGV0ZSgpLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG4gICAgICBpZiAoZGJFcnJvcikgeyBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBFcnJvciBkZWxldGluZyByZWNvcmQgJHttZWRpYUlkfSBmcm9tIGRhdGFiYXNlOmAsIGRiRXJyb3IpOyB0aHJvdyBuZXcgRXJyb3IoYERhdGFiYXNlIGRlbGV0aW9uIGZhaWxlZDogJHtkYkVycm9yLm1lc3NhZ2V9YCk7IH1cclxuICAgICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBkZWxldGVkIHJlY29yZCAke21lZGlhSWR9IGZyb20gZGF0YWJhc2UuYCk7XHJcblxyXG4gICAgICByZXZhbGlkYXRlUGF0aCgnL2Rhc2hib2FyZCcpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIFVuZXhwZWN0ZWQgZXJyb3IgZHVyaW5nIG1lZGlhIGRlbGV0aW9uIGZvciAke21lZGlhSWR9OmAsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaGVzIGNvbXBsZXRlZCBhbmQgcHJvY2Vzc2luZyBtZWRpYSBpdGVtcyBmb3IgdGhlIGN1cnJlbnQgdXNlci5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaFVzZXJNZWRpYSgpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIG1lZGlhOiBHZW5lcmF0ZWRNZWRpYVtdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTsgLy8gVXNlcyBzZXJ2ZXIgY2xpZW50XHJcbiAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcbiAgaWYgKCF1c2VyIHx8IHVzZXJFcnJvcikgeyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvcicsIG1lZGlhOiBbXSB9OyB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBVc2UgdXNlci1jb250ZXh0IGNsaWVudCBmb3IgUkxTXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnZ2VuZXJhdGVkX21lZGlhJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpXHJcbiAgICAgIC5pbignc3RhdHVzJywgWydwZW5kaW5nJywgJ3Byb2Nlc3NpbmcnLCAnY29tcGxldGVkJywgJ2ZhaWxlZCddKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDUwKTsgLy8gQWRqdXN0IGxpbWl0IGFzIG5lZWRlZFxyXG5cclxuICAgIGlmIChlcnJvcikgeyB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBtZWRpYTogJHtlcnJvci5tZXNzYWdlfWApOyB9XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZWRpYTogZGF0YSB8fCBbXSwgZXJyb3I6IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIGZldGNoaW5nIHVzZXIgbWVkaWE6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlLCBtZWRpYTogW10gfTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXJ2ZXIgQWN0aW9uIHRvIGxpc3QgdXNlcidzIGdlbmVyYXRlZCBpbWFnZXMgYW5kIGlucHV0IGltYWdlcyBmb3Igc2VsZWN0aW9uLlxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3RVc2VySW1hZ2VzRm9yU2VsZWN0aW9uKCk6IFByb21pc2U8e1xyXG4gICAgc3VjY2VzczogYm9vbGVhbjtcclxuICAgIGltYWdlczogeyB2YWx1ZTogc3RyaW5nOyBsYWJlbDogc3RyaW5nOyB0eXBlOiAnZ2VuZXJhdGVkJyB8ICdpbnB1dCcgfVtdO1xyXG4gICAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7IC8vIFVzZSBzZXJ2ZXIgY2xpZW50IHRvIGdldCB1c2VyXHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuICAgIGlmICghdXNlciB8fCB1c2VyRXJyb3IpIHsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGltYWdlczogW10sIGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH07IH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IFtnZW5lcmF0ZWRSZXN1bHQsIGlucHV0UmVzdWx0XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICAgICAgLy8gRmV0Y2ggY29tcGxldGVkIGdlbmVyYXRlZCBpbWFnZXMgdXNpbmcgUkxTLWVuYWJsZWQgY2xpZW50XHJcbiAgICAgICAgICAgIHN1cGFiYXNlXHJcbiAgICAgICAgICAgICAgICAuZnJvbSgnZ2VuZXJhdGVkX21lZGlhJylcclxuICAgICAgICAgICAgICAgIC5zZWxlY3QoJ2lkLCBwcm9tcHQsIG1lZGlhX3VybCcpXHJcbiAgICAgICAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxyXG4gICAgICAgICAgICAgICAgLmVxKCdtZWRpYV90eXBlJywgJ2ltYWdlJylcclxuICAgICAgICAgICAgICAgIC5lcSgnc3RhdHVzJywgJ2NvbXBsZXRlZCcpXHJcbiAgICAgICAgICAgICAgICAubm90KCdtZWRpYV91cmwnLCAnaXMnLCBudWxsKVxyXG4gICAgICAgICAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgICAgICAgICAgICAubGltaXQoNTApLCAvLyBMaW1pdCBnZW5lcmF0ZWQgaW1hZ2VzIHNob3duXHJcbiAgICAgICAgICAgIC8vIEZldGNoIGlucHV0IGltYWdlcyB1c2luZyB0aGUgc2VydmljZSBmdW5jdGlvbiAodXNlcyBhZG1pbiBjbGllbnQpXHJcbiAgICAgICAgICAgIGxpc3RVc2VyRmlsZXNTZXJ2aWNlKHVzZXIuaWQsICdpbnB1dHMnKVxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICBjb25zdCBmZXRjaGVkSW1hZ2VzOiB7IHZhbHVlOiBzdHJpbmc7IGxhYmVsOiBzdHJpbmc7IHR5cGU6ICdnZW5lcmF0ZWQnIHwgJ2lucHV0JyB9W10gPSBbXTtcclxuXHJcbiAgICAgICAgLy8gUHJvY2VzcyBnZW5lcmF0ZWQgaW1hZ2VzXHJcbiAgICAgICAgaWYgKGdlbmVyYXRlZFJlc3VsdC5lcnJvcikgeyBjb25zb2xlLmVycm9yKFwiW0FjdGlvbl0gRXJyb3IgZmV0Y2hpbmcgZ2VuZXJhdGVkIGltYWdlczpcIiwgZ2VuZXJhdGVkUmVzdWx0LmVycm9yKTsgfVxyXG4gICAgICAgIGVsc2UgaWYgKGdlbmVyYXRlZFJlc3VsdC5kYXRhKSB7IGdlbmVyYXRlZFJlc3VsdC5kYXRhLmZvckVhY2goaXRlbSA9PiB7IGZldGNoZWRJbWFnZXMucHVzaCh7IHZhbHVlOiBpdGVtLm1lZGlhX3VybCEsIGxhYmVsOiBpdGVtLnByb21wdCA/IGBHZW46ICR7aXRlbS5wcm9tcHQuc3Vic3RyaW5nKDAsIDMwKX0uLi5gIDogYEdlbmVyYXRlZCBJbWFnZSAke2l0ZW0uaWQuc3Vic3RyaW5nKDAsIDYpfWAsIHR5cGU6ICdnZW5lcmF0ZWQnLCB9KTsgfSk7IH1cclxuXHJcbiAgICAgICAgLy8gUHJvY2VzcyBpbnB1dCBpbWFnZXNcclxuICAgICAgICBpZiAoIWlucHV0UmVzdWx0LnN1Y2Nlc3MpIHsgY29uc29sZS5lcnJvcihcIltBY3Rpb25dIEVycm9yIGZldGNoaW5nIGlucHV0IGltYWdlczpcIiwgaW5wdXRSZXN1bHQuZXJyb3IpOyB9XHJcbiAgICAgICAgZWxzZSBpZiAoaW5wdXRSZXN1bHQuZmlsZXMpIHsgaW5wdXRSZXN1bHQuZmlsZXMuZm9yRWFjaChmaWxlID0+IHsgaWYgKGZpbGUucHVibGljVXJsICYmIC9cXC4oanBnfGpwZWd8cG5nfHdlYnB8Z2lmKSQvaS50ZXN0KGZpbGUubmFtZSkpIHsgZmV0Y2hlZEltYWdlcy5wdXNoKHsgdmFsdWU6IGZpbGUucHVibGljVXJsLCBsYWJlbDogYElucHV0OiAke2ZpbGUubmFtZX1gLCB0eXBlOiAnaW5wdXQnLCB9KTsgfSB9KTsgfVxyXG5cclxuICAgICAgICBmZXRjaGVkSW1hZ2VzLnNvcnQoKGEsIGIpID0+IGEubGFiZWwubG9jYWxlQ29tcGFyZShiLmxhYmVsKSk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgaW1hZ2VzOiBmZXRjaGVkSW1hZ2VzIH07XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIGxpc3RpbmcgdXNlciBpbWFnZXM6JywgZXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBpbWFnZXM6IFtdLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG59XHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiZ1RBNkJzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/apps/web/src/lib/actions/data:d445a6 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"00716ddf84ea8b40fabb4c616285e6d496c288aee9":"listUserImagesForSelection"},"apps/web/src/lib/actions/media.actions.ts",""] */ __turbopack_context__.s({
    "listUserImagesForSelection": (()=>listUserImagesForSelection)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var listUserImagesForSelection = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("00716ddf84ea8b40fabb4c616285e6d496c288aee9", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "listUserImagesForSelection"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vbWVkaWEuYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL2FjdGlvbnMvbWVkaWEuYWN0aW9ucy50c1xyXG4ndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAcmVwby9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyB1c2VDcmVkaXRzIH0gZnJvbSAnQC9saWIvY3JlZGl0cyc7XHJcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSAnbmV4dC9jYWNoZSc7XHJcbmltcG9ydCB7IE1lZGlhVHlwZSwgQ1JFRElUX0NPU1RTLCBHZW5lcmF0aW9uUmVzdWx0LCBHZW5lcmF0aW9uTW9kZSB9IGZyb20gJ0AvbGliL2NvbnN0YW50cy9tZWRpYSc7XHJcbi8vIEltcG9ydCB0aGUgc3BlY2lmaWMgSW5zZXJ0IHR5cGUgYW5kIEdlbmVyYXRlZE1lZGlhIHR5cGVcclxuaW1wb3J0IHsgRGF0YWJhc2UsIEdlbmVyYXRlZE1lZGlhIH0gZnJvbSAnQC90eXBlcy9kYl90eXBlcyc7XHJcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAcmVwby9zdXBhYmFzZS9hZG1pbic7XHJcbi8vIEltcG9ydCBvbmx5IHRoZSBuZWNlc3Nhcnkgc3RvcmFnZSBzZXJ2aWNlIGZ1bmN0aW9ucyAodXNlZCBieSBhY3Rpb25zIGJlbG93KVxyXG5pbXBvcnQgeyBsaXN0VXNlckZpbGVzIGFzIGxpc3RVc2VyRmlsZXNTZXJ2aWNlLCBkZWxldGVGaWxlIGFzIGRlbGV0ZUZpbGVTZXJ2aWNlIH0gZnJvbSAnQC9saWIvc3RvcmFnZS9zdXBhYmFzZS1zdG9yYWdlJztcclxuLy8gSW1wb3J0IFBpeGlvIEFQSSBjbGllbnQgYW5kIG1vZGVsc1xyXG5pbXBvcnQge1xyXG4gIFBJWElPX01PREVMUyxcclxuICBxdWV1ZVBpeGlvUnVuLFxyXG4gIGNhbmNlbFBpeGlvUnVuLFxyXG4gIGNyZWF0ZVJ1blJlcXVlc3QsXHJcbiAgdHlwZSBLcmVhRmx1eElucHV0cyxcclxuICB0eXBlIFdhbkZpcnN0TGFzdEZyYW1lSW5wdXRzXHJcbn0gZnJvbSAnQHJlcG8vcGl4aW8tYXBpJztcclxuXHJcbi8vIERlZmluZSB0aGUgc3BlY2lmaWMgdHlwZSBmb3IgaW5zZXJ0aW9uLCBkZXJpdmVkIGZyb20gZGJfdHlwZXMudHNcclxudHlwZSBHZW5lcmF0ZWRNZWRpYUluc2VydCA9IERhdGFiYXNlWydwdWJsaWMnXVsnVGFibGVzJ11bJ2dlbmVyYXRlZF9tZWRpYSddWydJbnNlcnQnXTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWF0ZXMgbWVkaWEgZ2VuZXJhdGlvbiBieSBjcmVhdGluZyBhIHJlY29yZCBhbmQgaW52b2tpbmcgdGhlIFN1cGFiYXNlIEZ1bmN0aW9uLlxyXG4gKiBFeHBlY3RzIGltYWdlIFVSTHMgZm9yIG1vZGVzIHRoYXQgcmVxdWlyZSBpbnB1dCBpbWFnZXMgKGNsaWVudCBoYW5kbGVzIHVwbG9hZCkuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZWRpYShmb3JtRGF0YTogRm9ybURhdGEpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIG1lZGlhSWQ/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG4gIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiB1c2VyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xyXG5cclxuICBpZiAoIXVzZXIgfHwgdXNlckVycm9yKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvcicgfTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBSZWFkIGRhdGEgZnJvbSBGb3JtRGF0YSAtLS1cclxuICBjb25zdCBnZW5lcmF0aW9uTW9kZSA9IGZvcm1EYXRhLmdldCgnZ2VuZXJhdGlvbk1vZGUnKSBhcyBHZW5lcmF0aW9uTW9kZTtcclxuICBcclxuICAvLyBEZXRlcm1pbmUgbWVkaWEgdHlwZSBiYXNlZCBvbiBtb2RlbCBjYXRlZ29yeSwgbm90IGdlbmVyYXRpb24gbW9kZSBuYW1lXHJcbiAgY29uc3QgbWVkaWFUeXBlOiBNZWRpYVR5cGUgPSBnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nID8gJ3ZpZGVvJyA6ICdpbWFnZSc7XHJcbiAgLy8gS3JlYSBGbHV4IChpbWFnZSBtb2RlKSDihpIgaW1hZ2VcclxuICAvLyBRd2VuIEVkaXQgKHZpZGVvIG1vZGUpIOKGkiBpbWFnZSAoaXQncyBlZGl0aW5nLCBub3QgZ2VuZXJhdGluZyB2aWRlbylcclxuICAvLyBXYW4gMi4yIChmaXJzdExhc3RGcmFtZVZpZGVvIG1vZGUpIOKGkiB2aWRlb1xyXG5cclxuICAvLyAtLS0gVmFsaWRhdGlvbiAtLS1cclxuICBpZiAoIWdlbmVyYXRpb25Nb2RlKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycgfTtcclxuICB9XHJcblxyXG4gIC8vIE1vZGUtc3BlY2lmaWMgaW5wdXQgZXh0cmFjdGlvbiBhbmQgdmFsaWRhdGlvblxyXG4gIGxldCBwcm9tcHQgPSAnJztcclxuICBsZXQgc3RhcnRJbWFnZVVybDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgbGV0IGVuZEltYWdlVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UxVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UyVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UzVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgcG9zaXRpdmVQcm9tcHQgPSAnJztcclxuICBsZXQgbmVnYXRpdmVQcm9tcHQgPSAnJztcclxuICBsZXQgd2lkdGggPSAxMDI0O1xyXG4gIGxldCBoZWlnaHQgPSAxMDI0O1xyXG4gIGxldCB2aWRlb1dpZHRoID0gNTEyO1xyXG4gIGxldCB2aWRlb0hlaWdodCA9IDUxMjtcclxuICBsZXQgdmlkZW9MZW5ndGggPSA4MTtcclxuXHJcbiAgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnaW1hZ2UnKSB7XHJcbiAgICAvLyBLcmVhIEZsdXhcclxuICAgIHByb21wdCA9IGZvcm1EYXRhLmdldCgncHJvbXB0JykgYXMgc3RyaW5nO1xyXG4gICAgd2lkdGggPSBwYXJzZUludChmb3JtRGF0YS5nZXQoJ3dpZHRoJykgYXMgc3RyaW5nKSB8fCAxMDI0O1xyXG4gICAgaGVpZ2h0ID0gcGFyc2VJbnQoZm9ybURhdGEuZ2V0KCdoZWlnaHQnKSBhcyBzdHJpbmcpIHx8IDEwMjQ7XHJcbiAgICBpZiAoIXByb21wdD8udHJpbSgpKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHByb21wdCcgfTtcclxuICB9IGVsc2UgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAndmlkZW8nKSB7XHJcbiAgICAvLyBRd2VuIEVkaXRcclxuICAgIGltYWdlMVVybCA9IGZvcm1EYXRhLmdldCgnaW1hZ2UxVXJsJykgYXMgc3RyaW5nO1xyXG4gICAgaW1hZ2UyVXJsID0gZm9ybURhdGEuZ2V0KCdpbWFnZTJVcmwnKSBhcyBzdHJpbmcgfHwgbnVsbDtcclxuICAgIGltYWdlM1VybCA9IGZvcm1EYXRhLmdldCgnaW1hZ2UzVXJsJykgYXMgc3RyaW5nIHx8IG51bGw7XHJcbiAgICBwb3NpdGl2ZVByb21wdCA9IGZvcm1EYXRhLmdldCgncG9zaXRpdmVQcm9tcHQnKSBhcyBzdHJpbmcgfHwgJyc7XHJcbiAgICBuZWdhdGl2ZVByb21wdCA9IGZvcm1EYXRhLmdldCgnbmVnYXRpdmVQcm9tcHQnKSBhcyBzdHJpbmcgfHwgJyc7XHJcbiAgICBpZiAoIWltYWdlMVVybCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWlzc2luZyBpbWFnZSBmb3IgZWRpdGluZycgfTtcclxuICB9IGVsc2UgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnZmlyc3RMYXN0RnJhbWVWaWRlbycpIHtcclxuICAgIC8vIFdhbiAyLjJcclxuICAgIHByb21wdCA9IGZvcm1EYXRhLmdldCgncHJvbXB0JykgYXMgc3RyaW5nO1xyXG4gICAgc3RhcnRJbWFnZVVybCA9IGZvcm1EYXRhLmdldCgnc3RhcnRJbWFnZVVybCcpIGFzIHN0cmluZztcclxuICAgIGVuZEltYWdlVXJsID0gZm9ybURhdGEuZ2V0KCdlbmRJbWFnZVVybCcpIGFzIHN0cmluZztcclxuICAgIHZpZGVvV2lkdGggPSBwYXJzZUludChmb3JtRGF0YS5nZXQoJ3dpZHRoJykgYXMgc3RyaW5nKSB8fCA1MTI7XHJcbiAgICB2aWRlb0hlaWdodCA9IHBhcnNlSW50KGZvcm1EYXRhLmdldCgnaGVpZ2h0JykgYXMgc3RyaW5nKSB8fCA1MTI7XHJcbiAgICB2aWRlb0xlbmd0aCA9IHBhcnNlSW50KGZvcm1EYXRhLmdldCgnbGVuZ3RoJykgYXMgc3RyaW5nKSB8fCA4MTtcclxuICAgIGlmICghcHJvbXB0Py50cmltKCkpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgcHJvbXB0JyB9O1xyXG4gICAgaWYgKCFzdGFydEltYWdlVXJsKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHN0YXJ0IGltYWdlIFVSTCcgfTtcclxuICAgIGlmICghZW5kSW1hZ2VVcmwpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgZW5kIGltYWdlIFVSTCcgfTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNyZWRpdENvc3QgPSBDUkVESVRfQ09TVFNbZ2VuZXJhdGlvbk1vZGVdO1xyXG4gIGlmIChjcmVkaXRDb3N0ID09PSB1bmRlZmluZWQpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZ2VuZXJhdGlvbiBtb2RlJyB9O1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIDEuIENoZWNrIGFuZCBkZWR1Y3QgY3JlZGl0c1xyXG4gICAgY29uc3QgY3JlZGl0U3VjY2VzcyA9IGF3YWl0IHVzZUNyZWRpdHMoXHJcbiAgICAgIHVzZXIuaWQsXHJcbiAgICAgIGNyZWRpdENvc3QsXHJcbiAgICAgIGBHZW5lcmF0ZSAke2dlbmVyYXRpb25Nb2RlfTogXCIke3Byb21wdC5zbGljZSgwLCAzMCl9JHtwcm9tcHQubGVuZ3RoID4gMzAgPyAnLi4uJyA6ICcnfVwiYFxyXG4gICAgKTtcclxuICAgIGlmICghY3JlZGl0U3VjY2VzcykgeyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOb3QgZW5vdWdoIGNyZWRpdHMnIH07IH1cclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDcmVkaXRzIGRlZHVjdGVkIHN1Y2Nlc3NmdWxseSBmb3IgdXNlciAke3VzZXIuaWR9YCk7XHJcblxyXG4gICAgLy8gMi4gQ3JlYXRlIGluaXRpYWwgJ3BlbmRpbmcnIHJlY29yZCBpbiBEQlxyXG4gICAgY29uc3QgaW5zZXJ0UGF5bG9hZDogR2VuZXJhdGVkTWVkaWFJbnNlcnQgPSB7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcclxuICAgICAgICBwcm9tcHQ6IHByb21wdCB8fCBwb3NpdGl2ZVByb21wdCB8fCAnSW1hZ2UgZWRpdCcsIC8vIFVzZSBhcHByb3ByaWF0ZSBwcm9tcHRcclxuICAgICAgICBtZWRpYV90eXBlOiBtZWRpYVR5cGUsXHJcbiAgICAgICAgY3JlZGl0c191c2VkOiBjcmVkaXRDb3N0LFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIG1lZGlhX3VybDogJycsIC8vIFJlcXVpcmVkIGJ5IEluc2VydCB0eXBlXHJcbiAgICAgICAgc3RvcmFnZV9wYXRoOiAnJywgLy8gUmVxdWlyZWQgYnkgSW5zZXJ0IHR5cGVcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgZ2VuZXJhdGlvbk1vZGUsXHJcbiAgICAgICAgICAuLi4oZ2VuZXJhdGlvbk1vZGUgPT09ICdpbWFnZScgJiYgeyB3aWR0aCwgaGVpZ2h0IH0pLFxyXG4gICAgICAgICAgLi4uKHBvc2l0aXZlUHJvbXB0ICYmIHsgcG9zaXRpdmVQcm9tcHQsIG5lZ2F0aXZlUHJvbXB0IH0pXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nKSB7XHJcbiAgICAgICAgaW5zZXJ0UGF5bG9hZC5zdGFydF9pbWFnZV91cmwgPSBzdGFydEltYWdlVXJsO1xyXG4gICAgICAgIGluc2VydFBheWxvYWQuZW5kX2ltYWdlX3VybCA9IGVuZEltYWdlVXJsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdNZWRpYVJlY29yZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKS5pbnNlcnQoaW5zZXJ0UGF5bG9hZCkuc2VsZWN0KCdpZCcpLnNpbmdsZSgpO1xyXG4gICAgaWYgKGluc2VydEVycm9yIHx8ICFuZXdNZWRpYVJlY29yZCkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiW0FjdGlvbl0gRmFpbGVkIHRvIGluc2VydCBpbml0aWFsIG1lZGlhIHJlY29yZDpcIiwgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBUT0RPOiBDb25zaWRlciByZWZ1bmRpbmcgY3JlZGl0cyBoZXJlIGlmIGluc2VydCBmYWlscyBhZnRlciBkZWR1Y3Rpb25cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBgRmFpbGVkIHRvIGNyZWF0ZSBnZW5lcmF0aW9uIHJlY29yZDogJHtpbnNlcnRFcnJvcj8ubWVzc2FnZX1gIH07XHJcbiAgICB9XHJcbiAgICBjb25zdCBtZWRpYUlkID0gbmV3TWVkaWFSZWNvcmQuaWQ7XHJcbiAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gSW5pdGlhbCBtZWRpYSByZWNvcmQgY3JlYXRlZCB3aXRoIElEOiAke21lZGlhSWR9YCk7XHJcblxyXG4gICAgLy8gMy4gUHJlcGFyZSB3ZWJob29rIFVSTCBmb3IgUGl4aW8gQVBJIGNhbGxiYWNrc1xyXG4gICAgY29uc3Qgd2ViaG9va1VybCA9IGAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NJVEVfVVJMfS9hcGkvd2ViaG9va3MvcGl4aW9gO1xyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFVzaW5nIHdlYmhvb2sgVVJMOiAke3dlYmhvb2tVcmx9YCk7XHJcblxyXG4gICAgLy8gNC4gR2V0IEFQSSBrZXlcclxuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlBJWElPX0RFUExPWV9BUElfS0VZO1xyXG4gICAgaWYgKCFhcGlLZXkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignW0FjdGlvbl0gUElYSU9fREVQTE9ZX0FQSV9LRVkgbm90IGNvbmZpZ3VyZWQnKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQVBJIGtleSBub3QgY29uZmlndXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA1LiBTZWxlY3QgbW9kZWwgYW5kIGNhbGwgUGl4aW8gQVBJIGJhc2VkIG9uIGdlbmVyYXRpb24gbW9kZVxyXG4gICAgbGV0IHBpeGlvUmVzdWx0O1xyXG4gICAgbGV0IHNlbGVjdGVkTW9kZWw7XHJcblxyXG4gICAgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnaW1hZ2UnKSB7XHJcbiAgICAgIC8vIFVzZSBLcmVhIEZsdXggbW9kZWxcclxuICAgICAgc2VsZWN0ZWRNb2RlbCA9IFBJWElPX01PREVMUy5rcmVhRmx1eDtcclxuICAgICAgY29uc3QgaW5wdXRzOiBLcmVhRmx1eElucHV0cyA9IHtcclxuICAgICAgICB0ZXh0OiBwcm9tcHQsXHJcbiAgICAgICAgd2lkdGgsXHJcbiAgICAgICAgaGVpZ2h0XHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSdW5SZXF1ZXN0KHNlbGVjdGVkTW9kZWwsIGlucHV0cywge1xyXG4gICAgICAgIHdlYmhvb2s6IHdlYmhvb2tVcmwsXHJcbiAgICAgICAgd2ViaG9va0ludGVybWVkaWF0ZVN0YXR1czogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBQaXhpbyBBUEkgZm9yIG1lZGlhSWQ6ICR7bWVkaWFJZH0sIG1vZGVsOiAke3NlbGVjdGVkTW9kZWwubmFtZX1gKTtcclxuICAgICAgcGl4aW9SZXN1bHQgPSBhd2FpdCBxdWV1ZVBpeGlvUnVuKHJlcXVlc3QsIGFwaUtleSk7XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ3ZpZGVvJykge1xyXG4gICAgICAvLyBVc2UgUXdlbiBFZGl0IG1vZGVsXHJcbiAgICAgIHNlbGVjdGVkTW9kZWwgPSBQSVhJT19NT0RFTFMucXdlbkVkaXQ7XHJcbiAgICAgIGNvbnN0IGlucHV0czogaW1wb3J0KCdAcmVwby9waXhpby1hcGknKS5Rd2VuRWRpdElucHV0cyA9IHtcclxuICAgICAgICBpbWFnZTE6IGltYWdlMVVybCEsXHJcbiAgICAgICAgcG9zaXRpdmU6IHBvc2l0aXZlUHJvbXB0LFxyXG4gICAgICAgIG5lZ2F0aXZlOiBuZWdhdGl2ZVByb21wdCxcclxuICAgICAgICAuLi4oaW1hZ2UyVXJsICYmIHsgaW1hZ2UyOiBpbWFnZTJVcmwgfSksXHJcbiAgICAgICAgLi4uKGltYWdlM1VybCAmJiB7IGltYWdlMzogaW1hZ2UzVXJsIH0pXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSdW5SZXF1ZXN0KHNlbGVjdGVkTW9kZWwsIGlucHV0cywge1xyXG4gICAgICAgIHdlYmhvb2s6IHdlYmhvb2tVcmwsXHJcbiAgICAgICAgd2ViaG9va0ludGVybWVkaWF0ZVN0YXR1czogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBQaXhpbyBBUEkgZm9yIG1lZGlhSWQ6ICR7bWVkaWFJZH0sIG1vZGVsOiAke3NlbGVjdGVkTW9kZWwubmFtZX1gKTtcclxuICAgICAgcGl4aW9SZXN1bHQgPSBhd2FpdCBxdWV1ZVBpeGlvUnVuKHJlcXVlc3QsIGFwaUtleSk7XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nKSB7XHJcbiAgICAgIC8vIFVzZSBXYW4gRmlyc3QvTGFzdCBGcmFtZSBtb2RlbFxyXG4gICAgICBzZWxlY3RlZE1vZGVsID0gUElYSU9fTU9ERUxTLndhbkZpcnN0TGFzdEZyYW1lO1xyXG4gICAgICBjb25zdCBpbnB1dHM6IFdhbkZpcnN0TGFzdEZyYW1lSW5wdXRzID0ge1xyXG4gICAgICAgIHN0YXJ0X2ltYWdlOiBzdGFydEltYWdlVXJsISxcclxuICAgICAgICBlbmRfaW1hZ2U6IGVuZEltYWdlVXJsISxcclxuICAgICAgICBwb3NpdGl2ZTogcHJvbXB0LCAvLyBXYW4gdXNlcyAncG9zaXRpdmUnIG5vdCAncHJvbXB0J1xyXG4gICAgICAgIG5lZ2F0aXZlOiAnJyxcclxuICAgICAgICB3aWR0aDogdmlkZW9XaWR0aCxcclxuICAgICAgICBoZWlnaHQ6IHZpZGVvSGVpZ2h0LFxyXG4gICAgICAgIGxlbmd0aDogdmlkZW9MZW5ndGhcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJ1blJlcXVlc3Qoc2VsZWN0ZWRNb2RlbCwgaW5wdXRzLCB7XHJcbiAgICAgICAgd2ViaG9vazogd2ViaG9va1VybCxcclxuICAgICAgICB3ZWJob29rSW50ZXJtZWRpYXRlU3RhdHVzOiBmYWxzZVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDYWxsaW5nIFBpeGlvIEFQSSBmb3IgbWVkaWFJZDogJHttZWRpYUlkfSwgbW9kZWw6ICR7c2VsZWN0ZWRNb2RlbC5uYW1lfWApO1xyXG4gICAgICBwaXhpb1Jlc3VsdCA9IGF3YWl0IHF1ZXVlUGl4aW9SdW4ocmVxdWVzdCwgYXBpS2V5KTtcclxuICAgICAgXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBVbnN1cHBvcnRlZCBnZW5lcmF0aW9uIG1vZGU6ICR7Z2VuZXJhdGlvbk1vZGV9YCk7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1Vuc3VwcG9ydGVkIGdlbmVyYXRpb24gbW9kZScgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA2LiBDaGVjayBQaXhpbyBBUEkgcmVzdWx0XHJcblxyXG4gICAgaWYgKCFwaXhpb1Jlc3VsdC5zdWNjZXNzIHx8ICFwaXhpb1Jlc3VsdC5kYXRhKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIFBpeGlvIEFQSSBlcnJvcjpgLCBwaXhpb1Jlc3VsdC5lcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgcmVjb3JkIHRvIGZhaWxlZFxyXG4gICAgICBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ2dlbmVyYXRlZF9tZWRpYScpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgZXJyb3I6IHBpeGlvUmVzdWx0LmVycm9yIHx8ICdBUEkgcmVxdWVzdCBmYWlsZWQnLFxyXG4gICAgICAgICAgICBmYWlsZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBwaXhpb1Jlc3VsdC5lcnJvciB8fCAnQVBJIHJlcXVlc3QgZmFpbGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJ1bklkID0gcGl4aW9SZXN1bHQuZGF0YS5ydW5faWQ7XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFBpeGlvIEFQSSBydW4gc3RhcnRlZCB3aXRoIElEOiAke3J1bklkfSB1c2luZyBtb2RlbDogJHtzZWxlY3RlZE1vZGVsLm5hbWV9YCk7XHJcblxyXG4gICAgLy8gNy4gVXBkYXRlIHJlY29yZCB3aXRoIHJ1bl9pZCwgbW9kZWwgaW5mbywgYW5kIHByb2Nlc3Npbmcgc3RhdHVzXHJcbiAgICBjb25zdCB7IGVycm9yOiBydW5JZFVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBzdGF0dXM6ICdwcm9jZXNzaW5nJyxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgcnVuX2lkOiBydW5JZCxcclxuICAgICAgICAgIGdlbmVyYXRpb25Nb2RlLFxyXG4gICAgICAgICAgbW9kZWxfaWQ6IHNlbGVjdGVkTW9kZWwuaWQsXHJcbiAgICAgICAgICBtb2RlbF9uYW1lOiBzZWxlY3RlZE1vZGVsLm5hbWUsXHJcbiAgICAgICAgICBzdGFydGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKTtcclxuXHJcbiAgICBpZiAocnVuSWRVcGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBFcnJvciB1cGRhdGluZyByZWNvcmQgd2l0aCBydW5faWQ6YCwgcnVuSWRVcGRhdGVFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gOC4gUmV2YWxpZGF0ZSBwYXRoIHRvIHNob3cgcHJvY2Vzc2luZyBzdGF0ZVxyXG4gICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuXHJcbiAgICAvLyA5LiBSZXR1cm4gc3VjY2VzcyAod2ViaG9vayB3aWxsIGhhbmRsZSBjb21wbGV0aW9uKVxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBpbml0aWF0ZWQgZ2VuZXJhdGlvbiBmb3IgJHttZWRpYUlkfWApO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVkaWFJZDogbWVkaWFJZCB9O1xyXG5cclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbQWN0aW9uXSBFcnJvciBpbiBnZW5lcmF0ZU1lZGlhIGFjdGlvbjonLCBlcnJvcik7XHJcbiAgICAvLyBJZiB0aGUgZXJyb3IgaGFwcGVuZWQgYmVmb3JlIGludm9jYXRpb24gKGUuZy4sIGNyZWRpdCBkZWR1Y3Rpb24pLCByZXR1cm4gZXJyb3JcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENhbmNlbHMgYSBydW5uaW5nIG1lZGlhIGdlbmVyYXRpb25cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYW5jZWxHZW5lcmF0aW9uKG1lZGlhSWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICBpZiAoIW1lZGlhSWQpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01lZGlhIElEIGlzIHJlcXVpcmVkJyB9O1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuXHJcbiAgaWYgKCF1c2VyIHx8IHVzZXJFcnJvcikge1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH07XHJcbiAgfVxyXG5cclxuICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FuY2VsbGluZyBnZW5lcmF0aW9uIGZvciBtZWRpYUlkOiAke21lZGlhSWR9YCk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBGZXRjaCB0aGUgbWVkaWEgcmVjb3JkIHRvIHZlcmlmeSBvd25lcnNoaXAgYW5kIGdldCBydW5faWRcclxuICAgIGNvbnN0IHsgZGF0YTogbWVkaWFSZWNvcmQsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdXNlcl9pZCwgc3RhdHVzLCBtZXRhZGF0YScpXHJcbiAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIW1lZGlhUmVjb3JkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGZldGNoaW5nIG1lZGlhICR7bWVkaWFJZH06YCwgZmV0Y2hFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01lZGlhIHJlY29yZCBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgaWYgKG1lZGlhUmVjb3JkLnVzZXJfaWQgIT09IHVzZXIuaWQpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBbQWN0aW9uXSBVc2VyICR7dXNlci5pZH0gYXR0ZW1wdGVkIHRvIGNhbmNlbCBtZWRpYSAke21lZGlhSWR9IG93bmVkIGJ5ICR7bWVkaWFSZWNvcmQudXNlcl9pZH1gKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnUGVybWlzc2lvbiBkZW5pZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgY2FuY2VsbGFibGVcclxuICAgIGlmICghWydwZW5kaW5nJywgJ3Byb2Nlc3NpbmcnXS5pbmNsdWRlcyhtZWRpYVJlY29yZC5zdGF0dXMpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogYENhbm5vdCBjYW5jZWwgJHttZWRpYVJlY29yZC5zdGF0dXN9IGdlbmVyYXRpb25gIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IHJ1bl9pZCBmcm9tIG1ldGFkYXRhXHJcbiAgICBjb25zdCBydW5JZCA9IChtZWRpYVJlY29yZC5tZXRhZGF0YSBhcyBhbnkpPy5ydW5faWQ7XHJcbiAgICBcclxuICAgIGlmICghcnVuSWQpIHtcclxuICAgICAgLy8gTm8gcnVuX2lkIHlldCwganVzdCB1cGRhdGUgc3RhdHVzIHRvIGZhaWxlZFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gTm8gcnVuX2lkIGZvciAke21lZGlhSWR9LCBtYXJraW5nIGFzIGNhbmNlbGxlZCBsb2NhbGx5YCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgc3RhdHVzOiAnZmFpbGVkJyxcclxuICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgIC4uLihtZWRpYVJlY29yZC5tZXRhZGF0YSBhcyBvYmplY3QgfHwge30pLFxyXG4gICAgICAgICAgICBlcnJvcjogJ0NhbmNlbGxlZCBieSB1c2VyJyxcclxuICAgICAgICAgICAgY2FuY2VsbGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKTtcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIHVwZGF0aW5nIGNhbmNlbGxlZCBzdGF0dXM6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byBjYW5jZWwgZ2VuZXJhdGlvbicgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGwgUGl4aW8gQVBJIHRvIGNhbmNlbCB0aGUgcnVuIHVzaW5nIHRoZSBjbGllbnRcclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDYWxsaW5nIFBpeGlvIEFQSSB0byBjYW5jZWwgcnVuOiAke3J1bklkfWApO1xyXG4gICAgXHJcbiAgICBjb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5QSVhJT19ERVBMT1lfQVBJX0tFWTtcclxuICAgIGlmICghYXBpS2V5KSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0FQSSBrZXkgbm90IGNvbmZpZ3VyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2FuY2VsUmVzdWx0ID0gYXdhaXQgY2FuY2VsUGl4aW9SdW4ocnVuSWQsIGFwaUtleSk7XHJcblxyXG4gICAgLy8gTm90ZTogRXZlbiBpZiB0aGUgY2FuY2VsIEFQSSBjYWxsIGZhaWxzLCB3ZSBzdGlsbCBtYXJrIGl0IGFzIGNhbmNlbGxlZCBsb2NhbGx5XHJcbiAgICBpZiAoIWNhbmNlbFJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihgW0FjdGlvbl0gUGl4aW8gY2FuY2VsIEFQSSBmYWlsZWQ6ICR7Y2FuY2VsUmVzdWx0LmVycm9yfSwgYnV0IGNvbnRpbnVpbmcgd2l0aCBsb2NhbCBjYW5jZWxsYXRpb25gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgZGF0YWJhc2UgdG8gY2FuY2VsbGVkL2ZhaWxlZCBzdGF0dXNcclxuICAgIGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAuLi4obWVkaWFSZWNvcmQubWV0YWRhdGEgYXMgb2JqZWN0IHx8IHt9KSxcclxuICAgICAgICAgIGVycm9yOiAnQ2FuY2VsbGVkIGJ5IHVzZXInLFxyXG4gICAgICAgICAgY2FuY2VsbGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICBjYW5jZWxfYXBpX3N0YXR1czogY2FuY2VsUmVzdWx0LnN1Y2Nlc3MgPyAnc3VjY2VzcycgOiAnZmFpbGVkJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbQWN0aW9uXSBFcnJvciB1cGRhdGluZyBjYW5jZWxsZWQgc3RhdHVzOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRmFpbGVkIHRvIHVwZGF0ZSBjYW5jZWxsYXRpb24gc3RhdHVzJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBTdWNjZXNzZnVsbHkgY2FuY2VsbGVkIGdlbmVyYXRpb24gJHttZWRpYUlkfWApO1xyXG4gICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihgW0FjdGlvbl0gRXJyb3IgY2FuY2VsbGluZyBnZW5lcmF0aW9uICR7bWVkaWFJZH06YCwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRGVsZXRlcyBhIG1lZGlhIGl0ZW0gcmVjb3JkIGFuZCBpdHMgYXNzb2NpYXRlZCBmaWxlIGZyb20gc3RvcmFnZS5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVNZWRpYShtZWRpYUlkOiBzdHJpbmcsIHN0b3JhZ2VQYXRoOiBzdHJpbmcgfCBudWxsKTogUHJvbWlzZTx7XHJcbiAgICBzdWNjZXNzOiBib29sZWFuO1xyXG4gICAgZXJyb3I/OiBzdHJpbmc7XHJcbiAgfT4ge1xyXG4gICAgaWYgKCFtZWRpYUlkKSB7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJNZWRpYSBJRCBpcyByZXF1aXJlZC5cIiB9OyB9XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpOyAvLyBVc2Ugc2VydmVyIGNsaWVudCB0byBnZXQgdXNlclxyXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcbiAgICBpZiAoIXVzZXIgfHwgdXNlckVycm9yKSB7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIGVycm9yJyB9OyB9XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIERlbGV0aW5nIG1lZGlhICR7bWVkaWFJZH0gKHBhdGg6ICR7c3RvcmFnZVBhdGggfHwgJ04vQSd9KSBmb3IgdXNlciAke3VzZXIuaWR9YCk7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBWZXJpZnkgb3duZXJzaGlwIHVzaW5nIGFkbWluIGNsaWVudFxyXG4gICAgICBjb25zdCB7IGRhdGE6IG1lZGlhUmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKS5zZWxlY3QoJ2lkLCB1c2VyX2lkLCBzdG9yYWdlX3BhdGgnKS5lcSgnaWQnLCBtZWRpYUlkKS5zaW5nbGUoKTtcclxuICAgICAgaWYgKGZldGNoRXJyb3IgfHwgIW1lZGlhUmVjb3JkKSB7IGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGZldGNoaW5nIG1lZGlhICR7bWVkaWFJZH0gZm9yIGRlbGV0aW9uIG9yIG5vdCBmb3VuZDpgLCBmZXRjaEVycm9yKTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWVkaWEgcmVjb3JkIG5vdCBmb3VuZC4nIH07IH1cclxuICAgICAgaWYgKG1lZGlhUmVjb3JkLnVzZXJfaWQgIT09IHVzZXIuaWQpIHsgY29uc29sZS53YXJuKGBbQWN0aW9uXSBVc2VyICR7dXNlci5pZH0gYXR0ZW1wdGVkIHRvIGRlbGV0ZSBtZWRpYSAke21lZGlhSWR9IG93bmVkIGJ5ICR7bWVkaWFSZWNvcmQudXNlcl9pZH0uIERlbnlpbmcuYCk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1Blcm1pc3Npb24gZGVuaWVkLicgfTsgfVxyXG5cclxuICAgICAgY29uc3QgYWN0dWFsU3RvcmFnZVBhdGggPSBtZWRpYVJlY29yZC5zdG9yYWdlX3BhdGg7XHJcblxyXG4gICAgICAvLyBEZWxldGUgZnJvbSBTdG9yYWdlICpvbmx5IGlmIHBhdGggZXhpc3RzKiB1c2luZyB0aGUgc2VydmljZSBmdW5jdGlvblxyXG4gICAgICBpZiAoYWN0dWFsU3RvcmFnZVBhdGgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBzZXJ2aWNlIHRvIGRlbGV0ZSBmaWxlIGZyb20gc3RvcmFnZTogJHthY3R1YWxTdG9yYWdlUGF0aH1gKTtcclxuICAgICAgICBjb25zdCB7IHN1Y2Nlc3M6IGRlbGV0ZVN1Y2Nlc3MsIGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgZGVsZXRlRmlsZVNlcnZpY2UoYWN0dWFsU3RvcmFnZVBhdGgpOyAvLyBVc2Ugc3RvcmFnZSBzZXJ2aWNlXHJcbiAgICAgICAgaWYgKCFkZWxldGVTdWNjZXNzKSB7IGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGRlbGV0aW5nIGZpbGUgJHthY3R1YWxTdG9yYWdlUGF0aH0gZnJvbSBzdG9yYWdlIChjb250aW51aW5nKTpgLCBkZWxldGVFcnJvcik7IH1cclxuICAgICAgICBlbHNlIHsgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBkZWxldGVkIGZpbGUgJHthY3R1YWxTdG9yYWdlUGF0aH0gdmlhIHNlcnZpY2UuYCk7IH1cclxuICAgICAgfSBlbHNlIHsgY29uc29sZS5sb2coYFtBY3Rpb25dIE5vIHN0b3JhZ2UgcGF0aCBmb3IgbWVkaWEgJHttZWRpYUlkfSwgc2tpcHBpbmcgc3RvcmFnZSBkZWxldGlvbi5gKTsgfVxyXG5cclxuICAgICAgLy8gRGVsZXRlIGZyb20gRGF0YWJhc2UgdXNpbmcgYWRtaW4gY2xpZW50XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBEZWxldGluZyByZWNvcmQgZnJvbSBkYXRhYmFzZTogJHttZWRpYUlkfWApO1xyXG4gICAgICBjb25zdCB7IGVycm9yOiBkYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmZyb20oJ2dlbmVyYXRlZF9tZWRpYScpLmRlbGV0ZSgpLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG4gICAgICBpZiAoZGJFcnJvcikgeyBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBFcnJvciBkZWxldGluZyByZWNvcmQgJHttZWRpYUlkfSBmcm9tIGRhdGFiYXNlOmAsIGRiRXJyb3IpOyB0aHJvdyBuZXcgRXJyb3IoYERhdGFiYXNlIGRlbGV0aW9uIGZhaWxlZDogJHtkYkVycm9yLm1lc3NhZ2V9YCk7IH1cclxuICAgICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBkZWxldGVkIHJlY29yZCAke21lZGlhSWR9IGZyb20gZGF0YWJhc2UuYCk7XHJcblxyXG4gICAgICByZXZhbGlkYXRlUGF0aCgnL2Rhc2hib2FyZCcpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIFVuZXhwZWN0ZWQgZXJyb3IgZHVyaW5nIG1lZGlhIGRlbGV0aW9uIGZvciAke21lZGlhSWR9OmAsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaGVzIGNvbXBsZXRlZCBhbmQgcHJvY2Vzc2luZyBtZWRpYSBpdGVtcyBmb3IgdGhlIGN1cnJlbnQgdXNlci5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaFVzZXJNZWRpYSgpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIG1lZGlhOiBHZW5lcmF0ZWRNZWRpYVtdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTsgLy8gVXNlcyBzZXJ2ZXIgY2xpZW50XHJcbiAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcbiAgaWYgKCF1c2VyIHx8IHVzZXJFcnJvcikgeyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvcicsIG1lZGlhOiBbXSB9OyB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBVc2UgdXNlci1jb250ZXh0IGNsaWVudCBmb3IgUkxTXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnZ2VuZXJhdGVkX21lZGlhJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpXHJcbiAgICAgIC5pbignc3RhdHVzJywgWydwZW5kaW5nJywgJ3Byb2Nlc3NpbmcnLCAnY29tcGxldGVkJywgJ2ZhaWxlZCddKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDUwKTsgLy8gQWRqdXN0IGxpbWl0IGFzIG5lZWRlZFxyXG5cclxuICAgIGlmIChlcnJvcikgeyB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBtZWRpYTogJHtlcnJvci5tZXNzYWdlfWApOyB9XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZWRpYTogZGF0YSB8fCBbXSwgZXJyb3I6IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIGZldGNoaW5nIHVzZXIgbWVkaWE6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlLCBtZWRpYTogW10gfTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXJ2ZXIgQWN0aW9uIHRvIGxpc3QgdXNlcidzIGdlbmVyYXRlZCBpbWFnZXMgYW5kIGlucHV0IGltYWdlcyBmb3Igc2VsZWN0aW9uLlxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3RVc2VySW1hZ2VzRm9yU2VsZWN0aW9uKCk6IFByb21pc2U8e1xyXG4gICAgc3VjY2VzczogYm9vbGVhbjtcclxuICAgIGltYWdlczogeyB2YWx1ZTogc3RyaW5nOyBsYWJlbDogc3RyaW5nOyB0eXBlOiAnZ2VuZXJhdGVkJyB8ICdpbnB1dCcgfVtdO1xyXG4gICAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7IC8vIFVzZSBzZXJ2ZXIgY2xpZW50IHRvIGdldCB1c2VyXHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuICAgIGlmICghdXNlciB8fCB1c2VyRXJyb3IpIHsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGltYWdlczogW10sIGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH07IH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IFtnZW5lcmF0ZWRSZXN1bHQsIGlucHV0UmVzdWx0XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICAgICAgLy8gRmV0Y2ggY29tcGxldGVkIGdlbmVyYXRlZCBpbWFnZXMgdXNpbmcgUkxTLWVuYWJsZWQgY2xpZW50XHJcbiAgICAgICAgICAgIHN1cGFiYXNlXHJcbiAgICAgICAgICAgICAgICAuZnJvbSgnZ2VuZXJhdGVkX21lZGlhJylcclxuICAgICAgICAgICAgICAgIC5zZWxlY3QoJ2lkLCBwcm9tcHQsIG1lZGlhX3VybCcpXHJcbiAgICAgICAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxyXG4gICAgICAgICAgICAgICAgLmVxKCdtZWRpYV90eXBlJywgJ2ltYWdlJylcclxuICAgICAgICAgICAgICAgIC5lcSgnc3RhdHVzJywgJ2NvbXBsZXRlZCcpXHJcbiAgICAgICAgICAgICAgICAubm90KCdtZWRpYV91cmwnLCAnaXMnLCBudWxsKVxyXG4gICAgICAgICAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgICAgICAgICAgICAubGltaXQoNTApLCAvLyBMaW1pdCBnZW5lcmF0ZWQgaW1hZ2VzIHNob3duXHJcbiAgICAgICAgICAgIC8vIEZldGNoIGlucHV0IGltYWdlcyB1c2luZyB0aGUgc2VydmljZSBmdW5jdGlvbiAodXNlcyBhZG1pbiBjbGllbnQpXHJcbiAgICAgICAgICAgIGxpc3RVc2VyRmlsZXNTZXJ2aWNlKHVzZXIuaWQsICdpbnB1dHMnKVxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICBjb25zdCBmZXRjaGVkSW1hZ2VzOiB7IHZhbHVlOiBzdHJpbmc7IGxhYmVsOiBzdHJpbmc7IHR5cGU6ICdnZW5lcmF0ZWQnIHwgJ2lucHV0JyB9W10gPSBbXTtcclxuXHJcbiAgICAgICAgLy8gUHJvY2VzcyBnZW5lcmF0ZWQgaW1hZ2VzXHJcbiAgICAgICAgaWYgKGdlbmVyYXRlZFJlc3VsdC5lcnJvcikgeyBjb25zb2xlLmVycm9yKFwiW0FjdGlvbl0gRXJyb3IgZmV0Y2hpbmcgZ2VuZXJhdGVkIGltYWdlczpcIiwgZ2VuZXJhdGVkUmVzdWx0LmVycm9yKTsgfVxyXG4gICAgICAgIGVsc2UgaWYgKGdlbmVyYXRlZFJlc3VsdC5kYXRhKSB7IGdlbmVyYXRlZFJlc3VsdC5kYXRhLmZvckVhY2goaXRlbSA9PiB7IGZldGNoZWRJbWFnZXMucHVzaCh7IHZhbHVlOiBpdGVtLm1lZGlhX3VybCEsIGxhYmVsOiBpdGVtLnByb21wdCA/IGBHZW46ICR7aXRlbS5wcm9tcHQuc3Vic3RyaW5nKDAsIDMwKX0uLi5gIDogYEdlbmVyYXRlZCBJbWFnZSAke2l0ZW0uaWQuc3Vic3RyaW5nKDAsIDYpfWAsIHR5cGU6ICdnZW5lcmF0ZWQnLCB9KTsgfSk7IH1cclxuXHJcbiAgICAgICAgLy8gUHJvY2VzcyBpbnB1dCBpbWFnZXNcclxuICAgICAgICBpZiAoIWlucHV0UmVzdWx0LnN1Y2Nlc3MpIHsgY29uc29sZS5lcnJvcihcIltBY3Rpb25dIEVycm9yIGZldGNoaW5nIGlucHV0IGltYWdlczpcIiwgaW5wdXRSZXN1bHQuZXJyb3IpOyB9XHJcbiAgICAgICAgZWxzZSBpZiAoaW5wdXRSZXN1bHQuZmlsZXMpIHsgaW5wdXRSZXN1bHQuZmlsZXMuZm9yRWFjaChmaWxlID0+IHsgaWYgKGZpbGUucHVibGljVXJsICYmIC9cXC4oanBnfGpwZWd8cG5nfHdlYnB8Z2lmKSQvaS50ZXN0KGZpbGUubmFtZSkpIHsgZmV0Y2hlZEltYWdlcy5wdXNoKHsgdmFsdWU6IGZpbGUucHVibGljVXJsLCBsYWJlbDogYElucHV0OiAke2ZpbGUubmFtZX1gLCB0eXBlOiAnaW5wdXQnLCB9KTsgfSB9KTsgfVxyXG5cclxuICAgICAgICBmZXRjaGVkSW1hZ2VzLnNvcnQoKGEsIGIpID0+IGEubGFiZWwubG9jYWxlQ29tcGFyZShiLmxhYmVsKSk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgaW1hZ2VzOiBmZXRjaGVkSW1hZ2VzIH07XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIGxpc3RpbmcgdXNlciBpbWFnZXM6JywgZXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBpbWFnZXM6IFtdLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG59XHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiNlRBaWRzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/apps/web/src/components/dashboard/image-selector-popover.tsx [app-client] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
// src/components/dashboard/image-selector-popover.tsx
__turbopack_context__.s({
    "ImageSelectorPopover": (()=>ImageSelectorPopover)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/check.js [app-client] (ecmascript) <export default as Check>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevrons$2d$up$2d$down$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronsUpDown$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/chevrons-up-down.js [app-client] (ecmascript) <export default as ChevronsUpDown>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/loader-circle.js [app-client] (ecmascript) <export default as Loader2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/lib/utils.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$index$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/packages/ui/src/index.ts [app-client] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/button.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/command.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$popover$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/popover.tsx [app-client] (ecmascript)");
// Import the NEW server action
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$actions$2f$data$3a$d445a6__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/lib/actions/data:d445a6 [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/image.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-client] (ecmascript)"); // Import toast for error handling
;
var _s = __turbopack_context__.k.signature();
'use client';
;
;
;
;
;
;
;
;
;
function ImageSelectorPopover({ selectedUrl, onImageSelect, triggerText = "Select Image", disabled = false }) {
    _s();
    const [open, setOpen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [loading, setLoading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [images, setImages] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])([]);
    const hasFetched = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false); // Track if fetch has been attempted
    // Fetch images when popover opens
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ImageSelectorPopover.useEffect": ()=>{
            // Only fetch if popover is open AND fetch hasn't been attempted yet
            if (open && !hasFetched.current) {
                const fetchImages = {
                    "ImageSelectorPopover.useEffect.fetchImages": async ()=>{
                        setLoading(true);
                        hasFetched.current = true; // Mark fetch as attempted
                        try {
                            // Call the SERVER ACTION
                            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$actions$2f$data$3a$d445a6__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["listUserImagesForSelection"])();
                            if (result.success) {
                                setImages(result.images);
                            } else {
                                console.error("Failed to fetch images:", result.error);
                                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Could not load existing images.");
                                setImages([]); // Clear images on error
                            }
                        } catch (error) {
                            console.error("Error calling listUserImagesForSelection:", error);
                            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("An error occurred while loading images.");
                            setImages([]); // Clear images on error
                        } finally{
                            setLoading(false);
                        }
                    }
                }["ImageSelectorPopover.useEffect.fetchImages"];
                fetchImages();
            } else if (!open) {
                // Reset fetch tracker when popover closes, allowing refetch next time
                hasFetched.current = false;
            }
        }
    }["ImageSelectorPopover.useEffect"], [
        open
    ]); // Depend only on open state
    const selectedLabel = images.find((image)=>image.value === selectedUrl)?.label;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$popover$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Popover"], {
        open: open,
        onOpenChange: setOpen,
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$popover$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PopoverTrigger"], {
                asChild: true,
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                    variant: "outline",
                    role: "combobox",
                    "aria-expanded": open,
                    className: "w-1/2 justify-between glass-input bg-white/5 border-white/15 hover:bg-white/10 text-foreground/80",
                    disabled: disabled,
                    title: selectedLabel ?? triggerText,
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                            className: "truncate",
                            children: selectedUrl && selectedLabel ? selectedLabel : triggerText
                        }, void 0, false, {
                            fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                            lineNumber: 97,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevrons$2d$up$2d$down$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronsUpDown$3e$__["ChevronsUpDown"], {
                            className: "ml-2 h-4 w-4 shrink-0 opacity-50"
                        }, void 0, false, {
                            fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                            lineNumber: 102,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                    lineNumber: 89,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                lineNumber: 88,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$popover$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PopoverContent"], {
                className: "w-[--radix-popover-trigger-width] max-h-[--radix-popover-content-available-height] p-0 glass-card",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Command"], {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CommandInput"], {
                            placeholder: "Search images..."
                        }, void 0, false, {
                            fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                            lineNumber: 107,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CommandList"], {
                            children: loading ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "py-6 text-center text-sm flex items-center justify-center gap-2 text-muted-foreground",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                        className: "h-4 w-4 animate-spin"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                        lineNumber: 111,
                                        columnNumber: 17
                                    }, this),
                                    " Loading images..."
                                ]
                            }, void 0, true, {
                                fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                lineNumber: 110,
                                columnNumber: 15
                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CommandEmpty"], {
                                        children: "No images found."
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                        lineNumber: 115,
                                        columnNumber: 17
                                    }, this),
                                    images.some((img)=>img.type === 'input') && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CommandGroup"], {
                                        heading: "Uploaded Inputs",
                                        children: images.filter((img)=>img.type === 'input').map((image)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CommandItem"], {
                                                value: image.label,
                                                onSelect: ()=>{
                                                    onImageSelect(image.value === selectedUrl ? null : image.value);
                                                    setOpen(false);
                                                },
                                                className: "flex items-center gap-2 cursor-pointer",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                                        src: image.value,
                                                        alt: image.label,
                                                        width: 24,
                                                        height: 24,
                                                        className: "h-6 w-6 rounded object-cover flex-shrink-0 border border-white/10"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                                        lineNumber: 129,
                                                        columnNumber: 27
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                        className: "truncate flex-grow",
                                                        children: image.label
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                                        lineNumber: 130,
                                                        columnNumber: 27
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__["Check"], {
                                                        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("ml-auto h-4 w-4", selectedUrl === image.value ? "opacity-100" : "opacity-0")
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                                        lineNumber: 131,
                                                        columnNumber: 27
                                                    }, this)
                                                ]
                                            }, image.value, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                                lineNumber: 120,
                                                columnNumber: 25
                                            }, this))
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                        lineNumber: 118,
                                        columnNumber: 21
                                    }, this),
                                    images.some((img)=>img.type === 'input') && images.some((img)=>img.type === 'generated') && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CommandSeparator"], {}, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                        lineNumber: 138,
                                        columnNumber: 21
                                    }, this),
                                    images.some((img)=>img.type === 'generated') && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CommandGroup"], {
                                        heading: "Generated Images",
                                        children: images.filter((img)=>img.type === 'generated').map((image)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$command$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CommandItem"], {
                                                value: image.label,
                                                onSelect: ()=>{
                                                    onImageSelect(image.value === selectedUrl ? null : image.value);
                                                    setOpen(false);
                                                },
                                                className: "flex items-center gap-2 cursor-pointer",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                                        src: image.value,
                                                        alt: image.label,
                                                        width: 24,
                                                        height: 24,
                                                        className: "h-6 w-6 rounded object-cover flex-shrink-0 border border-white/10"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                                        lineNumber: 153,
                                                        columnNumber: 27
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                        className: "truncate flex-grow",
                                                        children: image.label
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                                        lineNumber: 154,
                                                        columnNumber: 27
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__["Check"], {
                                                        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("ml-auto h-4 w-4", selectedUrl === image.value ? "opacity-100" : "opacity-0")
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                                        lineNumber: 155,
                                                        columnNumber: 27
                                                    }, this)
                                                ]
                                            }, image.value, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                                lineNumber: 144,
                                                columnNumber: 25
                                            }, this))
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                                        lineNumber: 142,
                                        columnNumber: 21
                                    }, this)
                                ]
                            }, void 0, true)
                        }, void 0, false, {
                            fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                            lineNumber: 108,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                    lineNumber: 106,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
                lineNumber: 105,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/apps/web/src/components/dashboard/image-selector-popover.tsx",
        lineNumber: 87,
        columnNumber: 5
    }, this);
}
_s(ImageSelectorPopover, "HUxh2ty4MnageMuwWdi+LEpmBRo=");
_c = ImageSelectorPopover;
var _c;
__turbopack_context__.k.register(_c, "ImageSelectorPopover");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/apps/web/src/components/dashboard/media-generation-form.tsx [app-client] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
// src/components/dashboard/media-generation-form.tsx
__turbopack_context__.s({
    "MediaGenerationForm": (()=>MediaGenerationForm)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$index$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/packages/ui/src/index.ts [app-client] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/button.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$textarea$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/textarea.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/input.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/label.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/loader-circle.js [app-client] (ecmascript) <export default as Loader2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__AlertCircle$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/circle-alert.js [app-client] (ecmascript) <export default as AlertCircle>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Image$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/image.js [app-client] (ecmascript) <export default as Image>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$film$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Film$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/film.js [app-client] (ecmascript) <export default as Film>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$sparkles$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Sparkles$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/sparkles.js [app-client] (ecmascript) <export default as Sparkles>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$upload$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Upload$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/upload.js [app-client] (ecmascript) <export default as Upload>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__X$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/x.js [app-client] (ecmascript) <export default as X>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$actions$2f$data$3a$aaa727__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/lib/actions/data:aaa727 [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/image.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/framer-motion/dist/es/render/components/motion/proxy.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$components$2f$AnimatePresence$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/framer-motion/dist/es/components/AnimatePresence/index.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$components$2f$dashboard$2f$image$2d$selector$2d$popover$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/web/src/components/dashboard/image-selector-popover.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$browser$2d$image$2d$compression$2f$dist$2f$browser$2d$image$2d$compression$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/browser-image-compression/dist/browser-image-compression.mjs [app-client] (ecmascript)");
// Import Supabase client
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$supabase$2f$src$2f$lib$2f$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/supabase/src/lib/client.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$browser$2f$v4$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__v4$3e$__ = __turbopack_context__.i("[project]/node_modules/uuid/dist/esm-browser/v4.js [app-client] (ecmascript) <export default as v4>"); // For unique filenames
;
var _s = __turbopack_context__.k.signature();
'use client';
;
;
;
;
;
;
;
;
;
;
;
;
;
;
// Helper function for direct Supabase upload
async function uploadDirectlyToSupabase(file, userId, type) {
    if (!file || !userId) {
        return {
            success: false,
            error: 'User ID and file are required.'
        };
    }
    const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$supabase$2f$src$2f$lib$2f$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createClient"])(); // Initialize Supabase client
    try {
        const fileExtension = file.name.split('.').pop()?.toLowerCase() || 'bin';
        // Use UUID for more robust uniqueness
        const fileName = `${type}-${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$browser$2f$v4$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__v4$3e$__["v4"])()}.${fileExtension}`;
        const storagePath = `${userId}/inputs/${fileName}`; // Store in user-specific inputs folder
        console.log(`Uploading input image directly to: ${storagePath}`);
        const uploadToastId = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].info(`Uploading ${type} image...`, {
            duration: 60000
        }); // Show toast with longer duration
        const { data, error: uploadError } = await supabase.storage.from('generated-media') // Your bucket name
        .upload(storagePath, file, {
            cacheControl: '3600',
            upsert: false,
            contentType: file.type
        });
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].dismiss(uploadToastId); // Dismiss upload toast immediately after attempt
        if (uploadError) {
            console.error(`Direct upload error (${type}):`, uploadError);
            throw new Error(`Direct upload failed: ${uploadError.message}`);
        }
        // Get public URL
        const { data: publicUrlData } = supabase.storage.from('generated-media').getPublicUrl(storagePath);
        if (!publicUrlData?.publicUrl) {
            throw new Error('Failed to get public URL for uploaded input image.');
        }
        console.log(`Direct upload success (${type}): ${publicUrlData.publicUrl}`);
        // toast.success(`${type.charAt(0).toUpperCase() + type.slice(1)} image uploaded.`); // Optional success toast
        return {
            success: true,
            url: publicUrlData.publicUrl
        };
    } catch (error) {
        console.error(`Error in uploadDirectlyToSupabase (${type}):`, error);
        // toast.dismiss(); // Ensure any related toasts are dismissed
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(`Failed to upload ${type} image.`);
        return {
            success: false,
            error: error.message
        };
    }
}
function MediaGenerationForm({ generationMode, creditCost, userCredits, onGenerationStart }) {
    _s();
    const [prompt, setPrompt] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])('');
    const [startImageFile, setStartImageFile] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [endImageFile, setEndImageFile] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [startImageUrl, setStartImageUrl] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [endImageUrl, setEndImageUrl] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [startImagePreview, setStartImagePreview] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [endImagePreview, setEndImagePreview] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    // Qwen Edit specific states
    const [image1File, setImage1File] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [image1Url, setImage1Url] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [image1Preview, setImage1Preview] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [image2File, setImage2File] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [image2Url, setImage2Url] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [image2Preview, setImage2Preview] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [image3File, setImage3File] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [image3Url, setImage3Url] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [image3Preview, setImage3Preview] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [positivePrompt, setPositivePrompt] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])('');
    const [negativePrompt, setNegativePrompt] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])('');
    // Krea Flux specific states
    const [width, setWidth] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(1024);
    const [height, setHeight] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(1024);
    // Wan 2.2 specific states
    const [videoWidth, setVideoWidth] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(512);
    const [videoHeight, setVideoHeight] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(512);
    const [videoLength, setVideoLength] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(81);
    const [isSubmitting, setIsSubmitting] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [currentMediaId, setCurrentMediaId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [previewUrl, setPreviewUrl] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [previewStatus, setPreviewStatus] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])('idle');
    const startFileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const endFileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const image1FileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const image2FileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const image3FileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const [userId, setUserId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$supabase$2f$src$2f$lib$2f$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createClient"])(); // Initialize client for user ID and Realtime
    // Get user ID on mount
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "MediaGenerationForm.useEffect": ()=>{
            const getUser = {
                "MediaGenerationForm.useEffect.getUser": async ()=>{
                    const { data: { user } } = await supabase.auth.getUser();
                    setUserId(user?.id || null);
                    if (!user) console.warn("MediaGenerationForm: User not found on mount.");
                }
            }["MediaGenerationForm.useEffect.getUser"];
            getUser();
        }
    }["MediaGenerationForm.useEffect"], [
        supabase
    ]);
    // Determine actual media type based on model category
    const getMediaType = ()=>{
        if (generationMode === 'image') return 'image'; // Krea Flux  image
        if (generationMode === 'video') return 'image'; // Qwen Edit  image (it's editing, not video generation)
        if (generationMode === 'firstLastFrameVideo') return 'video'; // Wan 2.2  video
        return 'image'; // Default
    };
    const generatedMediaType = getMediaType();
    // Realtime subscription for media status updates
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "MediaGenerationForm.useEffect": ()=>{
            if (!currentMediaId) return;
            console.log(`[MediaGenerationForm] Setting up Realtime for media: ${currentMediaId}`);
            const channel = supabase.channel(`generation-${currentMediaId}`).on('postgres_changes', {
                event: 'UPDATE',
                schema: 'public',
                table: 'generated_media',
                filter: `id=eq.${currentMediaId}`
            }, {
                "MediaGenerationForm.useEffect.channel": (payload)=>{
                    console.log('[MediaGenerationForm] Realtime update:', payload);
                    const updated = payload.new;
                    setPreviewStatus(updated.status);
                    if (updated.status === 'completed') {
                        setPreviewUrl(updated.media_url);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success(`${generatedMediaType} generation complete!`);
                    } else if (updated.status === 'failed') {
                        const errorMsg = updated.metadata?.error || 'Generation failed';
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(`Generation failed: ${errorMsg}`);
                    }
                }
            }["MediaGenerationForm.useEffect.channel"]).subscribe({
                "MediaGenerationForm.useEffect.channel": (status)=>{
                    if (status === 'SUBSCRIBED') {
                        console.log(`[MediaGenerationForm] Realtime SUBSCRIBED for ${currentMediaId}`);
                    } else if (status === 'CHANNEL_ERROR') {
                        console.error('[MediaGenerationForm] Realtime CHANNEL_ERROR');
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error('Connection error. Please refresh if status doesn\'t update.');
                    }
                }
            }["MediaGenerationForm.useEffect.channel"]);
            // Cleanup on unmount or when currentMediaId changes
            return ({
                "MediaGenerationForm.useEffect": ()=>{
                    console.log(`[MediaGenerationForm] Unsubscribing from Realtime for ${currentMediaId}`);
                    supabase.removeChannel(channel);
                }
            })["MediaGenerationForm.useEffect"];
        }
    }["MediaGenerationForm.useEffect"], [
        currentMediaId,
        supabase,
        generatedMediaType
    ]);
    // --- Image Handling ---
    const handleFileChange = (event, type)=>{
        const file = event.target.files?.[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = ()=>{
                const result = reader.result;
                if (type === 'start') {
                    setStartImageFile(file);
                    setStartImageUrl(null);
                    setStartImagePreview(result);
                } else if (type === 'end') {
                    setEndImageFile(file);
                    setEndImageUrl(null);
                    setEndImagePreview(result);
                } else if (type === 'image1') {
                    setImage1File(file);
                    setImage1Url(null);
                    setImage1Preview(result);
                } else if (type === 'image2') {
                    setImage2File(file);
                    setImage2Url(null);
                    setImage2Preview(result);
                } else if (type === 'image3') {
                    setImage3File(file);
                    setImage3Url(null);
                    setImage3Preview(result);
                }
            };
            reader.readAsDataURL(file);
        } else {
            if (type === 'start') {
                setStartImageFile(null);
                setStartImagePreview(null);
            } else if (type === 'end') {
                setEndImageFile(null);
                setEndImagePreview(null);
            } else if (type === 'image1') {
                setImage1File(null);
                setImage1Preview(null);
            } else if (type === 'image2') {
                setImage2File(null);
                setImage2Preview(null);
            } else if (type === 'image3') {
                setImage3File(null);
                setImage3Preview(null);
            }
        }
    };
    const handleImageSelection = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "MediaGenerationForm.useCallback[handleImageSelection]": (url, type)=>{
            if (type === 'start') {
                setStartImageUrl(url);
                setStartImageFile(null);
                setStartImagePreview(url);
            } else if (type === 'end') {
                setEndImageUrl(url);
                setEndImageFile(null);
                setEndImagePreview(url);
            } else if (type === 'image1') {
                setImage1Url(url);
                setImage1File(null);
                setImage1Preview(url);
            } else if (type === 'image2') {
                setImage2Url(url);
                setImage2File(null);
                setImage2Preview(url);
            } else if (type === 'image3') {
                setImage3Url(url);
                setImage3File(null);
                setImage3Preview(url);
            }
        }
    }["MediaGenerationForm.useCallback[handleImageSelection]"], []);
    const clearImage = (type)=>{
        if (type === 'start') {
            setStartImageFile(null);
            setStartImageUrl(null);
            setStartImagePreview(null);
            if (startFileInputRef.current) startFileInputRef.current.value = "";
        } else if (type === 'end') {
            setEndImageFile(null);
            setEndImageUrl(null);
            setEndImagePreview(null);
            if (endFileInputRef.current) endFileInputRef.current.value = "";
        } else if (type === 'image1') {
            setImage1File(null);
            setImage1Url(null);
            setImage1Preview(null);
            if (image1FileInputRef.current) image1FileInputRef.current.value = "";
        } else if (type === 'image2') {
            setImage2File(null);
            setImage2Url(null);
            setImage2Preview(null);
            if (image2FileInputRef.current) image2FileInputRef.current.value = "";
        } else if (type === 'image3') {
            setImage3File(null);
            setImage3Url(null);
            setImage3Preview(null);
            if (image3FileInputRef.current) image3FileInputRef.current.value = "";
        }
    };
    // Effect to reset preview if inputs change while generating
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "MediaGenerationForm.useEffect": ()=>{
            const hasInputs = prompt || startImageFile || endImageFile || startImageUrl || endImageUrl || image1File || image1Url || image2File || image2Url || image3File || image3Url || positivePrompt || negativePrompt;
            if (hasInputs && currentMediaId) {
                console.log("MediaGenerationForm: Inputs changed during generation, resetting preview.");
                setCurrentMediaId(null);
                setPreviewStatus('idle');
                setPreviewUrl(null);
            }
        }
    }["MediaGenerationForm.useEffect"], [
        prompt,
        startImageFile,
        endImageFile,
        startImageUrl,
        endImageUrl,
        image1File,
        image1Url,
        image2File,
        image2Url,
        image3File,
        image3Url,
        positivePrompt,
        negativePrompt,
        currentMediaId
    ]);
    // --- Submission Logic ---
    async function handleSubmit(e) {
        e.preventDefault();
        if (!userId) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("User not identified. Please refresh.");
            return;
        }
        // Validation based on generation mode
        if (generationMode === 'firstLastFrameVideo') {
            // Wan 2.2 - needs start/end images and prompt
            if (!startImageFile && !startImageUrl) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Please provide a start image.");
                return;
            }
            if (!endImageFile && !endImageUrl) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Please provide an end image.");
                return;
            }
            if (!prompt.trim()) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Please enter a prompt.");
                return;
            }
        } else if (generationMode === 'video') {
            // Qwen Edit - needs at least image1
            if (!image1File && !image1Url) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Please provide an image to edit.");
                return;
            }
        } else if (generationMode === 'image') {
            // Krea Flux - needs prompt only (width/height have defaults)
            if (!prompt.trim()) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Please enter a prompt.");
                return;
            }
        }
        if (userCredits < creditCost) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Not enough credits to generate.");
            return;
        }
        setIsSubmitting(true);
        setPreviewUrl(null);
        setPreviewStatus('pending');
        // Clear any existing generation tracking
        setCurrentMediaId(null);
        let finalStartImageUrl = startImageUrl;
        let finalEndImageUrl = endImageUrl;
        try {
            // Image Compression & Direct Upload
            if (generationMode === 'firstLastFrameVideo') {
                const compressionOptions = {
                    maxSizeMB: 0.95,
                    maxWidthOrHeight: 1920,
                    useWebWorker: true
                };
                if (startImageFile) {
                    let compressedStartFile = startImageFile;
                    try {
                        const compressToastId = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].loading("Compressing start image...");
                        compressedStartFile = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$browser$2d$image$2d$compression$2f$dist$2f$browser$2d$image$2d$compression$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"])(startImageFile, compressionOptions);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].dismiss(compressToastId);
                    } catch (compressionError) {
                        console.error("Start image compression failed:", compressionError);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Failed to compress start image. Using original.");
                    }
                    const uploadResult = await uploadDirectlyToSupabase(compressedStartFile, userId, 'start');
                    if (!uploadResult.success || !uploadResult.url) throw new Error(uploadResult.error || "Failed to upload start image.");
                    finalStartImageUrl = uploadResult.url;
                }
                if (endImageFile) {
                    let compressedEndFile = endImageFile;
                    try {
                        const compressToastId = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].loading("Compressing end image...");
                        compressedEndFile = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$browser$2d$image$2d$compression$2f$dist$2f$browser$2d$image$2d$compression$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"])(endImageFile, compressionOptions);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].dismiss(compressToastId);
                    } catch (compressionError) {
                        console.error("End image compression failed:", compressionError);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Failed to compress end image. Using original.");
                    }
                    const uploadResult = await uploadDirectlyToSupabase(compressedEndFile, userId, 'end');
                    if (!uploadResult.success || !uploadResult.url) throw new Error(uploadResult.error || "Failed to upload end image.");
                    finalEndImageUrl = uploadResult.url;
                }
                if (!finalStartImageUrl || !finalEndImageUrl) throw new Error("Missing required image URLs after processing uploads.");
            }
            // Handle Qwen Edit image uploads
            let finalImage1Url = image1Url;
            let finalImage2Url = image2Url;
            let finalImage3Url = image3Url;
            if (generationMode === 'video') {
                const compressionOptions = {
                    maxSizeMB: 0.95,
                    maxWidthOrHeight: 1920,
                    useWebWorker: true
                };
                if (image1File) {
                    let compressedFile = image1File;
                    try {
                        const compressToastId = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].loading("Compressing image 1...");
                        compressedFile = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$browser$2d$image$2d$compression$2f$dist$2f$browser$2d$image$2d$compression$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"])(image1File, compressionOptions);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].dismiss(compressToastId);
                    } catch (error) {
                        console.error("Image 1 compression failed:", error);
                    }
                    const uploadResult = await uploadDirectlyToSupabase(compressedFile, userId, 'image1');
                    if (!uploadResult.success || !uploadResult.url) throw new Error("Failed to upload image 1.");
                    finalImage1Url = uploadResult.url;
                }
                if (image2File) {
                    let compressedFile = image2File;
                    try {
                        const compressToastId = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].loading("Compressing image 2...");
                        compressedFile = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$browser$2d$image$2d$compression$2f$dist$2f$browser$2d$image$2d$compression$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"])(image2File, compressionOptions);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].dismiss(compressToastId);
                    } catch (error) {
                        console.error("Image 2 compression failed:", error);
                    }
                    const uploadResult = await uploadDirectlyToSupabase(compressedFile, userId, 'image1');
                    if (!uploadResult.success || !uploadResult.url) throw new Error("Failed to upload image 2.");
                    finalImage2Url = uploadResult.url;
                }
                if (image3File) {
                    let compressedFile = image3File;
                    try {
                        const compressToastId = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].loading("Compressing image 3...");
                        compressedFile = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$browser$2d$image$2d$compression$2f$dist$2f$browser$2d$image$2d$compression$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"])(image3File, compressionOptions);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].dismiss(compressToastId);
                    } catch (error) {
                        console.error("Image 3 compression failed:", error);
                    }
                    const uploadResult = await uploadDirectlyToSupabase(compressedFile, userId, 'image1');
                    if (!uploadResult.success || !uploadResult.url) throw new Error("Failed to upload image 3.");
                    finalImage3Url = uploadResult.url;
                }
            }
            // Prepare FormData with mode-specific data
            const formData = new FormData();
            formData.append('generationMode', generationMode);
            formData.append('mediaType', generatedMediaType);
            if (generationMode === 'image') {
                // Krea Flux
                formData.append('prompt', prompt);
                formData.append('width', width.toString());
                formData.append('height', height.toString());
            } else if (generationMode === 'video') {
                // Qwen Edit
                formData.append('image1Url', finalImage1Url);
                formData.append('positivePrompt', positivePrompt);
                formData.append('negativePrompt', negativePrompt);
                if (finalImage2Url) formData.append('image2Url', finalImage2Url);
                if (finalImage3Url) formData.append('image3Url', finalImage3Url);
            } else if (generationMode === 'firstLastFrameVideo') {
                // Wan 2.2
                formData.append('prompt', prompt);
                formData.append('startImageUrl', finalStartImageUrl);
                formData.append('endImageUrl', finalEndImageUrl);
                formData.append('width', videoWidth.toString());
                formData.append('height', videoHeight.toString());
                formData.append('length', videoLength.toString());
            }
            // Call server action
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$actions$2f$data$3a$aaa727__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["generateMedia"])(formData);
            if (!result.success || !result.mediaId) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(result.error || 'Failed to start generation');
                setPreviewStatus('failed');
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].info(`Your ${generatedMediaType} generation has started!`);
                setCurrentMediaId(result.mediaId); // This will trigger Realtime subscription
                if (onGenerationStart) onGenerationStart(result.mediaId);
            }
        } catch (error) {
            console.error(`Submission error:`, error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(error.message || 'An unexpected error occurred during submission.');
            setPreviewStatus('failed');
            setCurrentMediaId(null);
        } finally{
            setIsSubmitting(false);
        }
    }
    const isLoading = isSubmitting || currentMediaId !== null && previewStatus === 'processing';
    const isFirstLastMode = generationMode === 'firstLastFrameVideo';
    const isQwenEdit = generationMode === 'video';
    const isKreaFlux = generationMode === 'image';
    // --- Render Image Input Helper ---
    const renderImageInput = (type, required = true)=>{
        let previewSrc, fileInputRef, selectedUrl, label;
        switch(type){
            case 'start':
                previewSrc = startImagePreview;
                fileInputRef = startFileInputRef;
                selectedUrl = startImageUrl;
                label = 'Start Image';
                break;
            case 'end':
                previewSrc = endImagePreview;
                fileInputRef = endFileInputRef;
                selectedUrl = endImageUrl;
                label = 'End Image';
                break;
            case 'image1':
                previewSrc = image1Preview;
                fileInputRef = image1FileInputRef;
                selectedUrl = image1Url;
                label = 'Primary Image';
                break;
            case 'image2':
                previewSrc = image2Preview;
                fileInputRef = image2FileInputRef;
                selectedUrl = image2Url;
                label = 'Reference Image 2 (Optional)';
                break;
            case 'image3':
                previewSrc = image3Preview;
                fileInputRef = image3FileInputRef;
                selectedUrl = image3Url;
                label = 'Reference Image 3 (Optional)';
                break;
        }
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "space-y-2",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                    htmlFor: `${type}-image-input`,
                    className: "text-base font-medium text-foreground/90",
                    children: label
                }, void 0, false, {
                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                    lineNumber: 461,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex items-center gap-2",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Input"], {
                            id: `${type}-image-input`,
                            ref: fileInputRef,
                            type: "file",
                            accept: "image/png, image/jpeg, image/webp, image/gif",
                            onChange: (e)=>handleFileChange(e, type),
                            className: "hidden",
                            disabled: isLoading
                        }, void 0, false, {
                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                            lineNumber: 463,
                            columnNumber: 12
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                            type: "button",
                            variant: "outline",
                            onClick: ()=>fileInputRef.current?.click(),
                            disabled: isLoading,
                            className: "glass-input bg-white/5 border-white/15 hover:bg-white/10 text-foreground/80 flex-grow",
                            children: [
                                " ",
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$upload$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Upload$3e$__["Upload"], {
                                    className: "mr-2 h-4 w-4"
                                }, void 0, false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                    lineNumber: 464,
                                    columnNumber: 218
                                }, this),
                                " Upload "
                            ]
                        }, void 0, true, {
                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                            lineNumber: 464,
                            columnNumber: 12
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                            className: "text-xs text-muted-foreground mx-1",
                            children: "OR"
                        }, void 0, false, {
                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                            lineNumber: 465,
                            columnNumber: 12
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$components$2f$dashboard$2f$image$2d$selector$2d$popover$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["ImageSelectorPopover"], {
                            selectedUrl: selectedUrl,
                            onImageSelect: (url)=>handleImageSelection(url, type),
                            triggerText: "Select Existing",
                            disabled: isLoading
                        }, void 0, false, {
                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                            lineNumber: 466,
                            columnNumber: 12
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                    lineNumber: 462,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "mt-2",
                    style: {
                        minHeight: '100px'
                    },
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$components$2f$AnimatePresence$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AnimatePresence"], {
                        children: previewSrc && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                            initial: {
                                opacity: 0,
                                height: 0
                            },
                            animate: {
                                opacity: 1,
                                height: '100px'
                            },
                            exit: {
                                opacity: 0,
                                height: 0
                            },
                            transition: {
                                duration: 0.3
                            },
                            className: "relative border border-white/15 rounded-md overflow-hidden p-1 bg-black/10",
                            style: {
                                width: '100px'
                            },
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                    src: previewSrc,
                                    alt: `${type} image preview`,
                                    fill: true,
                                    sizes: "100px",
                                    className: "object-contain",
                                    onError: (e)=>console.error(`Error loading ${type} preview image:`, e)
                                }, void 0, false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                    lineNumber: 472,
                                    columnNumber: 19
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                                    type: "button",
                                    variant: "ghost",
                                    size: "icon",
                                    className: "absolute top-0 right-0 h-6 w-6 bg-black/50 text-white hover:bg-black/70 hover:text-destructive rounded-full m-1 z-10",
                                    onClick: ()=>clearImage(type),
                                    disabled: isLoading,
                                    title: `Remove ${type} image`,
                                    children: [
                                        " ",
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__X$3e$__["X"], {
                                            className: "h-4 w-4"
                                        }, void 0, false, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 473,
                                            columnNumber: 284
                                        }, this),
                                        " "
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                    lineNumber: 473,
                                    columnNumber: 19
                                }, this)
                            ]
                        }, `${type}-preview`, true, {
                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                            lineNumber: 471,
                            columnNumber: 17
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                        lineNumber: 469,
                        columnNumber: 13
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                    lineNumber: 468,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
            lineNumber: 460,
            columnNumber: 7
        }, this);
    };
    // --- Main Return JSX ---
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "grid md:grid-cols-2 gap-8 items-start",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                initial: {
                    opacity: 0,
                    x: -20
                },
                animate: {
                    opacity: 1,
                    x: 0
                },
                transition: {
                    duration: 0.5
                },
                className: "space-y-5",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("form", {
                        onSubmit: handleSubmit,
                        className: "space-y-5",
                        children: [
                            isKreaFlux && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                                                htmlFor: "prompt",
                                                className: "block text-base font-medium mb-2 text-foreground/90",
                                                children: "Image Description"
                                            }, void 0, false, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 493,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$textarea$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Textarea"], {
                                                id: "prompt",
                                                placeholder: "Describe the image you want to create...",
                                                value: prompt,
                                                onChange: (e)=>setPrompt(e.target.value),
                                                disabled: isLoading,
                                                rows: 5,
                                                className: "resize-none glass-input bg-white/5 border-white/15 focus:border-primary/60 focus:ring-primary/30 focus:ring-2 transition-all text-base p-3 rounded-lg"
                                            }, void 0, false, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 494,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 492,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "grid grid-cols-2 gap-4",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                                                        htmlFor: "width",
                                                        className: "block text-sm font-medium mb-2 text-foreground/90",
                                                        children: "Width"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 498,
                                                        columnNumber: 19
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Input"], {
                                                        type: "number",
                                                        id: "width",
                                                        value: width,
                                                        onChange: (e)=>setWidth(parseInt(e.target.value) || 1024),
                                                        min: 512,
                                                        max: 2048,
                                                        step: 64,
                                                        disabled: isLoading,
                                                        className: "glass-input bg-white/5 border-white/15"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 499,
                                                        columnNumber: 19
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 497,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                                                        htmlFor: "height",
                                                        className: "block text-sm font-medium mb-2 text-foreground/90",
                                                        children: "Height"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 502,
                                                        columnNumber: 19
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Input"], {
                                                        type: "number",
                                                        id: "height",
                                                        value: height,
                                                        onChange: (e)=>setHeight(parseInt(e.target.value) || 1024),
                                                        min: 512,
                                                        max: 2048,
                                                        step: 64,
                                                        disabled: isLoading,
                                                        className: "glass-input bg-white/5 border-white/15"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 503,
                                                        columnNumber: 19
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 501,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 496,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true),
                            isQwenEdit && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                children: [
                                    renderImageInput('image1', true),
                                    renderImageInput('image2', false),
                                    renderImageInput('image3', false),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                                                htmlFor: "positive",
                                                className: "block text-base font-medium mb-2 text-foreground/90",
                                                children: "Positive Prompt (Optional)"
                                            }, void 0, false, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 516,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$textarea$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Textarea"], {
                                                id: "positive",
                                                placeholder: "Describe what you want to see or enhance...",
                                                value: positivePrompt,
                                                onChange: (e)=>setPositivePrompt(e.target.value),
                                                disabled: isLoading,
                                                rows: 3,
                                                className: "resize-none glass-input bg-white/5 border-white/15 focus:border-primary/60 focus:ring-primary/30 focus:ring-2 transition-all text-base p-3 rounded-lg"
                                            }, void 0, false, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 517,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 515,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                                                htmlFor: "negative",
                                                className: "block text-base font-medium mb-2 text-foreground/90",
                                                children: "Negative Prompt (Optional)"
                                            }, void 0, false, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 520,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$textarea$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Textarea"], {
                                                id: "negative",
                                                placeholder: "Describe what to avoid...",
                                                value: negativePrompt,
                                                onChange: (e)=>setNegativePrompt(e.target.value),
                                                disabled: isLoading,
                                                rows: 2,
                                                className: "resize-none glass-input bg-white/5 border-white/15 focus:border-primary/60 focus:ring-primary/30 focus:ring-2 transition-all text-base p-3 rounded-lg"
                                            }, void 0, false, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 521,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 519,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true),
                            isFirstLastMode && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                children: [
                                    renderImageInput('start', true),
                                    renderImageInput('end', true),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                                                htmlFor: "prompt",
                                                className: "block text-base font-medium mb-2 text-foreground/90",
                                                children: "Positive Prompt"
                                            }, void 0, false, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 532,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$textarea$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Textarea"], {
                                                id: "prompt",
                                                placeholder: "e.g., 'car crashes through the wall and man comes into the frame screaming'",
                                                value: prompt,
                                                onChange: (e)=>setPrompt(e.target.value),
                                                disabled: isLoading,
                                                rows: 3,
                                                className: "resize-none glass-input bg-white/5 border-white/15 focus:border-primary/60 focus:ring-primary/30 focus:ring-2 transition-all text-base p-3 rounded-lg"
                                            }, void 0, false, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 533,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 531,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "grid grid-cols-3 gap-4",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                                                        htmlFor: "videoWidth",
                                                        className: "block text-sm font-medium mb-2 text-foreground/90",
                                                        children: "Width"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 537,
                                                        columnNumber: 19
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Input"], {
                                                        type: "number",
                                                        id: "videoWidth",
                                                        value: videoWidth,
                                                        onChange: (e)=>setVideoWidth(parseInt(e.target.value) || 512),
                                                        min: 256,
                                                        max: 1024,
                                                        step: 64,
                                                        disabled: isLoading,
                                                        className: "glass-input bg-white/5 border-white/15"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 538,
                                                        columnNumber: 19
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 536,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                                                        htmlFor: "videoHeight",
                                                        className: "block text-sm font-medium mb-2 text-foreground/90",
                                                        children: "Height"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 541,
                                                        columnNumber: 19
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Input"], {
                                                        type: "number",
                                                        id: "videoHeight",
                                                        value: videoHeight,
                                                        onChange: (e)=>setVideoHeight(parseInt(e.target.value) || 512),
                                                        min: 256,
                                                        max: 1024,
                                                        step: 64,
                                                        disabled: isLoading,
                                                        className: "glass-input bg-white/5 border-white/15"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 542,
                                                        columnNumber: 19
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 540,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Label"], {
                                                        htmlFor: "videoLength",
                                                        className: "block text-sm font-medium mb-2 text-foreground/90",
                                                        children: "Length (frames)"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 545,
                                                        columnNumber: 19
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Input"], {
                                                        type: "number",
                                                        id: "videoLength",
                                                        value: videoLength,
                                                        onChange: (e)=>setVideoLength(parseInt(e.target.value) || 81),
                                                        min: 25,
                                                        max: 200,
                                                        step: 1,
                                                        disabled: isLoading,
                                                        className: "glass-input bg-white/5 border-white/15"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                        lineNumber: 546,
                                                        columnNumber: 19
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                lineNumber: 544,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 535,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                                type: "submit",
                                disabled: isLoading || !userId || userCredits < creditCost || isKreaFlux && !prompt.trim() || isQwenEdit && !image1File && !image1Url || isFirstLastMode && (!startImageFile && !startImageUrl || !endImageFile && !endImageUrl || !prompt.trim()),
                                className: "w-full glass-button bg-gradient-to-r from-primary to-secondary text-white hover:opacity-95 hover:shadow-lg transition-all duration-300 shadow-md text-lg py-3 font-semibold",
                                children: isLoading ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                            className: "mr-2 h-5 w-5 animate-spin"
                                        }, void 0, false, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 564,
                                            columnNumber: 30
                                        }, this),
                                        " ",
                                        isSubmitting ? 'Starting...' : 'Generating...'
                                    ]
                                }, void 0, true) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$sparkles$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Sparkles$3e$__["Sparkles"], {
                                            className: "mr-2 h-5 w-5"
                                        }, void 0, false, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 564,
                                            columnNumber: 140
                                        }, this),
                                        " Generate (",
                                        creditCost,
                                        " credits)"
                                    ]
                                }, void 0, true)
                            }, void 0, false, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                lineNumber: 552,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                        lineNumber: 487,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "text-base text-muted-foreground border-t border-white/15 pt-4 space-y-1 bg-white/5 p-4 rounded-lg shadow-inner",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "font-semibold text-foreground/95",
                                        children: "Cost:"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 568,
                                        columnNumber: 14
                                    }, this),
                                    " ",
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "text-primary font-medium",
                                        children: creditCost
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 568,
                                        columnNumber: 78
                                    }, this),
                                    " credits"
                                ]
                            }, void 0, true, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                lineNumber: 568,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "font-semibold text-foreground/95",
                                        children: "Available:"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 569,
                                        columnNumber: 14
                                    }, this),
                                    " ",
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "text-primary font-medium",
                                        children: userCredits.toLocaleString()
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 569,
                                        columnNumber: 83
                                    }, this),
                                    " credits"
                                ]
                            }, void 0, true, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                lineNumber: 569,
                                columnNumber: 11
                            }, this),
                            userCredits < creditCost && !isLoading && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-destructive text-sm flex items-center gap-1 pt-1",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__AlertCircle$3e$__["AlertCircle"], {
                                        className: "w-4 h-4"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 570,
                                        columnNumber: 125
                                    }, this),
                                    " Not enough credits."
                                ]
                            }, void 0, true, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                lineNumber: 570,
                                columnNumber: 56
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                        lineNumber: 567,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                lineNumber: 486,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                initial: {
                    opacity: 0,
                    x: 20
                },
                animate: {
                    opacity: 1,
                    x: 0
                },
                transition: {
                    duration: 0.5,
                    delay: 0.1
                },
                className: "flex flex-col",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                        className: "block text-base font-medium mb-2 text-foreground/90",
                        children: " Result preview "
                    }, void 0, false, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                        lineNumber: 576,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "relative glass-card bg-black/10 border border-white/15 rounded-lg aspect-video md:aspect-square flex items-center justify-center overflow-hidden shadow-inner p-2",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$components$2f$AnimatePresence$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AnimatePresence"], {
                            mode: "wait",
                            children: [
                                isLoading && (previewStatus === 'pending' || previewStatus === 'processing') && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                                    initial: {
                                        opacity: 0,
                                        scale: 0.9
                                    },
                                    animate: {
                                        opacity: 1,
                                        scale: 1
                                    },
                                    exit: {
                                        opacity: 0,
                                        scale: 0.9
                                    },
                                    transition: {
                                        duration: 0.3
                                    },
                                    className: "text-center p-4 flex flex-col items-center justify-center absolute inset-0 bg-black/40 backdrop-blur-md rounded-lg",
                                    children: [
                                        " ",
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                            className: "h-12 w-12 animate-spin text-primary mb-4"
                                        }, void 0, false, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 581,
                                            columnNumber: 306
                                        }, this),
                                        " ",
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-base font-medium text-foreground",
                                            children: [
                                                "Generating your ",
                                                generatedMediaType,
                                                "..."
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 581,
                                            columnNumber: 371
                                        }, this),
                                        " ",
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-sm text-muted-foreground mt-1",
                                            children: "Checking status..."
                                        }, void 0, false, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 581,
                                            columnNumber: 468
                                        }, this),
                                        " "
                                    ]
                                }, "loading", true, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                    lineNumber: 581,
                                    columnNumber: 15
                                }, this),
                                previewStatus === 'completed' && previewUrl && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                                    initial: {
                                        opacity: 0
                                    },
                                    animate: {
                                        opacity: 1
                                    },
                                    transition: {
                                        duration: 0.5
                                    },
                                    className: "relative w-full h-full",
                                    children: generatedMediaType === 'video' ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("video", {
                                        src: previewUrl,
                                        controls: true,
                                        className: "w-full h-full object-contain rounded-md",
                                        preload: "metadata"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 586,
                                        columnNumber: 53
                                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                        src: previewUrl,
                                        alt: prompt || "Generated Media",
                                        fill: true,
                                        className: "object-contain rounded-md",
                                        unoptimized: true
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                        lineNumber: 586,
                                        columnNumber: 166
                                    }, this)
                                }, "completed", false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                    lineNumber: 585,
                                    columnNumber: 15
                                }, this),
                                previewStatus === 'failed' && !isLoading && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                                    initial: {
                                        opacity: 0,
                                        y: 10
                                    },
                                    animate: {
                                        opacity: 1,
                                        y: 0
                                    },
                                    exit: {
                                        opacity: 0,
                                        y: 10
                                    },
                                    transition: {
                                        duration: 0.3
                                    },
                                    className: "text-center p-4 flex flex-col items-center justify-center absolute inset-0 bg-destructive/20 backdrop-blur-sm rounded-lg",
                                    children: [
                                        " ",
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__AlertCircle$3e$__["AlertCircle"], {
                                            className: "h-12 w-12 text-destructive-foreground mb-4"
                                        }, void 0, false, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 591,
                                            columnNumber: 297
                                        }, this),
                                        " ",
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-base font-medium text-destructive-foreground",
                                            children: "Generation failed."
                                        }, void 0, false, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 591,
                                            columnNumber: 368
                                        }, this),
                                        " ",
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-sm text-destructive-foreground/80 mt-1",
                                            children: "Check library or try again."
                                        }, void 0, false, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 591,
                                            columnNumber: 456
                                        }, this),
                                        " "
                                    ]
                                }, "failed", true, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                    lineNumber: 591,
                                    columnNumber: 15
                                }, this),
                                previewStatus === 'idle' && !isLoading && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                                    initial: {
                                        opacity: 0
                                    },
                                    animate: {
                                        opacity: 1
                                    },
                                    transition: {
                                        duration: 0.3
                                    },
                                    className: "text-center p-4 flex flex-col items-center justify-center text-muted-foreground",
                                    children: [
                                        " ",
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "rounded-full bg-primary/10 p-5 w-fit mx-auto mb-5 border border-primary/20 shadow-sm",
                                            children: [
                                                " ",
                                                generatedMediaType === 'image' ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Image$3e$__["Image"], {
                                                    className: "h-10 w-10 text-primary/80"
                                                }, void 0, false, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                    lineNumber: 595,
                                                    columnNumber: 349
                                                }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$film$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Film$3e$__["Film"], {
                                                    className: "h-10 w-10 text-primary/80"
                                                }, void 0, false, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                                    lineNumber: 595,
                                                    columnNumber: 405
                                                }, this),
                                                " "
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 595,
                                            columnNumber: 212
                                        }, this),
                                        " ",
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-base",
                                            children: [
                                                " Your ",
                                                generatedMediaType,
                                                " preview will appear here "
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                            lineNumber: 595,
                                            columnNumber: 460
                                        }, this),
                                        " "
                                    ]
                                }, "idle", true, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                                    lineNumber: 595,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                            lineNumber: 578,
                            columnNumber: 11
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                        lineNumber: 577,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
                lineNumber: 575,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/apps/web/src/components/dashboard/media-generation-form.tsx",
        lineNumber: 484,
        columnNumber: 6
    }, this);
}
_s(MediaGenerationForm, "Hp6o9WGT8ZuAY9bEZ6Rqy89WWv4=");
_c = MediaGenerationForm;
var _c;
__turbopack_context__.k.register(_c, "MediaGenerationForm");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/apps/web/src/lib/actions/data:9b33ab [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"60731516870219cb054feaeed33867daec16e51142":"deleteMedia"},"apps/web/src/lib/actions/media.actions.ts",""] */ __turbopack_context__.s({
    "deleteMedia": (()=>deleteMedia)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var deleteMedia = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("60731516870219cb054feaeed33867daec16e51142", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "deleteMedia"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vbWVkaWEuYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL2FjdGlvbnMvbWVkaWEuYWN0aW9ucy50c1xyXG4ndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAcmVwby9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyB1c2VDcmVkaXRzIH0gZnJvbSAnQC9saWIvY3JlZGl0cyc7XHJcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSAnbmV4dC9jYWNoZSc7XHJcbmltcG9ydCB7IE1lZGlhVHlwZSwgQ1JFRElUX0NPU1RTLCBHZW5lcmF0aW9uUmVzdWx0LCBHZW5lcmF0aW9uTW9kZSB9IGZyb20gJ0AvbGliL2NvbnN0YW50cy9tZWRpYSc7XHJcbi8vIEltcG9ydCB0aGUgc3BlY2lmaWMgSW5zZXJ0IHR5cGUgYW5kIEdlbmVyYXRlZE1lZGlhIHR5cGVcclxuaW1wb3J0IHsgRGF0YWJhc2UsIEdlbmVyYXRlZE1lZGlhIH0gZnJvbSAnQC90eXBlcy9kYl90eXBlcyc7XHJcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAcmVwby9zdXBhYmFzZS9hZG1pbic7XHJcbi8vIEltcG9ydCBvbmx5IHRoZSBuZWNlc3Nhcnkgc3RvcmFnZSBzZXJ2aWNlIGZ1bmN0aW9ucyAodXNlZCBieSBhY3Rpb25zIGJlbG93KVxyXG5pbXBvcnQgeyBsaXN0VXNlckZpbGVzIGFzIGxpc3RVc2VyRmlsZXNTZXJ2aWNlLCBkZWxldGVGaWxlIGFzIGRlbGV0ZUZpbGVTZXJ2aWNlIH0gZnJvbSAnQC9saWIvc3RvcmFnZS9zdXBhYmFzZS1zdG9yYWdlJztcclxuLy8gSW1wb3J0IFBpeGlvIEFQSSBjbGllbnQgYW5kIG1vZGVsc1xyXG5pbXBvcnQge1xyXG4gIFBJWElPX01PREVMUyxcclxuICBxdWV1ZVBpeGlvUnVuLFxyXG4gIGNhbmNlbFBpeGlvUnVuLFxyXG4gIGNyZWF0ZVJ1blJlcXVlc3QsXHJcbiAgdHlwZSBLcmVhRmx1eElucHV0cyxcclxuICB0eXBlIFdhbkZpcnN0TGFzdEZyYW1lSW5wdXRzXHJcbn0gZnJvbSAnQHJlcG8vcGl4aW8tYXBpJztcclxuXHJcbi8vIERlZmluZSB0aGUgc3BlY2lmaWMgdHlwZSBmb3IgaW5zZXJ0aW9uLCBkZXJpdmVkIGZyb20gZGJfdHlwZXMudHNcclxudHlwZSBHZW5lcmF0ZWRNZWRpYUluc2VydCA9IERhdGFiYXNlWydwdWJsaWMnXVsnVGFibGVzJ11bJ2dlbmVyYXRlZF9tZWRpYSddWydJbnNlcnQnXTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWF0ZXMgbWVkaWEgZ2VuZXJhdGlvbiBieSBjcmVhdGluZyBhIHJlY29yZCBhbmQgaW52b2tpbmcgdGhlIFN1cGFiYXNlIEZ1bmN0aW9uLlxyXG4gKiBFeHBlY3RzIGltYWdlIFVSTHMgZm9yIG1vZGVzIHRoYXQgcmVxdWlyZSBpbnB1dCBpbWFnZXMgKGNsaWVudCBoYW5kbGVzIHVwbG9hZCkuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZWRpYShmb3JtRGF0YTogRm9ybURhdGEpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIG1lZGlhSWQ/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG4gIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiB1c2VyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xyXG5cclxuICBpZiAoIXVzZXIgfHwgdXNlckVycm9yKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvcicgfTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBSZWFkIGRhdGEgZnJvbSBGb3JtRGF0YSAtLS1cclxuICBjb25zdCBnZW5lcmF0aW9uTW9kZSA9IGZvcm1EYXRhLmdldCgnZ2VuZXJhdGlvbk1vZGUnKSBhcyBHZW5lcmF0aW9uTW9kZTtcclxuICBcclxuICAvLyBEZXRlcm1pbmUgbWVkaWEgdHlwZSBiYXNlZCBvbiBtb2RlbCBjYXRlZ29yeSwgbm90IGdlbmVyYXRpb24gbW9kZSBuYW1lXHJcbiAgY29uc3QgbWVkaWFUeXBlOiBNZWRpYVR5cGUgPSBnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nID8gJ3ZpZGVvJyA6ICdpbWFnZSc7XHJcbiAgLy8gS3JlYSBGbHV4IChpbWFnZSBtb2RlKSDihpIgaW1hZ2VcclxuICAvLyBRd2VuIEVkaXQgKHZpZGVvIG1vZGUpIOKGkiBpbWFnZSAoaXQncyBlZGl0aW5nLCBub3QgZ2VuZXJhdGluZyB2aWRlbylcclxuICAvLyBXYW4gMi4yIChmaXJzdExhc3RGcmFtZVZpZGVvIG1vZGUpIOKGkiB2aWRlb1xyXG5cclxuICAvLyAtLS0gVmFsaWRhdGlvbiAtLS1cclxuICBpZiAoIWdlbmVyYXRpb25Nb2RlKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycgfTtcclxuICB9XHJcblxyXG4gIC8vIE1vZGUtc3BlY2lmaWMgaW5wdXQgZXh0cmFjdGlvbiBhbmQgdmFsaWRhdGlvblxyXG4gIGxldCBwcm9tcHQgPSAnJztcclxuICBsZXQgc3RhcnRJbWFnZVVybDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgbGV0IGVuZEltYWdlVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UxVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UyVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UzVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgcG9zaXRpdmVQcm9tcHQgPSAnJztcclxuICBsZXQgbmVnYXRpdmVQcm9tcHQgPSAnJztcclxuICBsZXQgd2lkdGggPSAxMDI0O1xyXG4gIGxldCBoZWlnaHQgPSAxMDI0O1xyXG4gIGxldCB2aWRlb1dpZHRoID0gNTEyO1xyXG4gIGxldCB2aWRlb0hlaWdodCA9IDUxMjtcclxuICBsZXQgdmlkZW9MZW5ndGggPSA4MTtcclxuXHJcbiAgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnaW1hZ2UnKSB7XHJcbiAgICAvLyBLcmVhIEZsdXhcclxuICAgIHByb21wdCA9IGZvcm1EYXRhLmdldCgncHJvbXB0JykgYXMgc3RyaW5nO1xyXG4gICAgd2lkdGggPSBwYXJzZUludChmb3JtRGF0YS5nZXQoJ3dpZHRoJykgYXMgc3RyaW5nKSB8fCAxMDI0O1xyXG4gICAgaGVpZ2h0ID0gcGFyc2VJbnQoZm9ybURhdGEuZ2V0KCdoZWlnaHQnKSBhcyBzdHJpbmcpIHx8IDEwMjQ7XHJcbiAgICBpZiAoIXByb21wdD8udHJpbSgpKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHByb21wdCcgfTtcclxuICB9IGVsc2UgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAndmlkZW8nKSB7XHJcbiAgICAvLyBRd2VuIEVkaXRcclxuICAgIGltYWdlMVVybCA9IGZvcm1EYXRhLmdldCgnaW1hZ2UxVXJsJykgYXMgc3RyaW5nO1xyXG4gICAgaW1hZ2UyVXJsID0gZm9ybURhdGEuZ2V0KCdpbWFnZTJVcmwnKSBhcyBzdHJpbmcgfHwgbnVsbDtcclxuICAgIGltYWdlM1VybCA9IGZvcm1EYXRhLmdldCgnaW1hZ2UzVXJsJykgYXMgc3RyaW5nIHx8IG51bGw7XHJcbiAgICBwb3NpdGl2ZVByb21wdCA9IGZvcm1EYXRhLmdldCgncG9zaXRpdmVQcm9tcHQnKSBhcyBzdHJpbmcgfHwgJyc7XHJcbiAgICBuZWdhdGl2ZVByb21wdCA9IGZvcm1EYXRhLmdldCgnbmVnYXRpdmVQcm9tcHQnKSBhcyBzdHJpbmcgfHwgJyc7XHJcbiAgICBpZiAoIWltYWdlMVVybCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWlzc2luZyBpbWFnZSBmb3IgZWRpdGluZycgfTtcclxuICB9IGVsc2UgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnZmlyc3RMYXN0RnJhbWVWaWRlbycpIHtcclxuICAgIC8vIFdhbiAyLjJcclxuICAgIHByb21wdCA9IGZvcm1EYXRhLmdldCgncHJvbXB0JykgYXMgc3RyaW5nO1xyXG4gICAgc3RhcnRJbWFnZVVybCA9IGZvcm1EYXRhLmdldCgnc3RhcnRJbWFnZVVybCcpIGFzIHN0cmluZztcclxuICAgIGVuZEltYWdlVXJsID0gZm9ybURhdGEuZ2V0KCdlbmRJbWFnZVVybCcpIGFzIHN0cmluZztcclxuICAgIHZpZGVvV2lkdGggPSBwYXJzZUludChmb3JtRGF0YS5nZXQoJ3dpZHRoJykgYXMgc3RyaW5nKSB8fCA1MTI7XHJcbiAgICB2aWRlb0hlaWdodCA9IHBhcnNlSW50KGZvcm1EYXRhLmdldCgnaGVpZ2h0JykgYXMgc3RyaW5nKSB8fCA1MTI7XHJcbiAgICB2aWRlb0xlbmd0aCA9IHBhcnNlSW50KGZvcm1EYXRhLmdldCgnbGVuZ3RoJykgYXMgc3RyaW5nKSB8fCA4MTtcclxuICAgIGlmICghcHJvbXB0Py50cmltKCkpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgcHJvbXB0JyB9O1xyXG4gICAgaWYgKCFzdGFydEltYWdlVXJsKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHN0YXJ0IGltYWdlIFVSTCcgfTtcclxuICAgIGlmICghZW5kSW1hZ2VVcmwpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgZW5kIGltYWdlIFVSTCcgfTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNyZWRpdENvc3QgPSBDUkVESVRfQ09TVFNbZ2VuZXJhdGlvbk1vZGVdO1xyXG4gIGlmIChjcmVkaXRDb3N0ID09PSB1bmRlZmluZWQpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZ2VuZXJhdGlvbiBtb2RlJyB9O1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIDEuIENoZWNrIGFuZCBkZWR1Y3QgY3JlZGl0c1xyXG4gICAgY29uc3QgY3JlZGl0U3VjY2VzcyA9IGF3YWl0IHVzZUNyZWRpdHMoXHJcbiAgICAgIHVzZXIuaWQsXHJcbiAgICAgIGNyZWRpdENvc3QsXHJcbiAgICAgIGBHZW5lcmF0ZSAke2dlbmVyYXRpb25Nb2RlfTogXCIke3Byb21wdC5zbGljZSgwLCAzMCl9JHtwcm9tcHQubGVuZ3RoID4gMzAgPyAnLi4uJyA6ICcnfVwiYFxyXG4gICAgKTtcclxuICAgIGlmICghY3JlZGl0U3VjY2VzcykgeyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOb3QgZW5vdWdoIGNyZWRpdHMnIH07IH1cclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDcmVkaXRzIGRlZHVjdGVkIHN1Y2Nlc3NmdWxseSBmb3IgdXNlciAke3VzZXIuaWR9YCk7XHJcblxyXG4gICAgLy8gMi4gQ3JlYXRlIGluaXRpYWwgJ3BlbmRpbmcnIHJlY29yZCBpbiBEQlxyXG4gICAgY29uc3QgaW5zZXJ0UGF5bG9hZDogR2VuZXJhdGVkTWVkaWFJbnNlcnQgPSB7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcclxuICAgICAgICBwcm9tcHQ6IHByb21wdCB8fCBwb3NpdGl2ZVByb21wdCB8fCAnSW1hZ2UgZWRpdCcsIC8vIFVzZSBhcHByb3ByaWF0ZSBwcm9tcHRcclxuICAgICAgICBtZWRpYV90eXBlOiBtZWRpYVR5cGUsXHJcbiAgICAgICAgY3JlZGl0c191c2VkOiBjcmVkaXRDb3N0LFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIG1lZGlhX3VybDogJycsIC8vIFJlcXVpcmVkIGJ5IEluc2VydCB0eXBlXHJcbiAgICAgICAgc3RvcmFnZV9wYXRoOiAnJywgLy8gUmVxdWlyZWQgYnkgSW5zZXJ0IHR5cGVcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgZ2VuZXJhdGlvbk1vZGUsXHJcbiAgICAgICAgICAuLi4oZ2VuZXJhdGlvbk1vZGUgPT09ICdpbWFnZScgJiYgeyB3aWR0aCwgaGVpZ2h0IH0pLFxyXG4gICAgICAgICAgLi4uKHBvc2l0aXZlUHJvbXB0ICYmIHsgcG9zaXRpdmVQcm9tcHQsIG5lZ2F0aXZlUHJvbXB0IH0pXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nKSB7XHJcbiAgICAgICAgaW5zZXJ0UGF5bG9hZC5zdGFydF9pbWFnZV91cmwgPSBzdGFydEltYWdlVXJsO1xyXG4gICAgICAgIGluc2VydFBheWxvYWQuZW5kX2ltYWdlX3VybCA9IGVuZEltYWdlVXJsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdNZWRpYVJlY29yZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKS5pbnNlcnQoaW5zZXJ0UGF5bG9hZCkuc2VsZWN0KCdpZCcpLnNpbmdsZSgpO1xyXG4gICAgaWYgKGluc2VydEVycm9yIHx8ICFuZXdNZWRpYVJlY29yZCkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiW0FjdGlvbl0gRmFpbGVkIHRvIGluc2VydCBpbml0aWFsIG1lZGlhIHJlY29yZDpcIiwgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBUT0RPOiBDb25zaWRlciByZWZ1bmRpbmcgY3JlZGl0cyBoZXJlIGlmIGluc2VydCBmYWlscyBhZnRlciBkZWR1Y3Rpb25cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBgRmFpbGVkIHRvIGNyZWF0ZSBnZW5lcmF0aW9uIHJlY29yZDogJHtpbnNlcnRFcnJvcj8ubWVzc2FnZX1gIH07XHJcbiAgICB9XHJcbiAgICBjb25zdCBtZWRpYUlkID0gbmV3TWVkaWFSZWNvcmQuaWQ7XHJcbiAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gSW5pdGlhbCBtZWRpYSByZWNvcmQgY3JlYXRlZCB3aXRoIElEOiAke21lZGlhSWR9YCk7XHJcblxyXG4gICAgLy8gMy4gUHJlcGFyZSB3ZWJob29rIFVSTCBmb3IgUGl4aW8gQVBJIGNhbGxiYWNrc1xyXG4gICAgY29uc3Qgd2ViaG9va1VybCA9IGAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NJVEVfVVJMfS9hcGkvd2ViaG9va3MvcGl4aW9gO1xyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFVzaW5nIHdlYmhvb2sgVVJMOiAke3dlYmhvb2tVcmx9YCk7XHJcblxyXG4gICAgLy8gNC4gR2V0IEFQSSBrZXlcclxuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlBJWElPX0RFUExPWV9BUElfS0VZO1xyXG4gICAgaWYgKCFhcGlLZXkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignW0FjdGlvbl0gUElYSU9fREVQTE9ZX0FQSV9LRVkgbm90IGNvbmZpZ3VyZWQnKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQVBJIGtleSBub3QgY29uZmlndXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA1LiBTZWxlY3QgbW9kZWwgYW5kIGNhbGwgUGl4aW8gQVBJIGJhc2VkIG9uIGdlbmVyYXRpb24gbW9kZVxyXG4gICAgbGV0IHBpeGlvUmVzdWx0O1xyXG4gICAgbGV0IHNlbGVjdGVkTW9kZWw7XHJcblxyXG4gICAgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnaW1hZ2UnKSB7XHJcbiAgICAgIC8vIFVzZSBLcmVhIEZsdXggbW9kZWxcclxuICAgICAgc2VsZWN0ZWRNb2RlbCA9IFBJWElPX01PREVMUy5rcmVhRmx1eDtcclxuICAgICAgY29uc3QgaW5wdXRzOiBLcmVhRmx1eElucHV0cyA9IHtcclxuICAgICAgICB0ZXh0OiBwcm9tcHQsXHJcbiAgICAgICAgd2lkdGgsXHJcbiAgICAgICAgaGVpZ2h0XHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSdW5SZXF1ZXN0KHNlbGVjdGVkTW9kZWwsIGlucHV0cywge1xyXG4gICAgICAgIHdlYmhvb2s6IHdlYmhvb2tVcmwsXHJcbiAgICAgICAgd2ViaG9va0ludGVybWVkaWF0ZVN0YXR1czogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBQaXhpbyBBUEkgZm9yIG1lZGlhSWQ6ICR7bWVkaWFJZH0sIG1vZGVsOiAke3NlbGVjdGVkTW9kZWwubmFtZX1gKTtcclxuICAgICAgcGl4aW9SZXN1bHQgPSBhd2FpdCBxdWV1ZVBpeGlvUnVuKHJlcXVlc3QsIGFwaUtleSk7XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ3ZpZGVvJykge1xyXG4gICAgICAvLyBVc2UgUXdlbiBFZGl0IG1vZGVsXHJcbiAgICAgIHNlbGVjdGVkTW9kZWwgPSBQSVhJT19NT0RFTFMucXdlbkVkaXQ7XHJcbiAgICAgIGNvbnN0IGlucHV0czogaW1wb3J0KCdAcmVwby9waXhpby1hcGknKS5Rd2VuRWRpdElucHV0cyA9IHtcclxuICAgICAgICBpbWFnZTE6IGltYWdlMVVybCEsXHJcbiAgICAgICAgcG9zaXRpdmU6IHBvc2l0aXZlUHJvbXB0LFxyXG4gICAgICAgIG5lZ2F0aXZlOiBuZWdhdGl2ZVByb21wdCxcclxuICAgICAgICAuLi4oaW1hZ2UyVXJsICYmIHsgaW1hZ2UyOiBpbWFnZTJVcmwgfSksXHJcbiAgICAgICAgLi4uKGltYWdlM1VybCAmJiB7IGltYWdlMzogaW1hZ2UzVXJsIH0pXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSdW5SZXF1ZXN0KHNlbGVjdGVkTW9kZWwsIGlucHV0cywge1xyXG4gICAgICAgIHdlYmhvb2s6IHdlYmhvb2tVcmwsXHJcbiAgICAgICAgd2ViaG9va0ludGVybWVkaWF0ZVN0YXR1czogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBQaXhpbyBBUEkgZm9yIG1lZGlhSWQ6ICR7bWVkaWFJZH0sIG1vZGVsOiAke3NlbGVjdGVkTW9kZWwubmFtZX1gKTtcclxuICAgICAgcGl4aW9SZXN1bHQgPSBhd2FpdCBxdWV1ZVBpeGlvUnVuKHJlcXVlc3QsIGFwaUtleSk7XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nKSB7XHJcbiAgICAgIC8vIFVzZSBXYW4gRmlyc3QvTGFzdCBGcmFtZSBtb2RlbFxyXG4gICAgICBzZWxlY3RlZE1vZGVsID0gUElYSU9fTU9ERUxTLndhbkZpcnN0TGFzdEZyYW1lO1xyXG4gICAgICBjb25zdCBpbnB1dHM6IFdhbkZpcnN0TGFzdEZyYW1lSW5wdXRzID0ge1xyXG4gICAgICAgIHN0YXJ0X2ltYWdlOiBzdGFydEltYWdlVXJsISxcclxuICAgICAgICBlbmRfaW1hZ2U6IGVuZEltYWdlVXJsISxcclxuICAgICAgICBwb3NpdGl2ZTogcHJvbXB0LCAvLyBXYW4gdXNlcyAncG9zaXRpdmUnIG5vdCAncHJvbXB0J1xyXG4gICAgICAgIG5lZ2F0aXZlOiAnJyxcclxuICAgICAgICB3aWR0aDogdmlkZW9XaWR0aCxcclxuICAgICAgICBoZWlnaHQ6IHZpZGVvSGVpZ2h0LFxyXG4gICAgICAgIGxlbmd0aDogdmlkZW9MZW5ndGhcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJ1blJlcXVlc3Qoc2VsZWN0ZWRNb2RlbCwgaW5wdXRzLCB7XHJcbiAgICAgICAgd2ViaG9vazogd2ViaG9va1VybCxcclxuICAgICAgICB3ZWJob29rSW50ZXJtZWRpYXRlU3RhdHVzOiBmYWxzZVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDYWxsaW5nIFBpeGlvIEFQSSBmb3IgbWVkaWFJZDogJHttZWRpYUlkfSwgbW9kZWw6ICR7c2VsZWN0ZWRNb2RlbC5uYW1lfWApO1xyXG4gICAgICBwaXhpb1Jlc3VsdCA9IGF3YWl0IHF1ZXVlUGl4aW9SdW4ocmVxdWVzdCwgYXBpS2V5KTtcclxuICAgICAgXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBVbnN1cHBvcnRlZCBnZW5lcmF0aW9uIG1vZGU6ICR7Z2VuZXJhdGlvbk1vZGV9YCk7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1Vuc3VwcG9ydGVkIGdlbmVyYXRpb24gbW9kZScgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA2LiBDaGVjayBQaXhpbyBBUEkgcmVzdWx0XHJcblxyXG4gICAgaWYgKCFwaXhpb1Jlc3VsdC5zdWNjZXNzIHx8ICFwaXhpb1Jlc3VsdC5kYXRhKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIFBpeGlvIEFQSSBlcnJvcjpgLCBwaXhpb1Jlc3VsdC5lcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgcmVjb3JkIHRvIGZhaWxlZFxyXG4gICAgICBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ2dlbmVyYXRlZF9tZWRpYScpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgZXJyb3I6IHBpeGlvUmVzdWx0LmVycm9yIHx8ICdBUEkgcmVxdWVzdCBmYWlsZWQnLFxyXG4gICAgICAgICAgICBmYWlsZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBwaXhpb1Jlc3VsdC5lcnJvciB8fCAnQVBJIHJlcXVlc3QgZmFpbGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJ1bklkID0gcGl4aW9SZXN1bHQuZGF0YS5ydW5faWQ7XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFBpeGlvIEFQSSBydW4gc3RhcnRlZCB3aXRoIElEOiAke3J1bklkfSB1c2luZyBtb2RlbDogJHtzZWxlY3RlZE1vZGVsLm5hbWV9YCk7XHJcblxyXG4gICAgLy8gNy4gVXBkYXRlIHJlY29yZCB3aXRoIHJ1bl9pZCwgbW9kZWwgaW5mbywgYW5kIHByb2Nlc3Npbmcgc3RhdHVzXHJcbiAgICBjb25zdCB7IGVycm9yOiBydW5JZFVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBzdGF0dXM6ICdwcm9jZXNzaW5nJyxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgcnVuX2lkOiBydW5JZCxcclxuICAgICAgICAgIGdlbmVyYXRpb25Nb2RlLFxyXG4gICAgICAgICAgbW9kZWxfaWQ6IHNlbGVjdGVkTW9kZWwuaWQsXHJcbiAgICAgICAgICBtb2RlbF9uYW1lOiBzZWxlY3RlZE1vZGVsLm5hbWUsXHJcbiAgICAgICAgICBzdGFydGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKTtcclxuXHJcbiAgICBpZiAocnVuSWRVcGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBFcnJvciB1cGRhdGluZyByZWNvcmQgd2l0aCBydW5faWQ6YCwgcnVuSWRVcGRhdGVFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gOC4gUmV2YWxpZGF0ZSBwYXRoIHRvIHNob3cgcHJvY2Vzc2luZyBzdGF0ZVxyXG4gICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuXHJcbiAgICAvLyA5LiBSZXR1cm4gc3VjY2VzcyAod2ViaG9vayB3aWxsIGhhbmRsZSBjb21wbGV0aW9uKVxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBpbml0aWF0ZWQgZ2VuZXJhdGlvbiBmb3IgJHttZWRpYUlkfWApO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVkaWFJZDogbWVkaWFJZCB9O1xyXG5cclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbQWN0aW9uXSBFcnJvciBpbiBnZW5lcmF0ZU1lZGlhIGFjdGlvbjonLCBlcnJvcik7XHJcbiAgICAvLyBJZiB0aGUgZXJyb3IgaGFwcGVuZWQgYmVmb3JlIGludm9jYXRpb24gKGUuZy4sIGNyZWRpdCBkZWR1Y3Rpb24pLCByZXR1cm4gZXJyb3JcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENhbmNlbHMgYSBydW5uaW5nIG1lZGlhIGdlbmVyYXRpb25cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYW5jZWxHZW5lcmF0aW9uKG1lZGlhSWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICBpZiAoIW1lZGlhSWQpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01lZGlhIElEIGlzIHJlcXVpcmVkJyB9O1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuXHJcbiAgaWYgKCF1c2VyIHx8IHVzZXJFcnJvcikge1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH07XHJcbiAgfVxyXG5cclxuICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FuY2VsbGluZyBnZW5lcmF0aW9uIGZvciBtZWRpYUlkOiAke21lZGlhSWR9YCk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBGZXRjaCB0aGUgbWVkaWEgcmVjb3JkIHRvIHZlcmlmeSBvd25lcnNoaXAgYW5kIGdldCBydW5faWRcclxuICAgIGNvbnN0IHsgZGF0YTogbWVkaWFSZWNvcmQsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdXNlcl9pZCwgc3RhdHVzLCBtZXRhZGF0YScpXHJcbiAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIW1lZGlhUmVjb3JkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGZldGNoaW5nIG1lZGlhICR7bWVkaWFJZH06YCwgZmV0Y2hFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01lZGlhIHJlY29yZCBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgaWYgKG1lZGlhUmVjb3JkLnVzZXJfaWQgIT09IHVzZXIuaWQpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBbQWN0aW9uXSBVc2VyICR7dXNlci5pZH0gYXR0ZW1wdGVkIHRvIGNhbmNlbCBtZWRpYSAke21lZGlhSWR9IG93bmVkIGJ5ICR7bWVkaWFSZWNvcmQudXNlcl9pZH1gKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnUGVybWlzc2lvbiBkZW5pZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgY2FuY2VsbGFibGVcclxuICAgIGlmICghWydwZW5kaW5nJywgJ3Byb2Nlc3NpbmcnXS5pbmNsdWRlcyhtZWRpYVJlY29yZC5zdGF0dXMpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogYENhbm5vdCBjYW5jZWwgJHttZWRpYVJlY29yZC5zdGF0dXN9IGdlbmVyYXRpb25gIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IHJ1bl9pZCBmcm9tIG1ldGFkYXRhXHJcbiAgICBjb25zdCBydW5JZCA9IChtZWRpYVJlY29yZC5tZXRhZGF0YSBhcyBhbnkpPy5ydW5faWQ7XHJcbiAgICBcclxuICAgIGlmICghcnVuSWQpIHtcclxuICAgICAgLy8gTm8gcnVuX2lkIHlldCwganVzdCB1cGRhdGUgc3RhdHVzIHRvIGZhaWxlZFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gTm8gcnVuX2lkIGZvciAke21lZGlhSWR9LCBtYXJraW5nIGFzIGNhbmNlbGxlZCBsb2NhbGx5YCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgc3RhdHVzOiAnZmFpbGVkJyxcclxuICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgIC4uLihtZWRpYVJlY29yZC5tZXRhZGF0YSBhcyBvYmplY3QgfHwge30pLFxyXG4gICAgICAgICAgICBlcnJvcjogJ0NhbmNlbGxlZCBieSB1c2VyJyxcclxuICAgICAgICAgICAgY2FuY2VsbGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKTtcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIHVwZGF0aW5nIGNhbmNlbGxlZCBzdGF0dXM6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byBjYW5jZWwgZ2VuZXJhdGlvbicgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGwgUGl4aW8gQVBJIHRvIGNhbmNlbCB0aGUgcnVuIHVzaW5nIHRoZSBjbGllbnRcclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDYWxsaW5nIFBpeGlvIEFQSSB0byBjYW5jZWwgcnVuOiAke3J1bklkfWApO1xyXG4gICAgXHJcbiAgICBjb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5QSVhJT19ERVBMT1lfQVBJX0tFWTtcclxuICAgIGlmICghYXBpS2V5KSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0FQSSBrZXkgbm90IGNvbmZpZ3VyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2FuY2VsUmVzdWx0ID0gYXdhaXQgY2FuY2VsUGl4aW9SdW4ocnVuSWQsIGFwaUtleSk7XHJcblxyXG4gICAgLy8gTm90ZTogRXZlbiBpZiB0aGUgY2FuY2VsIEFQSSBjYWxsIGZhaWxzLCB3ZSBzdGlsbCBtYXJrIGl0IGFzIGNhbmNlbGxlZCBsb2NhbGx5XHJcbiAgICBpZiAoIWNhbmNlbFJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihgW0FjdGlvbl0gUGl4aW8gY2FuY2VsIEFQSSBmYWlsZWQ6ICR7Y2FuY2VsUmVzdWx0LmVycm9yfSwgYnV0IGNvbnRpbnVpbmcgd2l0aCBsb2NhbCBjYW5jZWxsYXRpb25gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgZGF0YWJhc2UgdG8gY2FuY2VsbGVkL2ZhaWxlZCBzdGF0dXNcclxuICAgIGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAuLi4obWVkaWFSZWNvcmQubWV0YWRhdGEgYXMgb2JqZWN0IHx8IHt9KSxcclxuICAgICAgICAgIGVycm9yOiAnQ2FuY2VsbGVkIGJ5IHVzZXInLFxyXG4gICAgICAgICAgY2FuY2VsbGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICBjYW5jZWxfYXBpX3N0YXR1czogY2FuY2VsUmVzdWx0LnN1Y2Nlc3MgPyAnc3VjY2VzcycgOiAnZmFpbGVkJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbQWN0aW9uXSBFcnJvciB1cGRhdGluZyBjYW5jZWxsZWQgc3RhdHVzOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRmFpbGVkIHRvIHVwZGF0ZSBjYW5jZWxsYXRpb24gc3RhdHVzJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBTdWNjZXNzZnVsbHkgY2FuY2VsbGVkIGdlbmVyYXRpb24gJHttZWRpYUlkfWApO1xyXG4gICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihgW0FjdGlvbl0gRXJyb3IgY2FuY2VsbGluZyBnZW5lcmF0aW9uICR7bWVkaWFJZH06YCwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRGVsZXRlcyBhIG1lZGlhIGl0ZW0gcmVjb3JkIGFuZCBpdHMgYXNzb2NpYXRlZCBmaWxlIGZyb20gc3RvcmFnZS5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVNZWRpYShtZWRpYUlkOiBzdHJpbmcsIHN0b3JhZ2VQYXRoOiBzdHJpbmcgfCBudWxsKTogUHJvbWlzZTx7XHJcbiAgICBzdWNjZXNzOiBib29sZWFuO1xyXG4gICAgZXJyb3I/OiBzdHJpbmc7XHJcbiAgfT4ge1xyXG4gICAgaWYgKCFtZWRpYUlkKSB7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJNZWRpYSBJRCBpcyByZXF1aXJlZC5cIiB9OyB9XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpOyAvLyBVc2Ugc2VydmVyIGNsaWVudCB0byBnZXQgdXNlclxyXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcbiAgICBpZiAoIXVzZXIgfHwgdXNlckVycm9yKSB7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIGVycm9yJyB9OyB9XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIERlbGV0aW5nIG1lZGlhICR7bWVkaWFJZH0gKHBhdGg6ICR7c3RvcmFnZVBhdGggfHwgJ04vQSd9KSBmb3IgdXNlciAke3VzZXIuaWR9YCk7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBWZXJpZnkgb3duZXJzaGlwIHVzaW5nIGFkbWluIGNsaWVudFxyXG4gICAgICBjb25zdCB7IGRhdGE6IG1lZGlhUmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKS5zZWxlY3QoJ2lkLCB1c2VyX2lkLCBzdG9yYWdlX3BhdGgnKS5lcSgnaWQnLCBtZWRpYUlkKS5zaW5nbGUoKTtcclxuICAgICAgaWYgKGZldGNoRXJyb3IgfHwgIW1lZGlhUmVjb3JkKSB7IGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGZldGNoaW5nIG1lZGlhICR7bWVkaWFJZH0gZm9yIGRlbGV0aW9uIG9yIG5vdCBmb3VuZDpgLCBmZXRjaEVycm9yKTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWVkaWEgcmVjb3JkIG5vdCBmb3VuZC4nIH07IH1cclxuICAgICAgaWYgKG1lZGlhUmVjb3JkLnVzZXJfaWQgIT09IHVzZXIuaWQpIHsgY29uc29sZS53YXJuKGBbQWN0aW9uXSBVc2VyICR7dXNlci5pZH0gYXR0ZW1wdGVkIHRvIGRlbGV0ZSBtZWRpYSAke21lZGlhSWR9IG93bmVkIGJ5ICR7bWVkaWFSZWNvcmQudXNlcl9pZH0uIERlbnlpbmcuYCk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1Blcm1pc3Npb24gZGVuaWVkLicgfTsgfVxyXG5cclxuICAgICAgY29uc3QgYWN0dWFsU3RvcmFnZVBhdGggPSBtZWRpYVJlY29yZC5zdG9yYWdlX3BhdGg7XHJcblxyXG4gICAgICAvLyBEZWxldGUgZnJvbSBTdG9yYWdlICpvbmx5IGlmIHBhdGggZXhpc3RzKiB1c2luZyB0aGUgc2VydmljZSBmdW5jdGlvblxyXG4gICAgICBpZiAoYWN0dWFsU3RvcmFnZVBhdGgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBzZXJ2aWNlIHRvIGRlbGV0ZSBmaWxlIGZyb20gc3RvcmFnZTogJHthY3R1YWxTdG9yYWdlUGF0aH1gKTtcclxuICAgICAgICBjb25zdCB7IHN1Y2Nlc3M6IGRlbGV0ZVN1Y2Nlc3MsIGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgZGVsZXRlRmlsZVNlcnZpY2UoYWN0dWFsU3RvcmFnZVBhdGgpOyAvLyBVc2Ugc3RvcmFnZSBzZXJ2aWNlXHJcbiAgICAgICAgaWYgKCFkZWxldGVTdWNjZXNzKSB7IGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGRlbGV0aW5nIGZpbGUgJHthY3R1YWxTdG9yYWdlUGF0aH0gZnJvbSBzdG9yYWdlIChjb250aW51aW5nKTpgLCBkZWxldGVFcnJvcik7IH1cclxuICAgICAgICBlbHNlIHsgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBkZWxldGVkIGZpbGUgJHthY3R1YWxTdG9yYWdlUGF0aH0gdmlhIHNlcnZpY2UuYCk7IH1cclxuICAgICAgfSBlbHNlIHsgY29uc29sZS5sb2coYFtBY3Rpb25dIE5vIHN0b3JhZ2UgcGF0aCBmb3IgbWVkaWEgJHttZWRpYUlkfSwgc2tpcHBpbmcgc3RvcmFnZSBkZWxldGlvbi5gKTsgfVxyXG5cclxuICAgICAgLy8gRGVsZXRlIGZyb20gRGF0YWJhc2UgdXNpbmcgYWRtaW4gY2xpZW50XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBEZWxldGluZyByZWNvcmQgZnJvbSBkYXRhYmFzZTogJHttZWRpYUlkfWApO1xyXG4gICAgICBjb25zdCB7IGVycm9yOiBkYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmZyb20oJ2dlbmVyYXRlZF9tZWRpYScpLmRlbGV0ZSgpLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG4gICAgICBpZiAoZGJFcnJvcikgeyBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBFcnJvciBkZWxldGluZyByZWNvcmQgJHttZWRpYUlkfSBmcm9tIGRhdGFiYXNlOmAsIGRiRXJyb3IpOyB0aHJvdyBuZXcgRXJyb3IoYERhdGFiYXNlIGRlbGV0aW9uIGZhaWxlZDogJHtkYkVycm9yLm1lc3NhZ2V9YCk7IH1cclxuICAgICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBkZWxldGVkIHJlY29yZCAke21lZGlhSWR9IGZyb20gZGF0YWJhc2UuYCk7XHJcblxyXG4gICAgICByZXZhbGlkYXRlUGF0aCgnL2Rhc2hib2FyZCcpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIFVuZXhwZWN0ZWQgZXJyb3IgZHVyaW5nIG1lZGlhIGRlbGV0aW9uIGZvciAke21lZGlhSWR9OmAsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaGVzIGNvbXBsZXRlZCBhbmQgcHJvY2Vzc2luZyBtZWRpYSBpdGVtcyBmb3IgdGhlIGN1cnJlbnQgdXNlci5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaFVzZXJNZWRpYSgpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIG1lZGlhOiBHZW5lcmF0ZWRNZWRpYVtdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTsgLy8gVXNlcyBzZXJ2ZXIgY2xpZW50XHJcbiAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcbiAgaWYgKCF1c2VyIHx8IHVzZXJFcnJvcikgeyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvcicsIG1lZGlhOiBbXSB9OyB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBVc2UgdXNlci1jb250ZXh0IGNsaWVudCBmb3IgUkxTXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnZ2VuZXJhdGVkX21lZGlhJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpXHJcbiAgICAgIC5pbignc3RhdHVzJywgWydwZW5kaW5nJywgJ3Byb2Nlc3NpbmcnLCAnY29tcGxldGVkJywgJ2ZhaWxlZCddKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDUwKTsgLy8gQWRqdXN0IGxpbWl0IGFzIG5lZWRlZFxyXG5cclxuICAgIGlmIChlcnJvcikgeyB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBtZWRpYTogJHtlcnJvci5tZXNzYWdlfWApOyB9XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZWRpYTogZGF0YSB8fCBbXSwgZXJyb3I6IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIGZldGNoaW5nIHVzZXIgbWVkaWE6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlLCBtZWRpYTogW10gfTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXJ2ZXIgQWN0aW9uIHRvIGxpc3QgdXNlcidzIGdlbmVyYXRlZCBpbWFnZXMgYW5kIGlucHV0IGltYWdlcyBmb3Igc2VsZWN0aW9uLlxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3RVc2VySW1hZ2VzRm9yU2VsZWN0aW9uKCk6IFByb21pc2U8e1xyXG4gICAgc3VjY2VzczogYm9vbGVhbjtcclxuICAgIGltYWdlczogeyB2YWx1ZTogc3RyaW5nOyBsYWJlbDogc3RyaW5nOyB0eXBlOiAnZ2VuZXJhdGVkJyB8ICdpbnB1dCcgfVtdO1xyXG4gICAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7IC8vIFVzZSBzZXJ2ZXIgY2xpZW50IHRvIGdldCB1c2VyXHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuICAgIGlmICghdXNlciB8fCB1c2VyRXJyb3IpIHsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGltYWdlczogW10sIGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH07IH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IFtnZW5lcmF0ZWRSZXN1bHQsIGlucHV0UmVzdWx0XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICAgICAgLy8gRmV0Y2ggY29tcGxldGVkIGdlbmVyYXRlZCBpbWFnZXMgdXNpbmcgUkxTLWVuYWJsZWQgY2xpZW50XHJcbiAgICAgICAgICAgIHN1cGFiYXNlXHJcbiAgICAgICAgICAgICAgICAuZnJvbSgnZ2VuZXJhdGVkX21lZGlhJylcclxuICAgICAgICAgICAgICAgIC5zZWxlY3QoJ2lkLCBwcm9tcHQsIG1lZGlhX3VybCcpXHJcbiAgICAgICAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxyXG4gICAgICAgICAgICAgICAgLmVxKCdtZWRpYV90eXBlJywgJ2ltYWdlJylcclxuICAgICAgICAgICAgICAgIC5lcSgnc3RhdHVzJywgJ2NvbXBsZXRlZCcpXHJcbiAgICAgICAgICAgICAgICAubm90KCdtZWRpYV91cmwnLCAnaXMnLCBudWxsKVxyXG4gICAgICAgICAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgICAgICAgICAgICAubGltaXQoNTApLCAvLyBMaW1pdCBnZW5lcmF0ZWQgaW1hZ2VzIHNob3duXHJcbiAgICAgICAgICAgIC8vIEZldGNoIGlucHV0IGltYWdlcyB1c2luZyB0aGUgc2VydmljZSBmdW5jdGlvbiAodXNlcyBhZG1pbiBjbGllbnQpXHJcbiAgICAgICAgICAgIGxpc3RVc2VyRmlsZXNTZXJ2aWNlKHVzZXIuaWQsICdpbnB1dHMnKVxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICBjb25zdCBmZXRjaGVkSW1hZ2VzOiB7IHZhbHVlOiBzdHJpbmc7IGxhYmVsOiBzdHJpbmc7IHR5cGU6ICdnZW5lcmF0ZWQnIHwgJ2lucHV0JyB9W10gPSBbXTtcclxuXHJcbiAgICAgICAgLy8gUHJvY2VzcyBnZW5lcmF0ZWQgaW1hZ2VzXHJcbiAgICAgICAgaWYgKGdlbmVyYXRlZFJlc3VsdC5lcnJvcikgeyBjb25zb2xlLmVycm9yKFwiW0FjdGlvbl0gRXJyb3IgZmV0Y2hpbmcgZ2VuZXJhdGVkIGltYWdlczpcIiwgZ2VuZXJhdGVkUmVzdWx0LmVycm9yKTsgfVxyXG4gICAgICAgIGVsc2UgaWYgKGdlbmVyYXRlZFJlc3VsdC5kYXRhKSB7IGdlbmVyYXRlZFJlc3VsdC5kYXRhLmZvckVhY2goaXRlbSA9PiB7IGZldGNoZWRJbWFnZXMucHVzaCh7IHZhbHVlOiBpdGVtLm1lZGlhX3VybCEsIGxhYmVsOiBpdGVtLnByb21wdCA/IGBHZW46ICR7aXRlbS5wcm9tcHQuc3Vic3RyaW5nKDAsIDMwKX0uLi5gIDogYEdlbmVyYXRlZCBJbWFnZSAke2l0ZW0uaWQuc3Vic3RyaW5nKDAsIDYpfWAsIHR5cGU6ICdnZW5lcmF0ZWQnLCB9KTsgfSk7IH1cclxuXHJcbiAgICAgICAgLy8gUHJvY2VzcyBpbnB1dCBpbWFnZXNcclxuICAgICAgICBpZiAoIWlucHV0UmVzdWx0LnN1Y2Nlc3MpIHsgY29uc29sZS5lcnJvcihcIltBY3Rpb25dIEVycm9yIGZldGNoaW5nIGlucHV0IGltYWdlczpcIiwgaW5wdXRSZXN1bHQuZXJyb3IpOyB9XHJcbiAgICAgICAgZWxzZSBpZiAoaW5wdXRSZXN1bHQuZmlsZXMpIHsgaW5wdXRSZXN1bHQuZmlsZXMuZm9yRWFjaChmaWxlID0+IHsgaWYgKGZpbGUucHVibGljVXJsICYmIC9cXC4oanBnfGpwZWd8cG5nfHdlYnB8Z2lmKSQvaS50ZXN0KGZpbGUubmFtZSkpIHsgZmV0Y2hlZEltYWdlcy5wdXNoKHsgdmFsdWU6IGZpbGUucHVibGljVXJsLCBsYWJlbDogYElucHV0OiAke2ZpbGUubmFtZX1gLCB0eXBlOiAnaW5wdXQnLCB9KTsgfSB9KTsgfVxyXG5cclxuICAgICAgICBmZXRjaGVkSW1hZ2VzLnNvcnQoKGEsIGIpID0+IGEubGFiZWwubG9jYWxlQ29tcGFyZShiLmxhYmVsKSk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgaW1hZ2VzOiBmZXRjaGVkSW1hZ2VzIH07XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIGxpc3RpbmcgdXNlciBpbWFnZXM6JywgZXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBpbWFnZXM6IFtdLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG59XHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOFNBdVlzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/apps/web/src/lib/actions/data:ed8ab4 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"409c361ac563efc88c53fbb2c97f3f3274ecc87a5c":"cancelGeneration"},"apps/web/src/lib/actions/media.actions.ts",""] */ __turbopack_context__.s({
    "cancelGeneration": (()=>cancelGeneration)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var cancelGeneration = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("409c361ac563efc88c53fbb2c97f3f3274ecc87a5c", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "cancelGeneration"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vbWVkaWEuYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL2FjdGlvbnMvbWVkaWEuYWN0aW9ucy50c1xyXG4ndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAcmVwby9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyB1c2VDcmVkaXRzIH0gZnJvbSAnQC9saWIvY3JlZGl0cyc7XHJcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSAnbmV4dC9jYWNoZSc7XHJcbmltcG9ydCB7IE1lZGlhVHlwZSwgQ1JFRElUX0NPU1RTLCBHZW5lcmF0aW9uUmVzdWx0LCBHZW5lcmF0aW9uTW9kZSB9IGZyb20gJ0AvbGliL2NvbnN0YW50cy9tZWRpYSc7XHJcbi8vIEltcG9ydCB0aGUgc3BlY2lmaWMgSW5zZXJ0IHR5cGUgYW5kIEdlbmVyYXRlZE1lZGlhIHR5cGVcclxuaW1wb3J0IHsgRGF0YWJhc2UsIEdlbmVyYXRlZE1lZGlhIH0gZnJvbSAnQC90eXBlcy9kYl90eXBlcyc7XHJcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAcmVwby9zdXBhYmFzZS9hZG1pbic7XHJcbi8vIEltcG9ydCBvbmx5IHRoZSBuZWNlc3Nhcnkgc3RvcmFnZSBzZXJ2aWNlIGZ1bmN0aW9ucyAodXNlZCBieSBhY3Rpb25zIGJlbG93KVxyXG5pbXBvcnQgeyBsaXN0VXNlckZpbGVzIGFzIGxpc3RVc2VyRmlsZXNTZXJ2aWNlLCBkZWxldGVGaWxlIGFzIGRlbGV0ZUZpbGVTZXJ2aWNlIH0gZnJvbSAnQC9saWIvc3RvcmFnZS9zdXBhYmFzZS1zdG9yYWdlJztcclxuLy8gSW1wb3J0IFBpeGlvIEFQSSBjbGllbnQgYW5kIG1vZGVsc1xyXG5pbXBvcnQge1xyXG4gIFBJWElPX01PREVMUyxcclxuICBxdWV1ZVBpeGlvUnVuLFxyXG4gIGNhbmNlbFBpeGlvUnVuLFxyXG4gIGNyZWF0ZVJ1blJlcXVlc3QsXHJcbiAgdHlwZSBLcmVhRmx1eElucHV0cyxcclxuICB0eXBlIFdhbkZpcnN0TGFzdEZyYW1lSW5wdXRzXHJcbn0gZnJvbSAnQHJlcG8vcGl4aW8tYXBpJztcclxuXHJcbi8vIERlZmluZSB0aGUgc3BlY2lmaWMgdHlwZSBmb3IgaW5zZXJ0aW9uLCBkZXJpdmVkIGZyb20gZGJfdHlwZXMudHNcclxudHlwZSBHZW5lcmF0ZWRNZWRpYUluc2VydCA9IERhdGFiYXNlWydwdWJsaWMnXVsnVGFibGVzJ11bJ2dlbmVyYXRlZF9tZWRpYSddWydJbnNlcnQnXTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWF0ZXMgbWVkaWEgZ2VuZXJhdGlvbiBieSBjcmVhdGluZyBhIHJlY29yZCBhbmQgaW52b2tpbmcgdGhlIFN1cGFiYXNlIEZ1bmN0aW9uLlxyXG4gKiBFeHBlY3RzIGltYWdlIFVSTHMgZm9yIG1vZGVzIHRoYXQgcmVxdWlyZSBpbnB1dCBpbWFnZXMgKGNsaWVudCBoYW5kbGVzIHVwbG9hZCkuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZWRpYShmb3JtRGF0YTogRm9ybURhdGEpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIG1lZGlhSWQ/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG4gIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiB1c2VyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xyXG5cclxuICBpZiAoIXVzZXIgfHwgdXNlckVycm9yKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvcicgfTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBSZWFkIGRhdGEgZnJvbSBGb3JtRGF0YSAtLS1cclxuICBjb25zdCBnZW5lcmF0aW9uTW9kZSA9IGZvcm1EYXRhLmdldCgnZ2VuZXJhdGlvbk1vZGUnKSBhcyBHZW5lcmF0aW9uTW9kZTtcclxuICBcclxuICAvLyBEZXRlcm1pbmUgbWVkaWEgdHlwZSBiYXNlZCBvbiBtb2RlbCBjYXRlZ29yeSwgbm90IGdlbmVyYXRpb24gbW9kZSBuYW1lXHJcbiAgY29uc3QgbWVkaWFUeXBlOiBNZWRpYVR5cGUgPSBnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nID8gJ3ZpZGVvJyA6ICdpbWFnZSc7XHJcbiAgLy8gS3JlYSBGbHV4IChpbWFnZSBtb2RlKSDihpIgaW1hZ2VcclxuICAvLyBRd2VuIEVkaXQgKHZpZGVvIG1vZGUpIOKGkiBpbWFnZSAoaXQncyBlZGl0aW5nLCBub3QgZ2VuZXJhdGluZyB2aWRlbylcclxuICAvLyBXYW4gMi4yIChmaXJzdExhc3RGcmFtZVZpZGVvIG1vZGUpIOKGkiB2aWRlb1xyXG5cclxuICAvLyAtLS0gVmFsaWRhdGlvbiAtLS1cclxuICBpZiAoIWdlbmVyYXRpb25Nb2RlKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycgfTtcclxuICB9XHJcblxyXG4gIC8vIE1vZGUtc3BlY2lmaWMgaW5wdXQgZXh0cmFjdGlvbiBhbmQgdmFsaWRhdGlvblxyXG4gIGxldCBwcm9tcHQgPSAnJztcclxuICBsZXQgc3RhcnRJbWFnZVVybDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgbGV0IGVuZEltYWdlVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UxVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UyVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgaW1hZ2UzVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBsZXQgcG9zaXRpdmVQcm9tcHQgPSAnJztcclxuICBsZXQgbmVnYXRpdmVQcm9tcHQgPSAnJztcclxuICBsZXQgd2lkdGggPSAxMDI0O1xyXG4gIGxldCBoZWlnaHQgPSAxMDI0O1xyXG4gIGxldCB2aWRlb1dpZHRoID0gNTEyO1xyXG4gIGxldCB2aWRlb0hlaWdodCA9IDUxMjtcclxuICBsZXQgdmlkZW9MZW5ndGggPSA4MTtcclxuXHJcbiAgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnaW1hZ2UnKSB7XHJcbiAgICAvLyBLcmVhIEZsdXhcclxuICAgIHByb21wdCA9IGZvcm1EYXRhLmdldCgncHJvbXB0JykgYXMgc3RyaW5nO1xyXG4gICAgd2lkdGggPSBwYXJzZUludChmb3JtRGF0YS5nZXQoJ3dpZHRoJykgYXMgc3RyaW5nKSB8fCAxMDI0O1xyXG4gICAgaGVpZ2h0ID0gcGFyc2VJbnQoZm9ybURhdGEuZ2V0KCdoZWlnaHQnKSBhcyBzdHJpbmcpIHx8IDEwMjQ7XHJcbiAgICBpZiAoIXByb21wdD8udHJpbSgpKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHByb21wdCcgfTtcclxuICB9IGVsc2UgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAndmlkZW8nKSB7XHJcbiAgICAvLyBRd2VuIEVkaXRcclxuICAgIGltYWdlMVVybCA9IGZvcm1EYXRhLmdldCgnaW1hZ2UxVXJsJykgYXMgc3RyaW5nO1xyXG4gICAgaW1hZ2UyVXJsID0gZm9ybURhdGEuZ2V0KCdpbWFnZTJVcmwnKSBhcyBzdHJpbmcgfHwgbnVsbDtcclxuICAgIGltYWdlM1VybCA9IGZvcm1EYXRhLmdldCgnaW1hZ2UzVXJsJykgYXMgc3RyaW5nIHx8IG51bGw7XHJcbiAgICBwb3NpdGl2ZVByb21wdCA9IGZvcm1EYXRhLmdldCgncG9zaXRpdmVQcm9tcHQnKSBhcyBzdHJpbmcgfHwgJyc7XHJcbiAgICBuZWdhdGl2ZVByb21wdCA9IGZvcm1EYXRhLmdldCgnbmVnYXRpdmVQcm9tcHQnKSBhcyBzdHJpbmcgfHwgJyc7XHJcbiAgICBpZiAoIWltYWdlMVVybCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWlzc2luZyBpbWFnZSBmb3IgZWRpdGluZycgfTtcclxuICB9IGVsc2UgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnZmlyc3RMYXN0RnJhbWVWaWRlbycpIHtcclxuICAgIC8vIFdhbiAyLjJcclxuICAgIHByb21wdCA9IGZvcm1EYXRhLmdldCgncHJvbXB0JykgYXMgc3RyaW5nO1xyXG4gICAgc3RhcnRJbWFnZVVybCA9IGZvcm1EYXRhLmdldCgnc3RhcnRJbWFnZVVybCcpIGFzIHN0cmluZztcclxuICAgIGVuZEltYWdlVXJsID0gZm9ybURhdGEuZ2V0KCdlbmRJbWFnZVVybCcpIGFzIHN0cmluZztcclxuICAgIHZpZGVvV2lkdGggPSBwYXJzZUludChmb3JtRGF0YS5nZXQoJ3dpZHRoJykgYXMgc3RyaW5nKSB8fCA1MTI7XHJcbiAgICB2aWRlb0hlaWdodCA9IHBhcnNlSW50KGZvcm1EYXRhLmdldCgnaGVpZ2h0JykgYXMgc3RyaW5nKSB8fCA1MTI7XHJcbiAgICB2aWRlb0xlbmd0aCA9IHBhcnNlSW50KGZvcm1EYXRhLmdldCgnbGVuZ3RoJykgYXMgc3RyaW5nKSB8fCA4MTtcclxuICAgIGlmICghcHJvbXB0Py50cmltKCkpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgcHJvbXB0JyB9O1xyXG4gICAgaWYgKCFzdGFydEltYWdlVXJsKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHN0YXJ0IGltYWdlIFVSTCcgfTtcclxuICAgIGlmICghZW5kSW1hZ2VVcmwpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgZW5kIGltYWdlIFVSTCcgfTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNyZWRpdENvc3QgPSBDUkVESVRfQ09TVFNbZ2VuZXJhdGlvbk1vZGVdO1xyXG4gIGlmIChjcmVkaXRDb3N0ID09PSB1bmRlZmluZWQpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZ2VuZXJhdGlvbiBtb2RlJyB9O1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIDEuIENoZWNrIGFuZCBkZWR1Y3QgY3JlZGl0c1xyXG4gICAgY29uc3QgY3JlZGl0U3VjY2VzcyA9IGF3YWl0IHVzZUNyZWRpdHMoXHJcbiAgICAgIHVzZXIuaWQsXHJcbiAgICAgIGNyZWRpdENvc3QsXHJcbiAgICAgIGBHZW5lcmF0ZSAke2dlbmVyYXRpb25Nb2RlfTogXCIke3Byb21wdC5zbGljZSgwLCAzMCl9JHtwcm9tcHQubGVuZ3RoID4gMzAgPyAnLi4uJyA6ICcnfVwiYFxyXG4gICAgKTtcclxuICAgIGlmICghY3JlZGl0U3VjY2VzcykgeyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOb3QgZW5vdWdoIGNyZWRpdHMnIH07IH1cclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDcmVkaXRzIGRlZHVjdGVkIHN1Y2Nlc3NmdWxseSBmb3IgdXNlciAke3VzZXIuaWR9YCk7XHJcblxyXG4gICAgLy8gMi4gQ3JlYXRlIGluaXRpYWwgJ3BlbmRpbmcnIHJlY29yZCBpbiBEQlxyXG4gICAgY29uc3QgaW5zZXJ0UGF5bG9hZDogR2VuZXJhdGVkTWVkaWFJbnNlcnQgPSB7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcclxuICAgICAgICBwcm9tcHQ6IHByb21wdCB8fCBwb3NpdGl2ZVByb21wdCB8fCAnSW1hZ2UgZWRpdCcsIC8vIFVzZSBhcHByb3ByaWF0ZSBwcm9tcHRcclxuICAgICAgICBtZWRpYV90eXBlOiBtZWRpYVR5cGUsXHJcbiAgICAgICAgY3JlZGl0c191c2VkOiBjcmVkaXRDb3N0LFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIG1lZGlhX3VybDogJycsIC8vIFJlcXVpcmVkIGJ5IEluc2VydCB0eXBlXHJcbiAgICAgICAgc3RvcmFnZV9wYXRoOiAnJywgLy8gUmVxdWlyZWQgYnkgSW5zZXJ0IHR5cGVcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgZ2VuZXJhdGlvbk1vZGUsXHJcbiAgICAgICAgICAuLi4oZ2VuZXJhdGlvbk1vZGUgPT09ICdpbWFnZScgJiYgeyB3aWR0aCwgaGVpZ2h0IH0pLFxyXG4gICAgICAgICAgLi4uKHBvc2l0aXZlUHJvbXB0ICYmIHsgcG9zaXRpdmVQcm9tcHQsIG5lZ2F0aXZlUHJvbXB0IH0pXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nKSB7XHJcbiAgICAgICAgaW5zZXJ0UGF5bG9hZC5zdGFydF9pbWFnZV91cmwgPSBzdGFydEltYWdlVXJsO1xyXG4gICAgICAgIGluc2VydFBheWxvYWQuZW5kX2ltYWdlX3VybCA9IGVuZEltYWdlVXJsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdNZWRpYVJlY29yZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKS5pbnNlcnQoaW5zZXJ0UGF5bG9hZCkuc2VsZWN0KCdpZCcpLnNpbmdsZSgpO1xyXG4gICAgaWYgKGluc2VydEVycm9yIHx8ICFuZXdNZWRpYVJlY29yZCkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiW0FjdGlvbl0gRmFpbGVkIHRvIGluc2VydCBpbml0aWFsIG1lZGlhIHJlY29yZDpcIiwgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBUT0RPOiBDb25zaWRlciByZWZ1bmRpbmcgY3JlZGl0cyBoZXJlIGlmIGluc2VydCBmYWlscyBhZnRlciBkZWR1Y3Rpb25cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBgRmFpbGVkIHRvIGNyZWF0ZSBnZW5lcmF0aW9uIHJlY29yZDogJHtpbnNlcnRFcnJvcj8ubWVzc2FnZX1gIH07XHJcbiAgICB9XHJcbiAgICBjb25zdCBtZWRpYUlkID0gbmV3TWVkaWFSZWNvcmQuaWQ7XHJcbiAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gSW5pdGlhbCBtZWRpYSByZWNvcmQgY3JlYXRlZCB3aXRoIElEOiAke21lZGlhSWR9YCk7XHJcblxyXG4gICAgLy8gMy4gUHJlcGFyZSB3ZWJob29rIFVSTCBmb3IgUGl4aW8gQVBJIGNhbGxiYWNrc1xyXG4gICAgY29uc3Qgd2ViaG9va1VybCA9IGAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NJVEVfVVJMfS9hcGkvd2ViaG9va3MvcGl4aW9gO1xyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFVzaW5nIHdlYmhvb2sgVVJMOiAke3dlYmhvb2tVcmx9YCk7XHJcblxyXG4gICAgLy8gNC4gR2V0IEFQSSBrZXlcclxuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlBJWElPX0RFUExPWV9BUElfS0VZO1xyXG4gICAgaWYgKCFhcGlLZXkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignW0FjdGlvbl0gUElYSU9fREVQTE9ZX0FQSV9LRVkgbm90IGNvbmZpZ3VyZWQnKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQVBJIGtleSBub3QgY29uZmlndXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA1LiBTZWxlY3QgbW9kZWwgYW5kIGNhbGwgUGl4aW8gQVBJIGJhc2VkIG9uIGdlbmVyYXRpb24gbW9kZVxyXG4gICAgbGV0IHBpeGlvUmVzdWx0O1xyXG4gICAgbGV0IHNlbGVjdGVkTW9kZWw7XHJcblxyXG4gICAgaWYgKGdlbmVyYXRpb25Nb2RlID09PSAnaW1hZ2UnKSB7XHJcbiAgICAgIC8vIFVzZSBLcmVhIEZsdXggbW9kZWxcclxuICAgICAgc2VsZWN0ZWRNb2RlbCA9IFBJWElPX01PREVMUy5rcmVhRmx1eDtcclxuICAgICAgY29uc3QgaW5wdXRzOiBLcmVhRmx1eElucHV0cyA9IHtcclxuICAgICAgICB0ZXh0OiBwcm9tcHQsXHJcbiAgICAgICAgd2lkdGgsXHJcbiAgICAgICAgaGVpZ2h0XHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSdW5SZXF1ZXN0KHNlbGVjdGVkTW9kZWwsIGlucHV0cywge1xyXG4gICAgICAgIHdlYmhvb2s6IHdlYmhvb2tVcmwsXHJcbiAgICAgICAgd2ViaG9va0ludGVybWVkaWF0ZVN0YXR1czogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBQaXhpbyBBUEkgZm9yIG1lZGlhSWQ6ICR7bWVkaWFJZH0sIG1vZGVsOiAke3NlbGVjdGVkTW9kZWwubmFtZX1gKTtcclxuICAgICAgcGl4aW9SZXN1bHQgPSBhd2FpdCBxdWV1ZVBpeGlvUnVuKHJlcXVlc3QsIGFwaUtleSk7XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ3ZpZGVvJykge1xyXG4gICAgICAvLyBVc2UgUXdlbiBFZGl0IG1vZGVsXHJcbiAgICAgIHNlbGVjdGVkTW9kZWwgPSBQSVhJT19NT0RFTFMucXdlbkVkaXQ7XHJcbiAgICAgIGNvbnN0IGlucHV0czogaW1wb3J0KCdAcmVwby9waXhpby1hcGknKS5Rd2VuRWRpdElucHV0cyA9IHtcclxuICAgICAgICBpbWFnZTE6IGltYWdlMVVybCEsXHJcbiAgICAgICAgcG9zaXRpdmU6IHBvc2l0aXZlUHJvbXB0LFxyXG4gICAgICAgIG5lZ2F0aXZlOiBuZWdhdGl2ZVByb21wdCxcclxuICAgICAgICAuLi4oaW1hZ2UyVXJsICYmIHsgaW1hZ2UyOiBpbWFnZTJVcmwgfSksXHJcbiAgICAgICAgLi4uKGltYWdlM1VybCAmJiB7IGltYWdlMzogaW1hZ2UzVXJsIH0pXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSdW5SZXF1ZXN0KHNlbGVjdGVkTW9kZWwsIGlucHV0cywge1xyXG4gICAgICAgIHdlYmhvb2s6IHdlYmhvb2tVcmwsXHJcbiAgICAgICAgd2ViaG9va0ludGVybWVkaWF0ZVN0YXR1czogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBQaXhpbyBBUEkgZm9yIG1lZGlhSWQ6ICR7bWVkaWFJZH0sIG1vZGVsOiAke3NlbGVjdGVkTW9kZWwubmFtZX1gKTtcclxuICAgICAgcGl4aW9SZXN1bHQgPSBhd2FpdCBxdWV1ZVBpeGlvUnVuKHJlcXVlc3QsIGFwaUtleSk7XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChnZW5lcmF0aW9uTW9kZSA9PT0gJ2ZpcnN0TGFzdEZyYW1lVmlkZW8nKSB7XHJcbiAgICAgIC8vIFVzZSBXYW4gRmlyc3QvTGFzdCBGcmFtZSBtb2RlbFxyXG4gICAgICBzZWxlY3RlZE1vZGVsID0gUElYSU9fTU9ERUxTLndhbkZpcnN0TGFzdEZyYW1lO1xyXG4gICAgICBjb25zdCBpbnB1dHM6IFdhbkZpcnN0TGFzdEZyYW1lSW5wdXRzID0ge1xyXG4gICAgICAgIHN0YXJ0X2ltYWdlOiBzdGFydEltYWdlVXJsISxcclxuICAgICAgICBlbmRfaW1hZ2U6IGVuZEltYWdlVXJsISxcclxuICAgICAgICBwb3NpdGl2ZTogcHJvbXB0LCAvLyBXYW4gdXNlcyAncG9zaXRpdmUnIG5vdCAncHJvbXB0J1xyXG4gICAgICAgIG5lZ2F0aXZlOiAnJyxcclxuICAgICAgICB3aWR0aDogdmlkZW9XaWR0aCxcclxuICAgICAgICBoZWlnaHQ6IHZpZGVvSGVpZ2h0LFxyXG4gICAgICAgIGxlbmd0aDogdmlkZW9MZW5ndGhcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJ1blJlcXVlc3Qoc2VsZWN0ZWRNb2RlbCwgaW5wdXRzLCB7XHJcbiAgICAgICAgd2ViaG9vazogd2ViaG9va1VybCxcclxuICAgICAgICB3ZWJob29rSW50ZXJtZWRpYXRlU3RhdHVzOiBmYWxzZVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDYWxsaW5nIFBpeGlvIEFQSSBmb3IgbWVkaWFJZDogJHttZWRpYUlkfSwgbW9kZWw6ICR7c2VsZWN0ZWRNb2RlbC5uYW1lfWApO1xyXG4gICAgICBwaXhpb1Jlc3VsdCA9IGF3YWl0IHF1ZXVlUGl4aW9SdW4ocmVxdWVzdCwgYXBpS2V5KTtcclxuICAgICAgXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBVbnN1cHBvcnRlZCBnZW5lcmF0aW9uIG1vZGU6ICR7Z2VuZXJhdGlvbk1vZGV9YCk7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1Vuc3VwcG9ydGVkIGdlbmVyYXRpb24gbW9kZScgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA2LiBDaGVjayBQaXhpbyBBUEkgcmVzdWx0XHJcblxyXG4gICAgaWYgKCFwaXhpb1Jlc3VsdC5zdWNjZXNzIHx8ICFwaXhpb1Jlc3VsdC5kYXRhKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIFBpeGlvIEFQSSBlcnJvcjpgLCBwaXhpb1Jlc3VsdC5lcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgcmVjb3JkIHRvIGZhaWxlZFxyXG4gICAgICBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ2dlbmVyYXRlZF9tZWRpYScpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgZXJyb3I6IHBpeGlvUmVzdWx0LmVycm9yIHx8ICdBUEkgcmVxdWVzdCBmYWlsZWQnLFxyXG4gICAgICAgICAgICBmYWlsZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBwaXhpb1Jlc3VsdC5lcnJvciB8fCAnQVBJIHJlcXVlc3QgZmFpbGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJ1bklkID0gcGl4aW9SZXN1bHQuZGF0YS5ydW5faWQ7XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFBpeGlvIEFQSSBydW4gc3RhcnRlZCB3aXRoIElEOiAke3J1bklkfSB1c2luZyBtb2RlbDogJHtzZWxlY3RlZE1vZGVsLm5hbWV9YCk7XHJcblxyXG4gICAgLy8gNy4gVXBkYXRlIHJlY29yZCB3aXRoIHJ1bl9pZCwgbW9kZWwgaW5mbywgYW5kIHByb2Nlc3Npbmcgc3RhdHVzXHJcbiAgICBjb25zdCB7IGVycm9yOiBydW5JZFVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBzdGF0dXM6ICdwcm9jZXNzaW5nJyxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgcnVuX2lkOiBydW5JZCxcclxuICAgICAgICAgIGdlbmVyYXRpb25Nb2RlLFxyXG4gICAgICAgICAgbW9kZWxfaWQ6IHNlbGVjdGVkTW9kZWwuaWQsXHJcbiAgICAgICAgICBtb2RlbF9uYW1lOiBzZWxlY3RlZE1vZGVsLm5hbWUsXHJcbiAgICAgICAgICBzdGFydGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKTtcclxuXHJcbiAgICBpZiAocnVuSWRVcGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBFcnJvciB1cGRhdGluZyByZWNvcmQgd2l0aCBydW5faWQ6YCwgcnVuSWRVcGRhdGVFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gOC4gUmV2YWxpZGF0ZSBwYXRoIHRvIHNob3cgcHJvY2Vzc2luZyBzdGF0ZVxyXG4gICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuXHJcbiAgICAvLyA5LiBSZXR1cm4gc3VjY2VzcyAod2ViaG9vayB3aWxsIGhhbmRsZSBjb21wbGV0aW9uKVxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBpbml0aWF0ZWQgZ2VuZXJhdGlvbiBmb3IgJHttZWRpYUlkfWApO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVkaWFJZDogbWVkaWFJZCB9O1xyXG5cclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbQWN0aW9uXSBFcnJvciBpbiBnZW5lcmF0ZU1lZGlhIGFjdGlvbjonLCBlcnJvcik7XHJcbiAgICAvLyBJZiB0aGUgZXJyb3IgaGFwcGVuZWQgYmVmb3JlIGludm9jYXRpb24gKGUuZy4sIGNyZWRpdCBkZWR1Y3Rpb24pLCByZXR1cm4gZXJyb3JcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENhbmNlbHMgYSBydW5uaW5nIG1lZGlhIGdlbmVyYXRpb25cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYW5jZWxHZW5lcmF0aW9uKG1lZGlhSWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICBpZiAoIW1lZGlhSWQpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01lZGlhIElEIGlzIHJlcXVpcmVkJyB9O1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuXHJcbiAgaWYgKCF1c2VyIHx8IHVzZXJFcnJvcikge1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH07XHJcbiAgfVxyXG5cclxuICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FuY2VsbGluZyBnZW5lcmF0aW9uIGZvciBtZWRpYUlkOiAke21lZGlhSWR9YCk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBGZXRjaCB0aGUgbWVkaWEgcmVjb3JkIHRvIHZlcmlmeSBvd25lcnNoaXAgYW5kIGdldCBydW5faWRcclxuICAgIGNvbnN0IHsgZGF0YTogbWVkaWFSZWNvcmQsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdXNlcl9pZCwgc3RhdHVzLCBtZXRhZGF0YScpXHJcbiAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIW1lZGlhUmVjb3JkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGZldGNoaW5nIG1lZGlhICR7bWVkaWFJZH06YCwgZmV0Y2hFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01lZGlhIHJlY29yZCBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgaWYgKG1lZGlhUmVjb3JkLnVzZXJfaWQgIT09IHVzZXIuaWQpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBbQWN0aW9uXSBVc2VyICR7dXNlci5pZH0gYXR0ZW1wdGVkIHRvIGNhbmNlbCBtZWRpYSAke21lZGlhSWR9IG93bmVkIGJ5ICR7bWVkaWFSZWNvcmQudXNlcl9pZH1gKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnUGVybWlzc2lvbiBkZW5pZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgY2FuY2VsbGFibGVcclxuICAgIGlmICghWydwZW5kaW5nJywgJ3Byb2Nlc3NpbmcnXS5pbmNsdWRlcyhtZWRpYVJlY29yZC5zdGF0dXMpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogYENhbm5vdCBjYW5jZWwgJHttZWRpYVJlY29yZC5zdGF0dXN9IGdlbmVyYXRpb25gIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IHJ1bl9pZCBmcm9tIG1ldGFkYXRhXHJcbiAgICBjb25zdCBydW5JZCA9IChtZWRpYVJlY29yZC5tZXRhZGF0YSBhcyBhbnkpPy5ydW5faWQ7XHJcbiAgICBcclxuICAgIGlmICghcnVuSWQpIHtcclxuICAgICAgLy8gTm8gcnVuX2lkIHlldCwganVzdCB1cGRhdGUgc3RhdHVzIHRvIGZhaWxlZFxyXG4gICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gTm8gcnVuX2lkIGZvciAke21lZGlhSWR9LCBtYXJraW5nIGFzIGNhbmNlbGxlZCBsb2NhbGx5YCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgc3RhdHVzOiAnZmFpbGVkJyxcclxuICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgIC4uLihtZWRpYVJlY29yZC5tZXRhZGF0YSBhcyBvYmplY3QgfHwge30pLFxyXG4gICAgICAgICAgICBlcnJvcjogJ0NhbmNlbGxlZCBieSB1c2VyJyxcclxuICAgICAgICAgICAgY2FuY2VsbGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnaWQnLCBtZWRpYUlkKTtcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIHVwZGF0aW5nIGNhbmNlbGxlZCBzdGF0dXM6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byBjYW5jZWwgZ2VuZXJhdGlvbicgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGwgUGl4aW8gQVBJIHRvIGNhbmNlbCB0aGUgcnVuIHVzaW5nIHRoZSBjbGllbnRcclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBDYWxsaW5nIFBpeGlvIEFQSSB0byBjYW5jZWwgcnVuOiAke3J1bklkfWApO1xyXG4gICAgXHJcbiAgICBjb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5QSVhJT19ERVBMT1lfQVBJX0tFWTtcclxuICAgIGlmICghYXBpS2V5KSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0FQSSBrZXkgbm90IGNvbmZpZ3VyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2FuY2VsUmVzdWx0ID0gYXdhaXQgY2FuY2VsUGl4aW9SdW4ocnVuSWQsIGFwaUtleSk7XHJcblxyXG4gICAgLy8gTm90ZTogRXZlbiBpZiB0aGUgY2FuY2VsIEFQSSBjYWxsIGZhaWxzLCB3ZSBzdGlsbCBtYXJrIGl0IGFzIGNhbmNlbGxlZCBsb2NhbGx5XHJcbiAgICBpZiAoIWNhbmNlbFJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihgW0FjdGlvbl0gUGl4aW8gY2FuY2VsIEFQSSBmYWlsZWQ6ICR7Y2FuY2VsUmVzdWx0LmVycm9yfSwgYnV0IGNvbnRpbnVpbmcgd2l0aCBsb2NhbCBjYW5jZWxsYXRpb25gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgZGF0YWJhc2UgdG8gY2FuY2VsbGVkL2ZhaWxlZCBzdGF0dXNcclxuICAgIGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAuLi4obWVkaWFSZWNvcmQubWV0YWRhdGEgYXMgb2JqZWN0IHx8IHt9KSxcclxuICAgICAgICAgIGVycm9yOiAnQ2FuY2VsbGVkIGJ5IHVzZXInLFxyXG4gICAgICAgICAgY2FuY2VsbGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICBjYW5jZWxfYXBpX3N0YXR1czogY2FuY2VsUmVzdWx0LnN1Y2Nlc3MgPyAnc3VjY2VzcycgOiAnZmFpbGVkJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbQWN0aW9uXSBFcnJvciB1cGRhdGluZyBjYW5jZWxsZWQgc3RhdHVzOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRmFpbGVkIHRvIHVwZGF0ZSBjYW5jZWxsYXRpb24gc3RhdHVzJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBTdWNjZXNzZnVsbHkgY2FuY2VsbGVkIGdlbmVyYXRpb24gJHttZWRpYUlkfWApO1xyXG4gICAgcmV2YWxpZGF0ZVBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihgW0FjdGlvbl0gRXJyb3IgY2FuY2VsbGluZyBnZW5lcmF0aW9uICR7bWVkaWFJZH06YCwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRGVsZXRlcyBhIG1lZGlhIGl0ZW0gcmVjb3JkIGFuZCBpdHMgYXNzb2NpYXRlZCBmaWxlIGZyb20gc3RvcmFnZS5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVNZWRpYShtZWRpYUlkOiBzdHJpbmcsIHN0b3JhZ2VQYXRoOiBzdHJpbmcgfCBudWxsKTogUHJvbWlzZTx7XHJcbiAgICBzdWNjZXNzOiBib29sZWFuO1xyXG4gICAgZXJyb3I/OiBzdHJpbmc7XHJcbiAgfT4ge1xyXG4gICAgaWYgKCFtZWRpYUlkKSB7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJNZWRpYSBJRCBpcyByZXF1aXJlZC5cIiB9OyB9XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpOyAvLyBVc2Ugc2VydmVyIGNsaWVudCB0byBnZXQgdXNlclxyXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcbiAgICBpZiAoIXVzZXIgfHwgdXNlckVycm9yKSB7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIGVycm9yJyB9OyB9XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtBY3Rpb25dIERlbGV0aW5nIG1lZGlhICR7bWVkaWFJZH0gKHBhdGg6ICR7c3RvcmFnZVBhdGggfHwgJ04vQSd9KSBmb3IgdXNlciAke3VzZXIuaWR9YCk7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBWZXJpZnkgb3duZXJzaGlwIHVzaW5nIGFkbWluIGNsaWVudFxyXG4gICAgICBjb25zdCB7IGRhdGE6IG1lZGlhUmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdnZW5lcmF0ZWRfbWVkaWEnKS5zZWxlY3QoJ2lkLCB1c2VyX2lkLCBzdG9yYWdlX3BhdGgnKS5lcSgnaWQnLCBtZWRpYUlkKS5zaW5nbGUoKTtcclxuICAgICAgaWYgKGZldGNoRXJyb3IgfHwgIW1lZGlhUmVjb3JkKSB7IGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGZldGNoaW5nIG1lZGlhICR7bWVkaWFJZH0gZm9yIGRlbGV0aW9uIG9yIG5vdCBmb3VuZDpgLCBmZXRjaEVycm9yKTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWVkaWEgcmVjb3JkIG5vdCBmb3VuZC4nIH07IH1cclxuICAgICAgaWYgKG1lZGlhUmVjb3JkLnVzZXJfaWQgIT09IHVzZXIuaWQpIHsgY29uc29sZS53YXJuKGBbQWN0aW9uXSBVc2VyICR7dXNlci5pZH0gYXR0ZW1wdGVkIHRvIGRlbGV0ZSBtZWRpYSAke21lZGlhSWR9IG93bmVkIGJ5ICR7bWVkaWFSZWNvcmQudXNlcl9pZH0uIERlbnlpbmcuYCk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1Blcm1pc3Npb24gZGVuaWVkLicgfTsgfVxyXG5cclxuICAgICAgY29uc3QgYWN0dWFsU3RvcmFnZVBhdGggPSBtZWRpYVJlY29yZC5zdG9yYWdlX3BhdGg7XHJcblxyXG4gICAgICAvLyBEZWxldGUgZnJvbSBTdG9yYWdlICpvbmx5IGlmIHBhdGggZXhpc3RzKiB1c2luZyB0aGUgc2VydmljZSBmdW5jdGlvblxyXG4gICAgICBpZiAoYWN0dWFsU3RvcmFnZVBhdGgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgW0FjdGlvbl0gQ2FsbGluZyBzZXJ2aWNlIHRvIGRlbGV0ZSBmaWxlIGZyb20gc3RvcmFnZTogJHthY3R1YWxTdG9yYWdlUGF0aH1gKTtcclxuICAgICAgICBjb25zdCB7IHN1Y2Nlc3M6IGRlbGV0ZVN1Y2Nlc3MsIGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgZGVsZXRlRmlsZVNlcnZpY2UoYWN0dWFsU3RvcmFnZVBhdGgpOyAvLyBVc2Ugc3RvcmFnZSBzZXJ2aWNlXHJcbiAgICAgICAgaWYgKCFkZWxldGVTdWNjZXNzKSB7IGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIEVycm9yIGRlbGV0aW5nIGZpbGUgJHthY3R1YWxTdG9yYWdlUGF0aH0gZnJvbSBzdG9yYWdlIChjb250aW51aW5nKTpgLCBkZWxldGVFcnJvcik7IH1cclxuICAgICAgICBlbHNlIHsgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBkZWxldGVkIGZpbGUgJHthY3R1YWxTdG9yYWdlUGF0aH0gdmlhIHNlcnZpY2UuYCk7IH1cclxuICAgICAgfSBlbHNlIHsgY29uc29sZS5sb2coYFtBY3Rpb25dIE5vIHN0b3JhZ2UgcGF0aCBmb3IgbWVkaWEgJHttZWRpYUlkfSwgc2tpcHBpbmcgc3RvcmFnZSBkZWxldGlvbi5gKTsgfVxyXG5cclxuICAgICAgLy8gRGVsZXRlIGZyb20gRGF0YWJhc2UgdXNpbmcgYWRtaW4gY2xpZW50XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQWN0aW9uXSBEZWxldGluZyByZWNvcmQgZnJvbSBkYXRhYmFzZTogJHttZWRpYUlkfWApO1xyXG4gICAgICBjb25zdCB7IGVycm9yOiBkYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmZyb20oJ2dlbmVyYXRlZF9tZWRpYScpLmRlbGV0ZSgpLmVxKCdpZCcsIG1lZGlhSWQpO1xyXG4gICAgICBpZiAoZGJFcnJvcikgeyBjb25zb2xlLmVycm9yKGBbQWN0aW9uXSBFcnJvciBkZWxldGluZyByZWNvcmQgJHttZWRpYUlkfSBmcm9tIGRhdGFiYXNlOmAsIGRiRXJyb3IpOyB0aHJvdyBuZXcgRXJyb3IoYERhdGFiYXNlIGRlbGV0aW9uIGZhaWxlZDogJHtkYkVycm9yLm1lc3NhZ2V9YCk7IH1cclxuICAgICAgY29uc29sZS5sb2coYFtBY3Rpb25dIFN1Y2Nlc3NmdWxseSBkZWxldGVkIHJlY29yZCAke21lZGlhSWR9IGZyb20gZGF0YWJhc2UuYCk7XHJcblxyXG4gICAgICByZXZhbGlkYXRlUGF0aCgnL2Rhc2hib2FyZCcpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtBY3Rpb25dIFVuZXhwZWN0ZWQgZXJyb3IgZHVyaW5nIG1lZGlhIGRlbGV0aW9uIGZvciAke21lZGlhSWR9OmAsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaGVzIGNvbXBsZXRlZCBhbmQgcHJvY2Vzc2luZyBtZWRpYSBpdGVtcyBmb3IgdGhlIGN1cnJlbnQgdXNlci5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaFVzZXJNZWRpYSgpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIG1lZGlhOiBHZW5lcmF0ZWRNZWRpYVtdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTsgLy8gVXNlcyBzZXJ2ZXIgY2xpZW50XHJcbiAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcbiAgaWYgKCF1c2VyIHx8IHVzZXJFcnJvcikgeyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvcicsIG1lZGlhOiBbXSB9OyB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBVc2UgdXNlci1jb250ZXh0IGNsaWVudCBmb3IgUkxTXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnZ2VuZXJhdGVkX21lZGlhJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpXHJcbiAgICAgIC5pbignc3RhdHVzJywgWydwZW5kaW5nJywgJ3Byb2Nlc3NpbmcnLCAnY29tcGxldGVkJywgJ2ZhaWxlZCddKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDUwKTsgLy8gQWRqdXN0IGxpbWl0IGFzIG5lZWRlZFxyXG5cclxuICAgIGlmIChlcnJvcikgeyB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBtZWRpYTogJHtlcnJvci5tZXNzYWdlfWApOyB9XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZWRpYTogZGF0YSB8fCBbXSwgZXJyb3I6IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIGZldGNoaW5nIHVzZXIgbWVkaWE6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlLCBtZWRpYTogW10gfTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXJ2ZXIgQWN0aW9uIHRvIGxpc3QgdXNlcidzIGdlbmVyYXRlZCBpbWFnZXMgYW5kIGlucHV0IGltYWdlcyBmb3Igc2VsZWN0aW9uLlxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3RVc2VySW1hZ2VzRm9yU2VsZWN0aW9uKCk6IFByb21pc2U8e1xyXG4gICAgc3VjY2VzczogYm9vbGVhbjtcclxuICAgIGltYWdlczogeyB2YWx1ZTogc3RyaW5nOyBsYWJlbDogc3RyaW5nOyB0eXBlOiAnZ2VuZXJhdGVkJyB8ICdpbnB1dCcgfVtdO1xyXG4gICAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7IC8vIFVzZSBzZXJ2ZXIgY2xpZW50IHRvIGdldCB1c2VyXHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuICAgIGlmICghdXNlciB8fCB1c2VyRXJyb3IpIHsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGltYWdlczogW10sIGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH07IH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IFtnZW5lcmF0ZWRSZXN1bHQsIGlucHV0UmVzdWx0XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICAgICAgLy8gRmV0Y2ggY29tcGxldGVkIGdlbmVyYXRlZCBpbWFnZXMgdXNpbmcgUkxTLWVuYWJsZWQgY2xpZW50XHJcbiAgICAgICAgICAgIHN1cGFiYXNlXHJcbiAgICAgICAgICAgICAgICAuZnJvbSgnZ2VuZXJhdGVkX21lZGlhJylcclxuICAgICAgICAgICAgICAgIC5zZWxlY3QoJ2lkLCBwcm9tcHQsIG1lZGlhX3VybCcpXHJcbiAgICAgICAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxyXG4gICAgICAgICAgICAgICAgLmVxKCdtZWRpYV90eXBlJywgJ2ltYWdlJylcclxuICAgICAgICAgICAgICAgIC5lcSgnc3RhdHVzJywgJ2NvbXBsZXRlZCcpXHJcbiAgICAgICAgICAgICAgICAubm90KCdtZWRpYV91cmwnLCAnaXMnLCBudWxsKVxyXG4gICAgICAgICAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgICAgICAgICAgICAubGltaXQoNTApLCAvLyBMaW1pdCBnZW5lcmF0ZWQgaW1hZ2VzIHNob3duXHJcbiAgICAgICAgICAgIC8vIEZldGNoIGlucHV0IGltYWdlcyB1c2luZyB0aGUgc2VydmljZSBmdW5jdGlvbiAodXNlcyBhZG1pbiBjbGllbnQpXHJcbiAgICAgICAgICAgIGxpc3RVc2VyRmlsZXNTZXJ2aWNlKHVzZXIuaWQsICdpbnB1dHMnKVxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICBjb25zdCBmZXRjaGVkSW1hZ2VzOiB7IHZhbHVlOiBzdHJpbmc7IGxhYmVsOiBzdHJpbmc7IHR5cGU6ICdnZW5lcmF0ZWQnIHwgJ2lucHV0JyB9W10gPSBbXTtcclxuXHJcbiAgICAgICAgLy8gUHJvY2VzcyBnZW5lcmF0ZWQgaW1hZ2VzXHJcbiAgICAgICAgaWYgKGdlbmVyYXRlZFJlc3VsdC5lcnJvcikgeyBjb25zb2xlLmVycm9yKFwiW0FjdGlvbl0gRXJyb3IgZmV0Y2hpbmcgZ2VuZXJhdGVkIGltYWdlczpcIiwgZ2VuZXJhdGVkUmVzdWx0LmVycm9yKTsgfVxyXG4gICAgICAgIGVsc2UgaWYgKGdlbmVyYXRlZFJlc3VsdC5kYXRhKSB7IGdlbmVyYXRlZFJlc3VsdC5kYXRhLmZvckVhY2goaXRlbSA9PiB7IGZldGNoZWRJbWFnZXMucHVzaCh7IHZhbHVlOiBpdGVtLm1lZGlhX3VybCEsIGxhYmVsOiBpdGVtLnByb21wdCA/IGBHZW46ICR7aXRlbS5wcm9tcHQuc3Vic3RyaW5nKDAsIDMwKX0uLi5gIDogYEdlbmVyYXRlZCBJbWFnZSAke2l0ZW0uaWQuc3Vic3RyaW5nKDAsIDYpfWAsIHR5cGU6ICdnZW5lcmF0ZWQnLCB9KTsgfSk7IH1cclxuXHJcbiAgICAgICAgLy8gUHJvY2VzcyBpbnB1dCBpbWFnZXNcclxuICAgICAgICBpZiAoIWlucHV0UmVzdWx0LnN1Y2Nlc3MpIHsgY29uc29sZS5lcnJvcihcIltBY3Rpb25dIEVycm9yIGZldGNoaW5nIGlucHV0IGltYWdlczpcIiwgaW5wdXRSZXN1bHQuZXJyb3IpOyB9XHJcbiAgICAgICAgZWxzZSBpZiAoaW5wdXRSZXN1bHQuZmlsZXMpIHsgaW5wdXRSZXN1bHQuZmlsZXMuZm9yRWFjaChmaWxlID0+IHsgaWYgKGZpbGUucHVibGljVXJsICYmIC9cXC4oanBnfGpwZWd8cG5nfHdlYnB8Z2lmKSQvaS50ZXN0KGZpbGUubmFtZSkpIHsgZmV0Y2hlZEltYWdlcy5wdXNoKHsgdmFsdWU6IGZpbGUucHVibGljVXJsLCBsYWJlbDogYElucHV0OiAke2ZpbGUubmFtZX1gLCB0eXBlOiAnaW5wdXQnLCB9KTsgfSB9KTsgfVxyXG5cclxuICAgICAgICBmZXRjaGVkSW1hZ2VzLnNvcnQoKGEsIGIpID0+IGEubGFiZWwubG9jYWxlQ29tcGFyZShiLmxhYmVsKSk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgaW1hZ2VzOiBmZXRjaGVkSW1hZ2VzIH07XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBY3Rpb25dIEVycm9yIGxpc3RpbmcgdXNlciBpbWFnZXM6JywgZXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBpbWFnZXM6IFtdLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG59XHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoibVRBbVJzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/apps/web/src/components/dashboard/media-library.tsx [app-client] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
// src/components/dashboard/media-library.tsx
__turbopack_context__.s({
    "MediaLibrary": (()=>MediaLibrary)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)"); // Added useRef
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$actions$2f$data$3a$9b33ab__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/lib/actions/data:9b33ab [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$actions$2f$data$3a$ed8ab4__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/lib/actions/data:ed8ab4 [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$index$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/packages/ui/src/index.ts [app-client] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$tabs$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/tabs.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/card.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ImageIcon$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/image.js [app-client] (ecmascript) <export default as ImageIcon>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$video$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__VideoIcon$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/video.js [app-client] (ecmascript) <export default as VideoIcon>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/loader-circle.js [app-client] (ecmascript) <export default as Loader2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$calendar$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Calendar$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/calendar.js [app-client] (ecmascript) <export default as Calendar>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$download$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Download$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/download.js [app-client] (ecmascript) <export default as Download>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$copy$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Copy$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/copy.js [app-client] (ecmascript) <export default as Copy>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/check.js [app-client] (ecmascript) <export default as Check>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__AlertCircle$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/circle-alert.js [app-client] (ecmascript) <export default as AlertCircle>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$trash$2d$2$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Trash2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/trash-2.js [app-client] (ecmascript) <export default as Trash2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$library$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Library$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/library.js [app-client] (ecmascript) <export default as Library>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$film$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Film$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/film.js [app-client] (ecmascript) <export default as Film>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__XCircle$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/circle-x.js [app-client] (ecmascript) <export default as XCircle>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/image.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/button.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$supabase$2f$src$2f$lib$2f$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/supabase/src/lib/client.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/packages/ui/src/components/ui/alert-dialog.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/framer-motion/dist/es/render/components/motion/proxy.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$components$2f$AnimatePresence$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/framer-motion/dist/es/components/AnimatePresence/index.mjs [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature(), _s1 = __turbopack_context__.k.signature();
'use client';
;
;
;
;
;
;
;
;
;
;
;
function MediaLibrary({ initialMedia = [] }) {
    _s();
    const [media, setMedia] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(initialMedia);
    const [activeTab, setActiveTab] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])('all');
    const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$supabase$2f$src$2f$lib$2f$client$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createClient"])();
    const [userId, setUserId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const channelRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    // Get user ID on mount
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "MediaLibrary.useEffect": ()=>{
            const getUser = {
                "MediaLibrary.useEffect.getUser": async ()=>{
                    const { data: { user } } = await supabase.auth.getUser();
                    setUserId(user?.id || null);
                }
            }["MediaLibrary.useEffect.getUser"];
            getUser();
        }
    }["MediaLibrary.useEffect"], [
        supabase
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "MediaLibrary.useEffect": ()=>{
            if (!userId || channelRef.current) return; // Don't subscribe if no user or already subscribed
            console.log(`MediaLibrary: Setting up Realtime for user ${userId}`);
            const channel = supabase.channel(`media-updates-for-${userId}`).on('postgres_changes', {
                event: '*',
                schema: 'public',
                table: 'generated_media',
                filter: `user_id=eq.${userId}`
            }, {
                "MediaLibrary.useEffect.channel": (payload)=>{
                    console.log('MediaLibrary: Realtime payload:', payload);
                    const newMedia = payload.new;
                    const oldMedia = payload.old;
                    setMedia({
                        "MediaLibrary.useEffect.channel": (currentMedia)=>{
                            let updatedMedia = [
                                ...currentMedia
                            ];
                            if (payload.eventType === 'INSERT') {
                                if (!updatedMedia.some({
                                    "MediaLibrary.useEffect.channel": (item)=>item.id === newMedia.id
                                }["MediaLibrary.useEffect.channel"])) {
                                    updatedMedia.unshift(newMedia); // Add to beginning
                                    console.log(`MediaLibrary: Inserted ${newMedia.id}`);
                                }
                            } else if (payload.eventType === 'UPDATE') {
                                const index = updatedMedia.findIndex({
                                    "MediaLibrary.useEffect.channel.index": (item)=>item.id === newMedia.id
                                }["MediaLibrary.useEffect.channel.index"]);
                                if (index !== -1) {
                                    updatedMedia[index] = newMedia;
                                    console.log(`MediaLibrary: Updated ${newMedia.id}`);
                                } else {
                                    updatedMedia.unshift(newMedia); // Insert if not found (edge case)
                                    console.log(`MediaLibrary: Inserted updated ${newMedia.id}`);
                                }
                            } else if (payload.eventType === 'DELETE' && oldMedia?.id) {
                                updatedMedia = updatedMedia.filter({
                                    "MediaLibrary.useEffect.channel": (item)=>item.id !== oldMedia.id
                                }["MediaLibrary.useEffect.channel"]);
                                console.log(`MediaLibrary: Deleted ${oldMedia.id}`);
                            }
                            // Ensure sorting remains consistent
                            return updatedMedia.sort({
                                "MediaLibrary.useEffect.channel": (a, b)=>new Date(b.created_at).getTime() - new Date(a.created_at).getTime()
                            }["MediaLibrary.useEffect.channel"]);
                        }
                    }["MediaLibrary.useEffect.channel"]);
                }
            }["MediaLibrary.useEffect.channel"]).subscribe({
                "MediaLibrary.useEffect.channel": (status, err)=>{
                    // --- MODIFIED ERROR HANDLING ---
                    if (status === 'SUBSCRIBED') {
                        console.log(`MediaLibrary: Realtime SUBSCRIBED for user ${userId}`);
                    } else if (status === 'CHANNEL_ERROR') {
                        // Log more details, specifically handling undefined 'err'
                        console.error(`MediaLibrary: Realtime CHANNEL_ERROR. Status: ${status}, Error:`, err ?? 'Error object is undefined');
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Realtime connection error. Updates might be delayed.", {
                            duration: 10000
                        });
                    } else if (status === 'TIMED_OUT') {
                        console.warn(`MediaLibrary: Realtime TIMED_OUT. Status: ${status}`);
                        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].warning("Realtime connection timed out. Attempting to reconnect.", {
                            duration: 10000
                        });
                    } else if (status === 'CLOSED') {
                        console.log(`MediaLibrary: Realtime channel CLOSED for user ${userId}. Status: ${status}`);
                    // Optionally attempt to resubscribe or notify user if closure was unexpected
                    } else {
                        // Log any other status updates
                        console.log(`MediaLibrary: Realtime status update: ${status}`);
                    }
                // --- END MODIFIED ERROR HANDLING ---
                }
            }["MediaLibrary.useEffect.channel"]);
            channelRef.current = channel; // Store channel in ref
            // Cleanup function
            return ({
                "MediaLibrary.useEffect": ()=>{
                    if (channelRef.current) {
                        console.log(`MediaLibrary: Unsubscribing from Realtime for ${userId}`);
                        supabase.removeChannel(channelRef.current).catch({
                            "MediaLibrary.useEffect": (err)=>console.error("Error removing channel:", err)
                        }["MediaLibrary.useEffect"]);
                        channelRef.current = null; // Clear ref on cleanup
                    }
                }
            })["MediaLibrary.useEffect"];
        }
    }["MediaLibrary.useEffect"], [
        supabase,
        userId
    ]); // Depend only on supabase and userId
    const handleItemDeleted = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "MediaLibrary.useCallback[handleItemDeleted]": (deletedMediaId)=>{
            setMedia({
                "MediaLibrary.useCallback[handleItemDeleted]": (prevMedia)=>prevMedia.filter({
                        "MediaLibrary.useCallback[handleItemDeleted]": (item)=>item.id !== deletedMediaId
                    }["MediaLibrary.useCallback[handleItemDeleted]"])
            }["MediaLibrary.useCallback[handleItemDeleted]"]);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].info("Media removed.");
        }
    }["MediaLibrary.useCallback[handleItemDeleted]"], []);
    const filteredMedia = activeTab === 'all' ? media : media.filter((item)=>item.media_type === activeTab);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "mt-10 space-y-6",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                        className: "text-2xl font-semibold flex items-center gap-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$library$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Library$3e$__["Library"], {
                                className: "w-6 h-6 text-primary/80"
                            }, void 0, false, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 133,
                                columnNumber: 11
                            }, this),
                            " Media Library"
                        ]
                    }, void 0, true, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 132,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$tabs$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Tabs"], {
                        value: activeTab,
                        onValueChange: (value)=>setActiveTab(value),
                        className: "w-full sm:w-auto",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$tabs$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["TabsList"], {
                            className: "grid w-full grid-cols-3 bg-white/5 border border-white/10 p-1 rounded-lg backdrop-blur-sm",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$tabs$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["TabsTrigger"], {
                                    value: "all",
                                    className: "data-[state=active]:bg-white/10 data-[state=active]:text-foreground data-[state=active]:shadow-md rounded-md transition-all",
                                    children: "All"
                                }, void 0, false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                    lineNumber: 137,
                                    columnNumber: 14
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$tabs$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["TabsTrigger"], {
                                    value: "image",
                                    className: "data-[state=active]:bg-white/10 data-[state=active]:text-foreground data-[state=active]:shadow-md rounded-md transition-all",
                                    children: "Images"
                                }, void 0, false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                    lineNumber: 138,
                                    columnNumber: 14
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$tabs$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["TabsTrigger"], {
                                    value: "video",
                                    className: "data-[state=active]:bg-white/10 data-[state=active]:text-foreground data-[state=active]:shadow-md rounded-md transition-all",
                                    children: "Videos"
                                }, void 0, false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                    lineNumber: 139,
                                    columnNumber: 14
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                            lineNumber: 136,
                            columnNumber: 11
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 135,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                lineNumber: 131,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$components$2f$AnimatePresence$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AnimatePresence"], {
                children: filteredMedia.length === 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                    initial: {
                        opacity: 0,
                        y: 20
                    },
                    animate: {
                        opacity: 1,
                        y: 0
                    },
                    exit: {
                        opacity: 0,
                        y: -10
                    },
                    transition: {
                        duration: 0.3
                    },
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Card"], {
                        className: "glass-card border-dashed border-white/20",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CardContent"], {
                            className: "flex flex-col items-center justify-center py-20 text-center px-6",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "p-6 mb-6 rounded-full bg-gradient-to-br from-primary/20 to-secondary/20 border-2 border-primary/30 shadow-lg",
                                    children: activeTab === 'image' ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ImageIcon$3e$__["ImageIcon"], {
                                        className: "h-12 w-12 text-primary"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 151,
                                        columnNumber: 46
                                    }, this) : activeTab === 'video' ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$film$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Film$3e$__["Film"], {
                                        className: "h-12 w-12 text-primary"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 151,
                                        columnNumber: 121
                                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$library$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Library$3e$__["Library"], {
                                        className: "h-12 w-12 text-primary"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 151,
                                        columnNumber: 167
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                    lineNumber: 150,
                                    columnNumber: 19
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                    className: "text-2xl font-bold mb-3 text-foreground",
                                    children: activeTab === 'all' ? 'Your Media Library is Empty' : `No ${activeTab}s Yet`
                                }, void 0, false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                    lineNumber: 155,
                                    columnNumber: 19
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-muted-foreground max-w-md mb-6 text-base",
                                    children: activeTab === 'all' ? 'Start generating AI-powered images and videos. Your creations will appear here.' : `Generate your first ${activeTab} using one of our AI models above.`
                                }, void 0, false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                    lineNumber: 160,
                                    columnNumber: 19
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-2xl mb-6 text-left",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex items-start gap-2 text-sm",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0 mt-0.5",
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ImageIcon$3e$__["ImageIcon"], {
                                                        className: "w-3 h-3 text-primary"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                        lineNumber: 171,
                                                        columnNumber: 25
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                    lineNumber: 170,
                                                    columnNumber: 23
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "font-medium text-foreground/90",
                                                            children: "Krea Flux"
                                                        }, void 0, false, {
                                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                            lineNumber: 174,
                                                            columnNumber: 25
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "text-xs text-muted-foreground",
                                                            children: "High-quality images"
                                                        }, void 0, false, {
                                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                            lineNumber: 175,
                                                            columnNumber: 25
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                    lineNumber: 173,
                                                    columnNumber: 23
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                            lineNumber: 169,
                                            columnNumber: 21
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex items-start gap-2 text-sm",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0 mt-0.5",
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ImageIcon$3e$__["ImageIcon"], {
                                                        className: "w-3 h-3 text-primary"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                        lineNumber: 181,
                                                        columnNumber: 25
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                    lineNumber: 180,
                                                    columnNumber: 23
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "font-medium text-foreground/90",
                                                            children: "Qwen Edit"
                                                        }, void 0, false, {
                                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                            lineNumber: 184,
                                                            columnNumber: 25
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "text-xs text-muted-foreground",
                                                            children: "AI image editing"
                                                        }, void 0, false, {
                                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                            lineNumber: 185,
                                                            columnNumber: 25
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                    lineNumber: 183,
                                                    columnNumber: 23
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                            lineNumber: 179,
                                            columnNumber: 21
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex items-start gap-2 text-sm",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0 mt-0.5",
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$film$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Film$3e$__["Film"], {
                                                        className: "w-3 h-3 text-primary"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                        lineNumber: 191,
                                                        columnNumber: 25
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                    lineNumber: 190,
                                                    columnNumber: 23
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "font-medium text-foreground/90",
                                                            children: "Wan 2.2"
                                                        }, void 0, false, {
                                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                            lineNumber: 194,
                                                            columnNumber: 25
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "text-xs text-muted-foreground",
                                                            children: "Video transitions"
                                                        }, void 0, false, {
                                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                            lineNumber: 195,
                                                            columnNumber: 25
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                    lineNumber: 193,
                                                    columnNumber: 23
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                            lineNumber: 189,
                                            columnNumber: 21
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                    lineNumber: 168,
                                    columnNumber: 19
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    onClick: ()=>window.scrollTo({
                                            top: 0,
                                            behavior: 'smooth'
                                        }),
                                    className: "glass-button bg-gradient-to-r from-primary to-secondary text-white px-6 py-3 rounded-lg font-medium hover:opacity-90 transition-all shadow-md hover:shadow-lg",
                                    children: "Start Creating"
                                }, void 0, false, {
                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                    lineNumber: 201,
                                    columnNumber: 19
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                            lineNumber: 148,
                            columnNumber: 17
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 147,
                        columnNumber: 15
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                    lineNumber: 146,
                    columnNumber: 13
                }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                    layout: true,
                    className: "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5",
                    children: filteredMedia.map((item, index)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                            layout: true,
                            initial: {
                                opacity: 0,
                                y: 20
                            },
                            animate: {
                                opacity: 1,
                                y: 0
                            },
                            exit: {
                                opacity: 0,
                                scale: 0.9
                            },
                            transition: {
                                duration: 0.3,
                                delay: index * 0.05
                            },
                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(MediaCard, {
                                item: item,
                                onDeleted: ()=>handleItemDeleted(item.id)
                            }, void 0, false, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 214,
                                columnNumber: 21
                            }, this)
                        }, item.id, false, {
                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                            lineNumber: 213,
                            columnNumber: 18
                        }, this))
                }, void 0, false, {
                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                    lineNumber: 211,
                    columnNumber: 13
                }, this)
            }, void 0, false, {
                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                lineNumber: 144,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
        lineNumber: 130,
        columnNumber: 5
    }, this);
}
_s(MediaLibrary, "i2oTZ2GRiNOABlFz1bBrHyN8ILg=");
_c = MediaLibrary;
function MediaCard({ item, onDeleted }) {
    _s1();
    const [isCopied, setIsCopied] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [isDeleting, setIsDeleting] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [isCancelling, setIsCancelling] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const formattedDate = new Date(item.created_at).toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric'
    });
    const downloadMedia = async (e)=>{
        e.stopPropagation();
        if (!item.media_url) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Media URL not available.");
            return;
        }
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].info("Starting download...");
        try {
            const response = await fetch(item.media_url, {
                mode: 'cors'
            });
            if (!response.ok) throw new Error(`Fetch failed: ${response.statusText}`);
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            // Determine extension based on URL or media_type
            const urlExtension = item.media_url.split('.').pop()?.toLowerCase();
            const defaultExtension = item.media_type === 'image' ? 'png' : 'mp4'; // Default to mp4 for video
            const extension = urlExtension && [
                'png',
                'jpg',
                'jpeg',
                'webp',
                'gif',
                'mp4'
            ].includes(urlExtension) ? `.${urlExtension}` : `.${defaultExtension}`;
            a.download = `${item.media_type}-${item.id.substring(0, 8)}${extension}`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success(`${item.media_type} downloaded`);
        } catch (error) {
            console.error('Download failed:', error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(`Download failed: ${error.message}`);
        }
    };
    const copyPrompt = (e)=>{
        e.stopPropagation();
        if (!item.prompt) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("No prompt available.");
            return;
        }
        navigator.clipboard.writeText(item.prompt).then(()=>{
            setIsCopied(true);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success('Prompt copied!');
            setTimeout(()=>setIsCopied(false), 2000);
        }).catch((error)=>{
            console.error('Copy failed:', error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error('Failed to copy prompt');
        });
    };
    const handleDeleteConfirm = async ()=>{
        if (!item.id) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Cannot delete: Missing ID.");
            return;
        }
        setIsDeleting(true);
        console.log(`Deleting media: ${item.id}, path: ${item.storage_path || 'N/A'}`);
        try {
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$actions$2f$data$3a$9b33ab__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["deleteMedia"])(item.id, item.storage_path);
            if (result.success) onDeleted(); // Parent handles UI update and success toast
            else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(`Delete failed: ${result.error}`);
                setIsDeleting(false);
            }
        } catch (error) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(`Error deleting: ${error.message}`);
            setIsDeleting(false);
        }
    };
    const handleCancelConfirm = async ()=>{
        if (!item.id) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Cannot cancel: Missing ID.");
            return;
        }
        setIsCancelling(true);
        console.log(`Cancelling media generation: ${item.id}`);
        try {
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$actions$2f$data$3a$ed8ab4__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["cancelGeneration"])(item.id);
            if (result.success) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success('Generation cancelled');
            // No need to call onDeleted - Realtime will update the UI
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(`Cancel failed: ${result.error}`);
            }
        } catch (error) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(`Error cancelling: ${error.message}`);
        } finally{
            setIsCancelling(false);
        }
    };
    const isLoading = item.status === 'pending' || item.status === 'processing';
    const isFailed = item.status === 'failed';
    const isCompleted = item.status === 'completed';
    const showActions = isCompleted || isFailed;
    const showCancel = isLoading && !isCancelling;
    const isMp4Video = item.media_type === 'video' && item.media_url?.toLowerCase().endsWith('.mp4');
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
        whileHover: {
            y: -5,
            scale: 1.03
        },
        transition: {
            type: "spring",
            stiffness: 300,
            damping: 20
        },
        className: `glass-card group relative overflow-hidden rounded-lg border border-white/10 shadow-md transition-all duration-300 flex flex-col h-full ${isLoading ? 'opacity-60 animate-pulse' : ''} ${isFailed ? 'border-destructive/50' : ''}`,
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "relative aspect-square overflow-hidden bg-black/10",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$components$2f$AnimatePresence$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AnimatePresence"], {
                        children: [
                            isLoading && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                                initial: {
                                    opacity: 0
                                },
                                animate: {
                                    opacity: 1
                                },
                                exit: {
                                    opacity: 0
                                },
                                className: "absolute inset-0 flex flex-col items-center justify-center bg-black/50 backdrop-blur-sm z-10 p-4 text-center",
                                children: [
                                    " ",
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                        className: "h-8 w-8 animate-spin text-primary mb-2"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 313,
                                        columnNumber: 255
                                    }, this),
                                    " ",
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "text-xs font-medium text-primary-foreground",
                                        children: [
                                            item.status,
                                            "..."
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 313,
                                        columnNumber: 318
                                    }, this),
                                    " "
                                ]
                            }, "loading-overlay", true, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 313,
                                columnNumber: 27
                            }, this),
                            isFailed && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                                initial: {
                                    opacity: 0
                                },
                                animate: {
                                    opacity: 1
                                },
                                exit: {
                                    opacity: 0
                                },
                                className: "absolute inset-0 flex flex-col items-center justify-center bg-destructive/40 backdrop-blur-sm z-10 p-4 text-center",
                                children: [
                                    " ",
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__AlertCircle$3e$__["AlertCircle"], {
                                        className: "h-8 w-8 text-destructive-foreground mb-2"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 314,
                                        columnNumber: 259
                                    }, this),
                                    " ",
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "text-xs font-medium text-destructive-foreground",
                                        children: "Failed"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 314,
                                        columnNumber: 328
                                    }, this),
                                    " ",
                                    typeof item.metadata === 'object' && item.metadata !== null && 'error' in item.metadata && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                        className: "text-[10px] text-destructive-foreground/80 mt-1 line-clamp-2",
                                        title: String(item.metadata.error),
                                        children: [
                                            " ",
                                            String(item.metadata.error),
                                            " "
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 314,
                                        columnNumber: 502
                                    }, this),
                                    " "
                                ]
                            }, "failed-overlay", true, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 314,
                                columnNumber: 26
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 312,
                        columnNumber: 9
                    }, this),
                    isCompleted && item.media_url ? isMp4Video ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("video", {
                        src: item.media_url,
                        controls: true,
                        preload: "metadata",
                        className: "w-full h-full object-contain transition-transform duration-300 group-hover:scale-105",
                        onError: (e)=>{
                            e.currentTarget.style.display = 'none';
                        }
                    }, void 0, false, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 320,
                        columnNumber: 17
                    }, this) : item.media_type === 'video' ? // Assume webp video if not mp4
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                        src: item.media_url,
                        alt: item.prompt || 'Generated video',
                        fill: true,
                        className: "object-contain transition-transform duration-300 group-hover:scale-105",
                        unoptimized: true,
                        onError: (e)=>{
                            e.currentTarget.style.display = 'none';
                        }
                    }, void 0, false, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 329,
                        columnNumber: 18
                    }, this) : // Image
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                        src: item.media_url,
                        alt: item.prompt || 'Generated image',
                        fill: true,
                        className: "object-cover transition-transform duration-300 group-hover:scale-105",
                        unoptimized: true,
                        onError: (e)=>{
                            e.currentTarget.style.display = 'none';
                        }
                    }, void 0, false, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 332,
                        columnNumber: 18
                    }, this) : !isFailed && !isLoading && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "w-full h-full flex items-center justify-center text-muted-foreground/30",
                        children: [
                            " ",
                            item.media_type === 'image' ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ImageIcon$3e$__["ImageIcon"], {
                                className: "h-16 w-16"
                            }, void 0, false, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 335,
                                columnNumber: 161
                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$video$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__VideoIcon$3e$__["VideoIcon"], {
                                className: "h-16 w-16"
                            }, void 0, false, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 335,
                                columnNumber: 199
                            }, this),
                            " "
                        ]
                    }, void 0, true, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 335,
                        columnNumber: 40
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "absolute top-2 right-2 bg-black/50 backdrop-blur-sm rounded-md px-2 py-1 text-xs font-medium flex items-center gap-1 z-20 text-white/90 border border-white/10",
                        children: [
                            item.media_type === 'image' ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ImageIcon$3e$__["ImageIcon"], {
                                className: "h-3 w-3"
                            }, void 0, false, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 340,
                                columnNumber: 43
                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$video$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__VideoIcon$3e$__["VideoIcon"], {
                                className: "h-3 w-3"
                            }, void 0, false, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 340,
                                columnNumber: 79
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                className: "capitalize",
                                children: item.media_type
                            }, void 0, false, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 341,
                                columnNumber: 12
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 339,
                        columnNumber: 10
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                lineNumber: 310,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CardContent"], {
                className: "p-3 flex flex-col flex-grow",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "text-xs text-muted-foreground line-clamp-2 h-8 flex-grow mb-2",
                        title: item.prompt,
                        children: [
                            " ",
                            item.prompt || 'No prompt',
                            " "
                        ]
                    }, void 0, true, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 347,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center justify-between mt-auto border-t border-white/10 pt-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex items-center gap-1 text-xs text-muted-foreground",
                                children: [
                                    " ",
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$calendar$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Calendar$3e$__["Calendar"], {
                                        className: "h-3 w-3"
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 349,
                                        columnNumber: 83
                                    }, this),
                                    " ",
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        children: formattedDate
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 349,
                                        columnNumber: 116
                                    }, this),
                                    " "
                                ]
                            }, void 0, true, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 349,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$components$2f$AnimatePresence$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AnimatePresence"], {
                                children: [
                                    showCancel && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                                        initial: {
                                            opacity: 0
                                        },
                                        animate: {
                                            opacity: 1
                                        },
                                        exit: {
                                            opacity: 0
                                        },
                                        className: "flex gap-1",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialog"], {
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogTrigger"], {
                                                    asChild: true,
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                                                        size: "icon",
                                                        variant: "ghost",
                                                        className: "h-6 w-6 text-orange-500/70 hover:text-orange-500 hover:bg-orange-500/10",
                                                        title: "Cancel generation",
                                                        disabled: isCancelling,
                                                        children: [
                                                            " ",
                                                            isCancelling ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                                                className: "h-3.5 w-3.5 animate-spin"
                                                            }, void 0, false, {
                                                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                lineNumber: 355,
                                                                columnNumber: 208
                                                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__XCircle$3e$__["XCircle"], {
                                                                className: "h-3.5 w-3.5"
                                                            }, void 0, false, {
                                                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                lineNumber: 355,
                                                                columnNumber: 259
                                                            }, this),
                                                            " "
                                                        ]
                                                    }, void 0, true, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                        lineNumber: 355,
                                                        columnNumber: 21
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                    lineNumber: 354,
                                                    columnNumber: 19
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogContent"], {
                                                    className: "glass-card border-orange-500/30",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogHeader"], {
                                                            children: [
                                                                " ",
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogTitle"], {
                                                                    children: "Cancel Generation?"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                    lineNumber: 358,
                                                                    columnNumber: 41
                                                                }, this),
                                                                " ",
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogDescription"], {
                                                                    children: " This will stop the generation process. Credits will not be refunded. "
                                                                }, void 0, false, {
                                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                    lineNumber: 358,
                                                                    columnNumber: 97
                                                                }, this),
                                                                " "
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                            lineNumber: 358,
                                                            columnNumber: 21
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogFooter"], {
                                                            children: [
                                                                " ",
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogCancel"], {
                                                                    disabled: isCancelling,
                                                                    children: "Keep Running"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                    lineNumber: 359,
                                                                    columnNumber: 41
                                                                }, this),
                                                                " ",
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogAction"], {
                                                                    onClick: handleCancelConfirm,
                                                                    disabled: isCancelling,
                                                                    className: "bg-orange-500 text-white hover:bg-orange-600",
                                                                    children: [
                                                                        " ",
                                                                        isCancelling ? "Cancelling..." : "Cancel Generation",
                                                                        " "
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                    lineNumber: 359,
                                                                    columnNumber: 117
                                                                }, this),
                                                                " "
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                            lineNumber: 359,
                                                            columnNumber: 21
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                    lineNumber: 357,
                                                    columnNumber: 19
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                            lineNumber: 353,
                                            columnNumber: 17
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 352,
                                        columnNumber: 15
                                    }, this),
                                    showActions && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$framer$2d$motion$2f$dist$2f$es$2f$render$2f$components$2f$motion$2f$proxy$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["motion"].div, {
                                        initial: {
                                            opacity: 0
                                        },
                                        animate: {
                                            opacity: 1
                                        },
                                        exit: {
                                            opacity: 0
                                        },
                                        className: "flex gap-1",
                                        children: [
                                            isCompleted && item.media_url && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                                                size: "icon",
                                                variant: "ghost",
                                                className: "h-6 w-6 text-muted-foreground hover:text-primary",
                                                onClick: downloadMedia,
                                                title: "Download",
                                                disabled: isDeleting,
                                                children: [
                                                    " ",
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$download$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Download$3e$__["Download"], {
                                                        className: "h-3.5 w-3.5"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                        lineNumber: 366,
                                                        columnNumber: 214
                                                    }, this),
                                                    " "
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                lineNumber: 366,
                                                columnNumber: 53
                                            }, this),
                                            item.prompt && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                                                size: "icon",
                                                variant: "ghost",
                                                className: "h-6 w-6 text-muted-foreground hover:text-primary",
                                                onClick: copyPrompt,
                                                title: "Copy prompt",
                                                disabled: isDeleting,
                                                children: [
                                                    " ",
                                                    isCopied ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__["Check"], {
                                                        className: "h-3.5 w-3.5 text-green-500"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                        lineNumber: 367,
                                                        columnNumber: 208
                                                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$copy$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Copy$3e$__["Copy"], {
                                                        className: "h-3.5 w-3.5"
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                        lineNumber: 367,
                                                        columnNumber: 259
                                                    }, this),
                                                    " "
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                lineNumber: 367,
                                                columnNumber: 35
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialog"], {
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogTrigger"], {
                                                        asChild: true,
                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Button"], {
                                                            size: "icon",
                                                            variant: "ghost",
                                                            className: "h-6 w-6 text-destructive/70 hover:text-destructive hover:bg-destructive/10",
                                                            title: "Delete",
                                                            disabled: isDeleting,
                                                            children: [
                                                                " ",
                                                                isDeleting ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                                                    className: "h-3.5 w-3.5 animate-spin"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                    lineNumber: 370,
                                                                    columnNumber: 196
                                                                }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$trash$2d$2$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Trash2$3e$__["Trash2"], {
                                                                    className: "h-3.5 w-3.5"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                    lineNumber: 370,
                                                                    columnNumber: 247
                                                                }, this),
                                                                " "
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                            lineNumber: 370,
                                                            columnNumber: 21
                                                        }, this)
                                                    }, void 0, false, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                        lineNumber: 369,
                                                        columnNumber: 19
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogContent"], {
                                                        className: "glass-card border-destructive/30",
                                                        children: [
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogHeader"], {
                                                                children: [
                                                                    " ",
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogTitle"], {
                                                                        children: "Delete Media?"
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                        lineNumber: 373,
                                                                        columnNumber: 41
                                                                    }, this),
                                                                    " ",
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogDescription"], {
                                                                        children: " This action cannot be undone. The media record and file will be permanently deleted. "
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                        lineNumber: 373,
                                                                        columnNumber: 92
                                                                    }, this),
                                                                    " "
                                                                ]
                                                            }, void 0, true, {
                                                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                lineNumber: 373,
                                                                columnNumber: 21
                                                            }, this),
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogFooter"], {
                                                                children: [
                                                                    " ",
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogCancel"], {
                                                                        disabled: isDeleting,
                                                                        children: "Cancel"
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                        lineNumber: 374,
                                                                        columnNumber: 41
                                                                    }, this),
                                                                    " ",
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$ui$2f$src$2f$components$2f$ui$2f$alert$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AlertDialogAction"], {
                                                                        onClick: handleDeleteConfirm,
                                                                        disabled: isDeleting,
                                                                        className: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
                                                                        children: [
                                                                            " ",
                                                                            isDeleting ? "Deleting..." : "Delete",
                                                                            " "
                                                                        ]
                                                                    }, void 0, true, {
                                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                        lineNumber: 374,
                                                                        columnNumber: 109
                                                                    }, this),
                                                                    " "
                                                                ]
                                                            }, void 0, true, {
                                                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                                lineNumber: 374,
                                                                columnNumber: 21
                                                            }, this)
                                                        ]
                                                    }, void 0, true, {
                                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                        lineNumber: 372,
                                                        columnNumber: 19
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                                lineNumber: 368,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                        lineNumber: 365,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                                lineNumber: 350,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                        lineNumber: 348,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
                lineNumber: 346,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/apps/web/src/components/dashboard/media-library.tsx",
        lineNumber: 304,
        columnNumber: 5
    }, this);
}
_s1(MediaCard, "rL47Y0dzSP2HdmR5rvFRS78Dl2k=");
_c1 = MediaCard;
var _c, _c1;
__turbopack_context__.k.register(_c, "MediaLibrary");
__turbopack_context__.k.register(_c1, "MediaCard");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
}]);

//# sourceMappingURL=apps_web_src_ee5056d9._.js.map