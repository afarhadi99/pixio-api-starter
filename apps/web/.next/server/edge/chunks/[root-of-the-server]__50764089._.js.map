{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/packages/supabase/src/lib/middleware.ts"],"sourcesContent":["// src/lib/supabase/middleware.ts\r\nimport { createServerClient } from '@supabase/ssr';\r\nimport { type NextRequest, NextResponse } from 'next/server';\r\nimport { Database } from '../types/db_types';\r\n\r\nexport async function updateSession(request: NextRequest) {\r\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\n  const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n  \r\n  console.log(\"[Middleware] Checking Env:\", { \r\n    url: supabaseUrl ? (supabaseUrl.substring(0, 10) + '...') : \"MISSING\", \r\n    key: supabaseKey ? \"PRESENT\" : \"MISSING\" \r\n  });\r\n\r\n  if (!supabaseUrl || !supabaseKey) {\r\n    console.error(\"[Middleware] Critical: Missing Supabase environment variables.\");\r\n    return NextResponse.next({ request });\r\n  }\r\n\r\n  let supabaseResponse = NextResponse.next({\r\n    request,\r\n  });\r\n\r\n  const supabase = createServerClient<Database>(\r\n    supabaseUrl,\r\n    supabaseKey,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return request.cookies.getAll();\r\n        },\r\n        setAll(cookiesToSet) {\r\n          cookiesToSet.forEach(({ name, value, options }) => {\r\n            supabaseResponse.cookies.set(name, value, options);\r\n          });\r\n        },\r\n      },\r\n    }\r\n  );\r\n\r\n  try {\r\n    // Refresh session\r\n    const { data: { user }, error } = await supabase.auth.getUser();\r\n    if (error) {\r\n       console.log(\"[Middleware] getUser error:\", error.message);\r\n    }\r\n\r\n    // Optional: Redirect unauthenticated users\r\n    const authPath = request.nextUrl.pathname.startsWith('/login') || \r\n                     request.nextUrl.pathname.startsWith('/signup') || \r\n                     request.nextUrl.pathname.startsWith('/auth');\r\n    \r\n    const protectedPaths = ['/dashboard', '/account', '/premium'];\r\n    const isProtectedPath = protectedPaths.some(path => \r\n      request.nextUrl.pathname.startsWith(path)\r\n    );\r\n\r\n    // Redirect unauthenticated users from protected routes to login\r\n    if (!user && isProtectedPath) {\r\n      const redirectUrl = request.nextUrl.clone();\r\n      redirectUrl.pathname = '/login';\r\n      redirectUrl.searchParams.set('from', request.nextUrl.pathname);\r\n      return NextResponse.redirect(redirectUrl);\r\n    }\r\n\r\n    // Redirect authenticated users from auth routes to dashboard\r\n    if (user && authPath) {\r\n      const redirectUrl = request.nextUrl.clone();\r\n      redirectUrl.pathname = '/dashboard';\r\n      return NextResponse.redirect(redirectUrl);\r\n    }\r\n  } catch (err: any) {\r\n    console.error(\"[Middleware] Unexpected error fetching user:\", err);\r\n  }\r\n\r\n  return supabaseResponse;\r\n}\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;AACjC;AAAA;AACA;AAAA;;;AAGO,eAAe,cAAc,OAAoB;IACtD,MAAM;IACN,MAAM;IAEN,QAAQ,GAAG,CAAC,8BAA8B;QACxC,KAAK,uCAAe,YAAY,SAAS,CAAC,GAAG,MAAM;QACnD,KAAK,uCAAc;IACrB;IAEA,uCAAkC;;IAGlC;IAEA,IAAI,mBAAmB,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QACvC;IACF;IAEA,MAAM,WAAW,CAAA,GAAA,iLAAA,CAAA,qBAAkB,AAAD,EAChC,aACA,aACA;QACE,SAAS;YACP;gBACE,OAAO,QAAQ,OAAO,CAAC,MAAM;YAC/B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;oBAC5C,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;gBAC5C;YACF;QACF;IACF;IAGF,IAAI;QACF,kBAAkB;QAClB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAC7D,IAAI,OAAO;YACR,QAAQ,GAAG,CAAC,+BAA+B,MAAM,OAAO;QAC3D;QAEA,2CAA2C;QAC3C,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,aACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,cACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;QAErD,MAAM,iBAAiB;YAAC;YAAc;YAAY;SAAW;QAC7D,MAAM,kBAAkB,eAAe,IAAI,CAAC,CAAA,OAC1C,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;QAGtC,gEAAgE;QAChE,IAAI,CAAC,QAAQ,iBAAiB;YAC5B,MAAM,cAAc,QAAQ,OAAO,CAAC,KAAK;YACzC,YAAY,QAAQ,GAAG;YACvB,YAAY,YAAY,CAAC,GAAG,CAAC,QAAQ,QAAQ,OAAO,CAAC,QAAQ;YAC7D,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,6DAA6D;QAC7D,IAAI,QAAQ,UAAU;YACpB,MAAM,cAAc,QAAQ,OAAO,CAAC,KAAK;YACzC,YAAY,QAAQ,GAAG;YACvB,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;QAC/B;IACF,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,gDAAgD;IAChE;IAEA,OAAO;AACT"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/web/src/middleware.ts"],"sourcesContent":["// src/middleware.ts\r\nimport { type NextRequest } from 'next/server';\r\nimport { updateSession } from '@repo/supabase/middleware';\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  return await updateSession(request);\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.svg$).*)',\r\n  ],\r\n};\r\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;AAEpB;;AAEO,eAAe,WAAW,OAAoB;IACnD,OAAO,MAAM,CAAA,GAAA,wJAAA,CAAA,gBAAa,AAAD,EAAE;AAC7B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}